<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Şampiyonlar Ligi</title>
    <style>
        /* Genel Stil */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 3.5em;
            font-weight: bold;
            color: #ff4500;
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
            margin-bottom: 30px;
        }

        h1 span {
            color: #0078d7;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* PIN ve Admin Paneli */
        .pin-container, #admin-panel {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .pin-container input, .pin-container button, #admin-panel input, #admin-panel button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: calc(100% - 30px);
            box-sizing: border-box;
        }

        /* Genel Buton Stilleri */
        button {
            background-color: #0078d7;
            color: white;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background 0.3s ease;
            padding: 10px 20px;
            font-size: 1em;
        }

        button:hover {
            background-color: #005bb5;
        }

        /* Görevli Tablosu Butonu */
        #task-table-btn {
            margin-bottom: 20px;
            font-size: 1.2em;
            padding: 12px 20px;
            font-weight: bold;
            display: inline-block;
            background-color: #28a745; /* Yeşil renk */
            transition: background 0.3s ease;
            border: none;
            color: white;
        }

        #task-table-btn:hover {
            background-color: #218838;
        }

        /* Tablo Container ve Görevli Tablosu */
        .table-container, #task-table-container {
            max-width: 90%;
            margin: 20px auto;
            background-color: #ffffff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease-in-out;
            display: none;
        }

        .table-container:hover, #task-table-container:hover {
            transform: scale(1.02);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1em;
            text-align: center;
        }

        th, td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: linear-gradient(to right, #0078d7, #005bb5);
            color: white;
        }

        /* "İşlemler" Sütunu */
        .actions {
            display: none; /* Sütunu tamamen gizle */
        }

        .edit-mode-enabled .actions {
            display: table-cell; /* Edit modunda göster */
        }

        /* Öğrenci Fotoğrafı */
        td img {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            max-width: 100%; /* Responsive */
            height: auto; /* Responsive */
        }

        /* Puan Butonları */
        .button-red, .button-green, .button-update {
            margin: 5px;
            padding: 5px 10px;
            font-size: 0.9em;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .button-red {
            background-color: #f44336;
            color: white;
        }

        .button-red:hover {
            background-color: #d32f2f;
        }

        .button-green {
            background-color: #4caf50;
            color: white;
        }

        .button-green:hover {
            background-color: #388e3c;
        }

        .button-update {
            background-color: #ffa500;
            color: white;
        }

        .button-update:hover {
            background-color: #e69500;
        }

        /* Kaydet Butonu */
        #save-changes {
            display: none;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 1em;
            background-color: #28a745;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            border: none;
        }

        #save-changes:hover {
            background-color: #218838;
        }

        /* Sınıf Seçimi */
        #class-selection {
            margin-bottom: 20px;
        }

        /* Üst Üç Sıranın Efekti */
        @keyframes wave {
            0% {
                background-position: 0% 0%;
            }
            50% {
                background-position: 100% 100%;
            }
            100% {
                background-position: 0% 0%;
            }
        }

        .top-1 {
            background: linear-gradient(135deg, 
                #FFD700 0%, 
                #FFE033 20%, 
                #FFD700 40%, 
                #FFE033 60%, 
                #FFD700 80%, 
                #FFE033 100%
            );
            background-size: 400% 400%;
            animation: wave 5s linear infinite;
        }

        .top-2 {
            background: linear-gradient(135deg, 
                #FFE033 0%, 
                #FFF1A8 20%, 
                #FFE033 40%, 
                #FFF1A8 60%, 
                #FFE033 80%, 
                #FFF1A8 100%
            );
            background-size: 400% 400%;
            animation: wave 5s linear infinite;
        }

        .top-3 {
            background: linear-gradient(135deg, 
                #FFF1A8 0%, 
                #FFF9C4 20%, 
                #FFF1A8 40%, 
                #FFF9C4 60%, 
                #FFF1A8 80%, 
                #FFF9C4 100%
            );
            background-size: 400% 400%;
            animation: wave 5s linear infinite;
        }

        /* Şanslı Öğrenci Bölümü */
        #lucky-student-btn {
            margin-bottom: 10px;
            font-size: 1.2em;
            padding: 12px 20px;
            font-weight: bold;
            display: inline-block;
            background-color: #0078d7;
            transition: background 0.3s ease;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        #lucky-student-btn:hover {
            background-color: #005bb5;
        }

        #lucky-student-result {
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 2em;
            color: #0078d7;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
            animation: pulse 1.5s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        /* Reset Lucky Butonu */
        #reset-lucky {
            margin-left: 10px;
            padding: 12px 15px;
            font-size: 1.2em;
            display: inline-block;
            position: relative;
            overflow: hidden;
            background-color: #0078d7;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #reset-lucky::before {
            content: "↻";
            display: inline-block;
            font-size: 1.4em;
            transform: rotate(0deg);
            transition: transform 0.5s ease;
        }

        #reset-lucky:hover {
            background-color: #005bb5;
        }

        #reset-lucky:hover::before {
            transform: rotate(360deg);
        }

        /* Modal Stilleri */
        dialog {
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            padding: 20px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        #modal-content p {
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        #modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        #modal-buttons button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #modal-buttons .ok-btn {
            background-color: #0078d7;
            color: white;
        }

        #modal-buttons .cancel-btn {
            background-color: #6c757d;
            color: white;
        }

        #modal-buttons .confirm-btn {
            background-color: #28a745;
            color: white;
        }

        #modal-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            display: none;
        }

        /* Görevli Tablosu Eklemeleri */
        #task-table-container {
            max-width: 90%;
            margin: 20px auto;
            background-color: #ffffff;
            border: 3px solid #28a745; /* Yeşil çerçeve */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease-in-out;
            display: none;
        }

        #task-table-container:hover {
            transform: scale(1.02);
        }

        #task-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1em;
            text-align: center;
        }

        #task-table th, #task-table td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }

        #task-table th {
            background: linear-gradient(to right, #28a745, #218838);
            color: white;
        }

        /* Görevli Tablosu İçin actions sütunu */
        #task-table th.actions, #task-table td.actions {
            display: none; /* Sütunu gizle */
        }

        .edit-mode-enabled #task-table th.actions, .edit-mode-enabled #task-table td.actions {
            display: table-cell; /* Edit modunda göster */
        }

        /* Dinamik Çerçeve Efekti */
        .highlighted {
            position: relative;
            animation: glow 2s infinite;
            border: 2px solid #FFD700; /* Çerçeveyi inceltildi */
            border-radius: 10px;
            padding: 10px;
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700;
            }
            50% {
                box-shadow: 0 0 20px #FFD700, 0 0 30px #FFD700, 0 0 40px #FFD700;
            }
            100% {
                box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700;
            }
        }

        .edit-button {
            background-color: #0078d7;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .edit-button:hover {
            background-color: #005bb5;
        }

        /* Yeni Görev Ekleme Butonu */
        #add-task-btn {
            background-color: #17a2b8;
            margin-top: 10px;
            display: none;
            padding: 8px 16px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #add-task-btn:hover {
            background-color: #138496;
        }

        /* Görev Silme Butonları */
        .delete-task-btn {
            background-color: #dc3545;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .delete-task-btn:hover {
            background-color: #c82333;
        }

        /* Düzenle Butonuna Ekstra Stil */
        .edit-task-btn {
            background-color: #ffc107;
            margin-right: 5px;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .edit-task-btn:hover {
            background-color: #e0a800;
        }

        /* Modal Checkbox Düzenlemesi */
        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            width: 45%; /* İki sütun oluştur */
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checkbox-item label {
            flex: 1;
            text-align: left;
        }

        /* Düzenleme Modu Butonlarının Görünürlüğü */
        .editable-button {
            display: none;
        }

        .edit-mode-enabled .editable-button {
            display: inline-block;
        }

        /* Oyun Overlay Stilleri */
        #game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #game-container {
            background-color: #ffffff;
            width: 90%;
            max-width: 1200px;
            height: 90%;
            border-radius: 10px;
            position: relative;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Küçültülmüş Kapat Butonu */
        #close-game-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px; /* Küçültüldü */
            height: 30px; /* Küçültüldü */
            cursor: pointer;
            font-size: 1em; /* Küçültüldü */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        #close-game-btn:hover {
            background-color: #d32f2f;
        }

        /* Soru Alanı */
        #question-area {
            position: relative;
            width: 100%;
            height: 600px; /* Güncellenen yükseklik */
            margin-bottom: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #question-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            text-align: center;
            font-size: 2.5em; /* Font boyutu artırıldı */
            font-weight: bold;
            animation: fadeIn 1s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Tavşan ve Havuç Resimleri */
        #bunny-left, #bunny-right, #carrot {
            position: absolute;
            top: 0;
            width: 185px;
            height: 125px;
            max-width: 100%; /* Responsive */
            height: auto; /* Responsive */
        }

        #bunny-left {
            left: 0%; /* En sola taşındı */
            transition: left 0.5s ease;
        }

        #bunny-right {
            right: 0%; /* En sağa taşındı */
            transition: right 0.5s ease;
        }

        #carrot {
            left: 50%;
            transform: translateX(-50%);
        }

        /* Yıldızlar */
        .left-stars, .right-stars {
            position: absolute;
            top: 10%; /* Yıldızların orta hizada olması için */
            display: flex;
            gap: 20px; /* Eşit aralık */
            transform: translateY(-50%);
        }

        /* Sol Yıldızları Daha Sola Yanaştırma ve Soldan Başlayarak Yok Olmasını Sağlama */
        .left-stars {
            left: 11%; /* Daha sola taşındı */
            flex-direction: row-reverse; /* Yıldızları soldan sağa dizmek için */
        }

        /* Sağ Yıldızları Daha Sağa Yanaştırma */
        .right-stars {
            right: 11%; /* Daha sağa taşındı */
            flex-direction: row; /* Varsayılan yön */
        }

        .star {
            width: 80px; /* Yıldız boyutu artırıldı */
            height: 80px;
            max-width: 100%; /* Responsive */
            height: auto; /* Responsive */
        }

        /* Oyun İçeriği */
        #game-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* İsim ve şıkları aşağıya çekmek için */
            height: 100%;
        }

        #game-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-end; /* Daha aşağıda konumlandırmak için */
            position: relative;
            width: 100%;
            height: 100%;
            margin-top: 20px; /* İsim ve şıkları aşağıya çekmek için */
        }

        .player-section {
            width: 45%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px; /* İsim ve şıkları daha aşağıya çekmek için */
        }

        .player-name {
            font-size: 2em; /* Font boyutu artırıldı */
            font-weight: bold;
            margin-bottom: 10px;
        }

        .answers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            width: 100%;
            justify-content: center;
            margin-top: 10px;
        }

        .answer-btn {
            padding: 10px 20px;
            background-color: #00b3ff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            flex: 1 1 30%; /* 3 şık için esnek genişlik */
            transition: background 0.3s ease;
            font-size: 1.2em; /* Font boyutu artırıldı */
        }

        .answer-btn:hover {
            background-color: #00b3ff;
        }

        .disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Kazanma Efekti */
        #winner-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-image: url('https://cdn.pixabay.com/animation/2023/12/09/19/16/19-16-42-998_512.gif'); /* Havai fişek GIF */
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            color: #228B22; /* Daha okunabilir yeşil renk */
            padding: 40px 60px; /* Daha büyük */
            border-radius: 15px;
            font-size: 2em; /* Küçültüldü */
            animation: popIn 1s, flash 2s infinite; /* Yeni flash animasyonu eklendi */
            z-index: 3000; /* Daha yüksek */
            display: none;
            box-shadow: 0 0 20px #228B22; /* Çerçeve rengini güncelledim */
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* Tekrar Oyna Butonu */
        /* Güncellenmiş Stil Başlangıcı */
        #play-again-btn {
            margin-top: 5px; /* Daha küçük margin */
            padding: 4px 8px; /* Daha küçük padding */
            background-color: #1E90FF; /* Metalik mavi renk */
            color: white;
            border: none;
            border-radius: 3px; /* Aynı border-radius */
            cursor: pointer;
            font-size: 0.8em; /* Daha küçük font boyutu */
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 3px; /* Simge ile metin arasındaki boşluğu azalttık */
        }

        #play-again-btn:hover {
            background-color: #104E8B; /* Hover durumunda daha koyu metalik mavi */
        }
        /* Güncellenmiş Stil Bitişi */

        /* Öğrenci Seçim Modal Stili */
        #student-selection-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        #student-selection-container {
            background-color: #ffffff;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        /* Küçültülmüş Kapat Butonu */
        #close-selection-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px; /* Küçültüldü */
            height: 25px; /* Küçültüldü */
            cursor: pointer;
            font-size: 0.9em; /* Küçültüldü */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        #close-selection-btn:hover {
            background-color: #d32f2f;
        }

        .selection-panel {
            margin-bottom: 20px;
        }

        .selection-panel label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .selection-panel select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #confirm-selection-btn {
            background-color: #28a745;
            margin-top: 10px;
            color: white;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            transition: background 0.3s ease;
        }

        #confirm-selection-btn:hover {
            background-color: #218838;
        }

        /* Yıldızların Görünürlüğünü Kontrol Etme */
        .hidden-star {
            visibility: hidden;
        }

        /* Yeni Eklenen Bölüm: Intro Overlay */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 4000; /* Diğer overlay'lerden daha yüksek */
        }

        #intro-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Responsive Tasarım için Medya Sorguları */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5em;
            }

            #task-table-container, .table-container {
                max-width: 95%;
            }

            #question-area {
                height: 400px;
            }

            .player-section {
                width: 100%;
                margin-top: 10px;
            }

            .player-name {
                font-size: 1.5em;
            }

            .answer-btn {
                flex: 1 1 45%;
                font-size: 1em;
                padding: 8px 16px;
            }

            .star {
                width: 60px;
                height: 60px;
            }

            #play-again-btn {
                font-size: 0.8em;
                padding: 5px 8px;
                gap: 3px;
            }

            #lucky-student-result {
                font-size: 1.5em;
            }

            #question-text {
                font-size: 2em;
            }

            /* Öğrenci Fotoğrafları */
            td img {
                width: 50px;
                height: 50px;
            }

            /* Görevli Tablosu */
            #task-table th, #task-table td {
                padding: 10px;
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2em;
            }

            #question-area {
                height: 300px;
            }

            .player-name {
                font-size: 1.2em;
            }

            .answer-btn {
                flex: 1 1 100%;
                font-size: 0.9em;
                padding: 6px 12px;
            }

            .star {
                width: 50px;
                height: 50px;
            }

            #play-again-btn {
                font-size: 0.7em;
                padding: 4px 8px;
                gap: 2px;
            }

            #lucky-student-result {
                font-size: 1.2em;
            }

            #question-text {
                font-size: 1.8em;
            }

            /* Öğrenci Fotoğrafları */
            td img {
                width: 40px;
                height: 40px;
            }

            /* Görevli Tablosu */
            #task-table th, #task-table td {
                padding: 8px;
                font-size: 0.8em;
            }

            /* Modal İçin */
            .selection-panel label, #modal-content p {
                font-size: 1em;
            }

            #play-again-btn {
                padding: 4px 8px;
                font-size: 0.7em;
            }
        }

        /* Kazanan Öğrenci Mesajının Güncellenmiş Stili */
        #winner-message {
            font-size: 3em; /* Font boyutunu artırdık */
            font-weight: bold;
            color: #00FFFF; /* Metin rengini metalik maviye yakın bir renge ayarladık */
            padding: 20px;
            border: 3px solid #00FFFF; /* Fosforlu mavi çerçeve */
            border-radius: 10px;
            box-shadow: 0 0 10px #00FFFF, 0 0 20px #00FFFF, 0 0 30px #00FFFF; /* Fosforlu etki için gölge */
            animation: glow 1.5s infinite alternate; /* Yumuşak bir parıltı animasyonu */
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 10px #00FFFF, 0 0 20px #00FFFF, 0 0 30px #00FFFF;
            }
            to {
                box-shadow: 0 0 20px #00FFFF, 0 0 30px #00FFFF, 0 0 40px #00FFFF;
            }
        }

        /* "Tekrar Oyna" Butonunun Güncellenmiş Stili */
        #play-again-btn {
            margin-top: 5px; /* Daha küçük margin */
            padding: 4px 8px; /* Daha küçük padding */
            background-color: #1E90FF; /* Metalik mavi renk */
            color: white;
            border: none;
            border-radius: 3px; /* Aynı border-radius */
            cursor: pointer;
            font-size: 0.8em; /* Daha küçük font boyutu */
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 3px; /* Simge ile metin arasındaki boşluğu azalttık */
        }

        #play-again-btn:hover {
            background-color: #104E8B; /* Hover durumunda daha koyu metalik mavi */
        }
    </style>
</head>
<body>
    <h1>Şampiyonlar <span>+</span> Ligi</h1>
    <div id="class-selection">
        <label for="class-select">Sınıf Seçin:</label>
        <select id="class-select">
            <option value="">--Sınıf Seçin--</option>
        </select>
    </div>

    <!-- Görevli Tablosu Butonu -->
    <button id="task-table-btn" style="display:none;">Görevli Tablosu</button>
    <div id="task-table-container">
        <table id="task-table">
            <thead>
                <tr>
                    <th>Görev</th>
                    <th>Öğrenci</th>
                    <th class="actions">İşlem</th>
                </tr>
            </thead>
            <tbody>
                <!-- Haftanın Başkanı Satırı -->
                <tr id="head-of-week-row" class="highlighted">
                    <td>Sınıf Başkanı</td>
                    <td id="head-of-week">Belirlenmedi</td>
                    <td class="actions">
                        <button class="edit-button" id="edit-head">Düzenle</button>
                    </td>
                </tr>
                <!-- Nöbetçi Öğrenciler Satırı -->
                <tr id="duty-students-row">
                    <td>Nöbetçi Öğrenciler</td>
                    <td id="duty-students">Belirlenmedi</td>
                    <td class="actions">
                        <button class="edit-button" id="edit-duty-students">Düzenle</button>
                    </td>
                </tr>
                <!-- Diğer Görevler Satırı (Düzenleme Modunda Eklenecek) -->
            </tbody>
        </table>
        <button id="add-task-btn">Görev Ekle</button>
    </div>

    <button id="lucky-student-btn" style="display:none;">Şanslı Öğrenci Seç</button>
    <button id="reset-lucky" style="display:none;" title="Şanslı seçimleri sıfırla"></button>
    <div id="lucky-student-result"></div>

    <button id="edit-mode" style="display:none;">Düzenle</button>
    <div class="pin-container" id="pin-check" style="display: none;">
        <input type="password" id="pin" placeholder="PIN Girin">
        <button id="pin-submit">Doğrula</button>
    </div>
    <div id="admin-panel" style="display: none;">
        <h2>Öğrenci Ekle</h2>
        <input type="text" id="student-name" placeholder="Öğrenci Adı">
        <input type="text" id="photo-url" placeholder="Fotoğraf URL'si (Opsiyonel)">
        <button id="add-student">Öğrenci Ekle</button>
    </div>
    <button id="save-changes">Kaydet</button>
    <div class="table-container" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Fotoğraf</th>
                    <th>İsim</th>
                    <th>Genel Puan</th>
                    <th class="actions">İşlemler</th>
                </tr>
            </thead>
            <tbody id="student-table">
                <!-- Dinamik olarak doldurulacak -->
            </tbody>
        </table>
    </div>

    <!-- Oyun Başlat Butonu -->
    <button id="start-game-btn" style="margin-top: 30px; padding: 15px 30px; font-size: 1.2em; background-color: #ffec00; color: black; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s ease; display: none;">
       🥇 Şampiyon Mücadelesi 🥇 (AKILLI TAHTA)
    </button>

    <!-- Modal Dialog -->
    <dialog id="modal">
        <div id="modal-content">
            <p id="modal-message"></p>
            <div id="checkbox-container" class="checkbox-container" style="display: none;">
                <!-- Checkboxlar burada oluşturulacak -->
            </div>
            <input type="text" id="modal-input" />
            <div id="modal-buttons">
                <button class="ok-btn">OK</button>
                <button class="cancel-btn" style="display:none;">Cancel</button>
                <button class="confirm-btn" style="display:none;">Confirm</button>
            </div>
        </div>
    </dialog>

    <!-- Öğrenci Seçim Modalı -->
    <div id="student-selection-modal">
        <div id="student-selection-container">
            <button id="close-selection-btn">X</button>
            <div class="selection-panel">
                <label for="left-student-select">Sol Öğrenci:</label>
                <select id="left-student-select-modal">
                    <option value="">--Seçiniz--</option>
                    <!-- Dinamik olarak doldurulacak -->
                </select>
            </div>
            <div class="selection-panel">
                <label for="right-student-select">Sağ Öğrenci:</label>
                <select id="right-student-select-modal">
                    <option value="">--Seçiniz--</option>
                    <!-- Dinamik olarak doldurulacak -->
                </select>
            </div>
            <button id="confirm-selection-btn">Onayla</button>
        </div>
    </div>

    <!-- Oyun Overlay -->
    <div id="game-overlay">
        <div id="game-container">
            <button id="close-game-btn">X</button>
            <div id="question-area">
                <img src="https://cdn.pixabay.com/animation/2024/02/23/15/15/15-15-50-56_512.gif" alt="Tavşan Sol" id="bunny-left">
                
                <!-- Sol Yıldızlar -->
                <div class="left-stars">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                </div>
                
                <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExMGhyb3IyNWs5azlqcHJhZ2Vhc2ptcHl0eXp6Y3BvYXRqNWhrOWRqbiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/ZzPjgVE12gU54wIVtf/giphy.webp" alt="Havuç" id="carrot">
                
                <!-- Sağ Yıldızlar -->
                <div class="right-stars">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                </div>
                
                <img src="https://cdn.pixabay.com/animation/2024/02/23/15/15/15-15-50-56_512.gif" alt="Tavşan Sağ" id="bunny-right">
                <div id="question-text">Soru burada olacak</div>
            </div>
            <div id="game-body">
                <div id="game-content">
                    <div class="player-section" id="left-panel">
                        <div class="player-name" id="left-player-name">Seçilmedi</div>
                        <div id="left-answers" class="answers">
                            <!-- Sol taraf şıkları burada olacak -->
                        </div>
                    </div>
                    <div class="player-section" id="right-panel">
                        <div class="player-name" id="right-player-name">Seçilmedi</div>
                        <div id="right-answers" class="answers">
                            <!-- Sağ taraf şıkları burada olacak -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kazanan Öğrenci İsim Etkisi -->
    <div id="winner-effect" class="winner" style="display: none;">
        <div id="winner-message"></div>
        <button id="play-again-btn">↻ Tekrar Oyna</button>
    </div>

    <!-- Intro Video Overlay -->
    <div id="intro-overlay">
        <video id="intro-video" src="https://github.com/d4rkd4/G-R-V-DE/raw/refs/heads/main/BA%C5%9ELA.mp4" autoplay></video>
    </div>

    <!-- Ses Elementleri -->
    <!-- Doğru ve Yanlış Cevap Ses Efektleri ve Kazanma Efekti için Sesler -->
    <audio id="correct-sound" src="https://github.com/d4rkd4/audio-assets/raw/3925758c22f90c4e9ac2b81bf41a65fd8c8d85be/new-level-142995.mp3" preload="auto"></audio>
    <audio id="incorrect-sound" src="https://github.com/d4rkd4/audio-assets/raw/3925758c22f90c4e9ac2b81bf41a65fd8c8d85be/fail-234710.mp3" preload="auto"></audio>
    <audio id="winner-sound" src="https://github.com/d4rkd4/audio-assets/raw/3925758c22f90c4e9ac2b81bf41a65fd8c8d85be/Awards%20Fanfare%20Winner%20Nomination%20Ceremony%20Background%20Music.mp3" preload="auto"></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, set, get, remove } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "sampiyonlar-ligi.firebaseapp.com",
            databaseURL: "https://sampiyonlar-ligi-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "sampiyonlar-ligi",
            storageBucket: "sampiyonlar-ligi.appspot.com",
            messagingSenderId: "248285384149",
            appId: "1:248285384149:web:39116a8e31ef61d16f815c"
        };

        // Firebase'i Başlatma
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // DOM Elementlerini Almak
        const classSelect = document.getElementById("class-select");
        const editModeButton = document.getElementById("edit-mode");
        const pinCheck = document.getElementById("pin-check");
        const adminPanel = document.getElementById("admin-panel");
        const saveChangesButton = document.getElementById("save-changes");
        const studentTable = document.getElementById("student-table");
        const tableContainer = document.querySelector(".table-container");

        const pinInput = document.getElementById("pin");
        const pinSubmit = document.getElementById("pin-submit");
        const addStudentButton = document.getElementById("add-student");
        const studentNameInput = document.getElementById("student-name");
        const photoUrlInput = document.getElementById("photo-url");

        const luckyStudentBtn = document.getElementById("lucky-student-btn");
        const luckyStudentResult = document.getElementById("lucky-student-result");
        const resetLuckyBtn = document.getElementById("reset-lucky");

        // Ses Elementlerini Almak
        const correctSound = document.getElementById("correct-sound");
        const incorrectSound = document.getElementById("incorrect-sound");
        const winnerSound = document.getElementById("winner-sound"); // Yeni Eklenen Ses

        // Görevli Tablosu Elementleri
        const taskTableBtn = document.getElementById("task-table-btn");
        const taskTableContainer = document.getElementById("task-table-container");
        const headOfWeekCell = document.getElementById("head-of-week");
        const editHeadButton = document.getElementById("edit-head");
        const dutyStudentsCell = document.getElementById("duty-students");
        const editDutyStudentsButton = document.getElementById("edit-duty-students"); // Yeni eklenen buton

        // Modal Elementleri
        const modal = document.getElementById("modal");
        const modalMessage = document.getElementById("modal-message");
        const modalButtons = document.getElementById("modal-buttons");
        const modalInput = document.getElementById("modal-input");
        const okBtn = document.querySelector(".ok-btn");
        const cancelBtn = document.querySelector(".cancel-btn");
        const confirmBtn = document.querySelector(".confirm-btn");
        const checkboxContainer = document.getElementById("checkbox-container");

        // Öğrenci Seçim Modalı Elementleri
        const studentSelectionModal = document.getElementById("student-selection-modal");
        const closeSelectionBtn = document.getElementById("close-selection-btn");
        const leftStudentSelectModal = document.getElementById("left-student-select-modal");
        const rightStudentSelectModal = document.getElementById("right-student-select-modal");
        const confirmSelectionBtn = document.getElementById("confirm-selection-btn");

        // Oyun Başlat Butonu
        const startGameBtn = document.getElementById("start-game-btn");

        let currentClass = "";
        let currentClassPin = "";
        let currentData = {};
        let pendingChanges = {}; 
        const defaultPhotoURL = "https://cdn.pixabay.com/photo/2013/07/13/13/42/tux-161406_1280.png";

        let availableStudents = [];

        // Oyun Elementleri
        const gameOverlay = document.getElementById("game-overlay");
        const closeGameBtn = document.getElementById("close-game-btn");
        const leftAnswersDiv = document.getElementById("left-answers");
        const rightAnswersDiv = document.getElementById("right-answers");
        const questionText = document.getElementById("question-text");
        const bunnyLeft = document.getElementById("bunny-left");
        const bunnyRight = document.getElementById("bunny-right");
        const carrot = document.getElementById("carrot");
        const leftPlayerName = document.getElementById("left-player-name");
        const rightPlayerName = document.getElementById("right-player-name");

        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let leftSteps = 4; // Sol taraf için başlangıç adım sayısı
        let rightSteps = 4; // Sağ taraf için başlangıç adım sayısı
        const maxSteps = 4;

        // Seçilen Oyuncular
        let selectedLeftStudent = "";
        let selectedRightStudent = "";

        // Kazanan Etki Elementi
        const winnerEffect = document.getElementById("winner-effect");
        const winnerMessage = document.getElementById("winner-message");
        const playAgainBtn = document.getElementById("play-again-btn");

        // Intro Video Overlay Elementleri
        const introOverlay = document.getElementById("intro-overlay");
        const introVideo = document.getElementById("intro-video");

        // Uyarı Modalı Gösterme Fonksiyonu
        function showAlert(message) {
            return new Promise((resolve) => {
                modalMessage.textContent = message;
                modalInput.style.display = "none";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "none";
                confirmBtn.style.display = "none";
                okBtn.style.display = "inline-block";
                okBtn.textContent = "OK";
                modal.showModal();

                okBtn.onclick = () => {
                    modal.close();
                    resolve();
                };
            });
        }

        // Prompt Modalı Gösterme Fonksiyonu
        function showPrompt(message) {
            return new Promise((resolve) => {
                modalMessage.textContent = message;
                modalInput.style.display = "block";
                modalInput.value = "";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "none";
                okBtn.style.display = "inline-block";
                okBtn.textContent = "OK";
                modal.showModal();

                okBtn.onclick = () => {
                    const inputValue = modalInput.value.trim();
                    modal.close();
                    resolve(inputValue);
                };

                cancelBtn.onclick = () => {
                    modal.close();
                    resolve(null);
                };
            });
        }

        // Confirm Modalı Gösterme Fonksiyonu
        function showConfirm(message) {
            return new Promise((resolve) => {
                modalMessage.textContent = message;
                modalInput.style.display = "none";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "inline-block";
                okBtn.style.display = "none";
                modal.showModal();

                confirmBtn.onclick = () => {
                    modal.close();
                    resolve(true);
                };

                cancelBtn.onclick = () => {
                    modal.close();
                    resolve(false);
                };
            });
        }

        // Sınıfları Firebase'den Yükleme Fonksiyonu
        async function loadClasses() {
            try {
                const classesRef = ref(db, 'classes');
                const snapshot = await get(classesRef);
                if (snapshot.exists()) {
                    const data = snapshot.val();

                    // Mevcut seçenekleri temizleme (ilk seçenek hariç)
                    while (classSelect.options.length > 1) {
                        classSelect.remove(1);
                    }

                    for (let classKey in data) {
                        const option = document.createElement("option");
                        option.value = classKey;
                        option.textContent = classKey;
                        classSelect.appendChild(option);
                    }

                } else {
                    await showAlert("Hiç sınıf yok.");
                }
            } catch (error) {
                console.error("Error loading classes:", error);
                await showAlert("Sınıflar yüklenirken bir hata oluştu.");
            }
        }

        // Sınıfları Yükleme
        loadClasses();

        // Sınıf Seçildiğinde Yapılacaklar
        classSelect.addEventListener("change", async () => {
            currentClass = classSelect.value;
            if (currentClass) {
                try {
                    const pinRef = ref(db, `classes/${currentClass}/pin`);
                    const pinSnap = await get(pinRef);
                    if (pinSnap.exists()) {
                        currentClassPin = pinSnap.val();
                    } else {
                        await showAlert("Seçtiğiniz sınıf veritabanında PIN ile yok!");
                        return;
                    }

                    loadClassData(currentClass);
                    tableContainer.style.display = "block";
                    editModeButton.style.display = "inline-block";
                    luckyStudentBtn.style.display = "inline-block";
                    resetLuckyBtn.style.display = "inline-block";
                    taskTableBtn.style.display = "inline-block"; // Görevli Tablosu Butonu gösterildi
                    addTaskBtnDisplay(false);
                    exitEditMode();

                    // "Oyun Başlat" butonunu göster
                    startGameBtn.style.display = "inline-block";
                } catch (error) {
                    console.error("Error selecting class:", error);
                    await showAlert("Sınıf seçimi sırasında bir hata oluştu.");
                }
            } else {
                // Sınıf seçilmediğinde her şeyi gizle
                tableContainer.style.display = "none";
                editModeButton.style.display = "none";
                adminPanel.style.display = "none";
                saveChangesButton.style.display = "none";
                luckyStudentBtn.style.display = "none";
                resetLuckyBtn.style.display = "none";
                taskTableBtn.style.display = "none"; // Görevli Tablosu Butonu gizlendi
                taskTableContainer.style.display = "none"; // Görevli Tablosu gizlendi
                addTaskBtnDisplay(false);
                luckyStudentResult.textContent = "";

                // "Oyun Başlat" butonunu gizle
                startGameBtn.style.display = "none";
            }
        });

        // Görev Ekleme Butonunun Görünürlüğünü Ayarlama Fonksiyonu
        function addTaskBtnDisplay(show) {
            const addTaskBtn = document.getElementById("add-task-btn");
            if (show) {
                addTaskBtn.style.display = "inline-block";
            } else {
                addTaskBtn.style.display = "none";
            }
        }

        // Sınıf Verilerini Yükleme Fonksiyonu
        function loadClassData(cls) {
            const classDataRef = ref(db, `classes/${cls}/students`);
            onValue(classDataRef, async (snapshot) => {
                const data = snapshot.val() || {};
                currentData = data;
                populateTable(currentData);
                availableStudents = Object.keys(currentData);
                await loadRoles(cls);
                populateTaskTable(); // Görevleri yükle
                observeTasks(cls); // Görevleri izle
                observeDutyStudents();
                populateStudentSelectionModal(); // Öğrenci seçim modalını doldur
            }, {
                onlyOnce: false
            });
        }

        // Roller Yükleme Fonksiyonu
        async function loadRoles(cls) {
            const rolesRef = ref(db, `classes/${cls}/roles`);
            try {
                const snapshot = await get(rolesRef);
                if (snapshot.exists()) {
                    const roles = snapshot.val();
                    // Haftanın Başkanı
                    const presidentId = roles.headOfWeek;
                    const presidentName = currentData[presidentId]?.name || "Belirlenmedi";
                    headOfWeekCell.innerHTML = presidentId ? `🏆 ${presidentName}` : "Belirlenmedi";

                    // Nöbetçi Öğrenciler
                    dutyStudentsCell.textContent = roles.dutyStudents ? roles.dutyStudents.map(id => currentData[id]?.name).join(", ") : "Belirlenmedi";
                } else {
                    // Eğer roller yoksa, rol atamaları yapma
                    // Rolleri manuel olarak atamanız gerekecek
                    headOfWeekCell.innerHTML = "Belirlenmedi";
                    dutyStudentsCell.textContent = "Belirlenmedi";
                }
            } catch (error) {
                console.error("Error loading roles:", error);
            }
        }

        // Edit Moduna Geçiş Butonu
        editModeButton.addEventListener("click", () => {
            pinCheck.style.display = "block";
        });

        // PIN Doğrulama Butonu
        pinSubmit.addEventListener("click", async () => {
            const enteredPin = pinInput.value;
            if (enteredPin === currentClassPin) {
                pinCheck.style.display = "none";
                adminPanel.style.display = "block";
                saveChangesButton.style.display = "inline-block";
                // Edit modunu etkinleştir
                tableContainer.querySelector("table").classList.add("edit-mode-enabled");
                taskTableContainer.classList.add("edit-mode-enabled"); // Görev tablosuna edit modu ekle
                addTaskBtnDisplay(true); // Görev ekleme butonunu göster
            } else {
                await showAlert("Hatalı PIN!");
            }
        });

        // Öğrenci Tablosunu Doldurma Fonksiyonu
        function populateTable(data) {
            studentTable.innerHTML = "";
            const sortedData = Object.entries(data).sort((a,b) => (b[1].totalScore || 0) - (a[1].totalScore || 0));

            sortedData.forEach(([id, student], index) => {
                const row = document.createElement("tr");

                if (index === 0) row.classList.add("top-1");
                if (index === 1) row.classList.add("top-2");
                if (index === 2) row.classList.add("top-3");

                const studentPhoto = student.photo || defaultPhotoURL;

                row.innerHTML = `
                    <td>
                        <img src="${studentPhoto}" alt="Fotoğraf">
                        <button class="button-update editable-button" data-id="${id}">Güncelle</button>
                    </td>
                    <td>${student.name}</td>
                    <td>
                        <button class="button-red editable-button" data-id="${id}" data-type="total">-</button>
                        <span class="score-display">${student.totalScore || 0}</span>
                        <button class="button-green editable-button" data-id="${id}" data-type="total">+</button>
                    </td>
                    <td class="actions">
                        <button class="button-red" data-id="${id}" data-action="delete">X</button>
                    </td>
                `;
                studentTable.appendChild(row);
            });

            addEventListeners();
        }

        // Event Listener'ları Ekleyen Fonksiyon
        function addEventListeners() {
            // Puan artırma/azaltma butonları
            document.querySelectorAll("[data-type='total']").forEach((button) => {
                // Önceki event listener'ı kaldırmak için cloneNode kullanıldı
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener("click", () => {
                    const id = newButton.dataset.id;
                    const action = newButton.classList.contains("button-green") ? 1 : -1;
                    const newScore = Math.max(0, (currentData[id].totalScore || 0) + action);
                    currentData[id].totalScore = newScore;

                    if (!pendingChanges[id]) {
                        pendingChanges[id] = {};
                    }
                    pendingChanges[id].totalScore = newScore;

                    const span = newButton.parentElement.querySelector("span.score-display");
                    span.textContent = newScore;
                });
            });

            // Fotoğraf güncelleme butonları
            document.querySelectorAll(".button-update").forEach((button) => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener("click", async () => {
                    const id = newButton.dataset.id;
                    const newPhoto = await showPrompt("Yeni Fotoğraf URL'si girin:");
                    if (newPhoto) {
                        currentData[id].photo = newPhoto;
                        if (!pendingChanges[id]) {
                            pendingChanges[id] = {};
                        }
                        pendingChanges[id].photo = newPhoto;
                        const img = newButton.parentElement.querySelector("img");
                        img.src = newPhoto;
                    }
                });
            });

            // Silme butonları
            document.querySelectorAll("[data-action='delete']").forEach((button) => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener("click", async () => {
                    const id = newButton.dataset.id;
                    const confirmDelete = await showConfirm("Bu öğrenciyi silmek istediğinize emin misiniz?");
                    if (confirmDelete) {
                        pendingChanges[id] = { delete: true };
                        newButton.parentElement.parentElement.remove();
                        delete currentData[id]; 
                        availableStudents = availableStudents.filter(sId => sId !== id);
                    }
                });
            });
        }

        // Öğrenci Ekleme Butonu
        addStudentButton.addEventListener("click", async () => {
            const name = studentNameInput.value.trim();
            let photo = photoUrlInput.value.trim();

            if (!name) {
                await showAlert("Lütfen öğrenci adını girin!");
                return;
            }

            if (!photo) {
                photo = defaultPhotoURL;
            }

            const tempId = "temp_"+Date.now();
            currentData[tempId] = {
                name,
                photo,
                totalScore: 0
            };

            pendingChanges[tempId] = {
                name,
                photo,
                totalScore: 0,
                isNew: true
            };

            const row = document.createElement("tr");

            row.innerHTML = `
                <td>
                    <img src="${photo}" alt="Fotoğraf">
                    <button class="button-update editable-button" data-id="${tempId}">Güncelle</button>
                </td>
                <td>${name}</td>
                <td>
                    <button class="button-red editable-button" data-id="${tempId}" data-type="total">-</button>
                    <span class="score-display">0</span>
                    <button class="button-green editable-button" data-id="${tempId}" data-type="total">+</button>
                </td>
                <td class="actions">
                    <button class="button-red" data-id="${tempId}" data-action="delete">X</button>
                </td>
            `;
            studentTable.appendChild(row);
            addEventListeners(); // Event listener'ları tekrar ekle

            studentNameInput.value = "";
            photoUrlInput.value = "";

            availableStudents.push(tempId);
        });

        // Kaydet Butonu
        saveChangesButton.addEventListener("click", async () => {
            try {
                await commitChanges();
                exitEditMode();
                await showAlert("Değişiklikler kaydedildi!");
                await loadRoles(currentClass); // Roller güncellendiğinde UI'yi yenile
                populateTaskTable(); // Görev tablosunu güncelle
                populateStudentSelectionModal(); // Öğrenci seçim modalını güncelle
            } catch (error) {
                console.error("Error saving changes:", error);
                await showAlert("Değişiklikler kaydedilirken bir hata oluştu.");
            }
        });

        // Değişiklikleri Firebase'e Kaydetme Fonksiyonu
        async function commitChanges() {
            const studentsRef = ref(db, `classes/${currentClass}/students`);
            for (const id in pendingChanges) {
                const changes = pendingChanges[id];
                if (changes.delete) {
                    if (!id.startsWith("temp_")) {
                        await remove(ref(db, `classes/${currentClass}/students/${id}`));
                    }
                } else if (changes.isNew) {
                    const newRef = push(studentsRef);
                    await set(newRef, {
                        name: changes.name,
                        photo: changes.photo,
                        totalScore: changes.totalScore
                    });
                } else {
                    if (!id.startsWith("temp_")) {
                        const updates = {};
                        if (changes.totalScore !== undefined) updates.totalScore = changes.totalScore;
                        if (changes.photo !== undefined) updates.photo = changes.photo;
                        await update(ref(db, `classes/${currentClass}/students/${id}`), updates);
                    } else {
                        // Temp öğrenci ise, kalıcı hale getir
                        const newRef = push(studentsRef);
                        await set(newRef, currentData[id]);
                    }
                }
            }
            pendingChanges = {};
        }

        // Edit Modundan Çıkış Fonksiyonu
        function exitEditMode() {
            adminPanel.style.display = "none";
            saveChangesButton.style.display = "none";
            // Edit modunu kapat
            tableContainer.querySelector("table").classList.remove("edit-mode-enabled");
            taskTableContainer.classList.remove("edit-mode-enabled"); // Görev tablosundan edit modu kaldır
            addTaskBtnDisplay(false); // Görev ekleme butonunu gizle

            pinInput.value = "";
            pinCheck.style.display = "none";
        }

        // Görevli Tablosu Butonu ve Fonksiyonları
        taskTableBtn.addEventListener("click", () => {
            if (taskTableContainer.style.display === "none" || taskTableContainer.style.display === "") {
                taskTableContainer.style.display = "block";
            } else {
                taskTableContainer.style.display = "none";
            }
        });

        // Haftanın Başkanını Düzenleme Fonksiyonu
        editHeadButton.addEventListener("click", async () => {
            const students = Object.keys(currentData);
            if (students.length === 0) {
                await showAlert("Öğrenci yok!");
                return;
            }

            try {
                // Seçilebilecek tüm öğrenciler listesi
                const selectableStudents = students.map(id => `<option value="${id}">${currentData[id].name}</option>`).join('');

                // Modal'ı güncelle
                modalMessage.innerHTML = `Yeni Sınıf Başkanını seçin:<br><select id="head-select">${selectableStudents}</select>`;
                modalInput.style.display = "none";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "inline-block";
                okBtn.style.display = "none";
                modal.showModal();

                const headSelect = document.getElementById("head-select");
                confirmBtn.onclick = async () => {
                    const selectedId = headSelect.value;
                    await set(ref(db, `classes/${currentClass}/roles/headOfWeek`), selectedId);
                    headOfWeekCell.innerHTML = `🏆 ${currentData[selectedId]?.name || "Belirlenmedi"}`;
                    modal.close();
                };

                cancelBtn.onclick = () => {
                    modal.close();
                };
            } catch (error) {
                console.error("Error editing head of week:", error);
                await showAlert("Haftanın başkanını düzenlerken bir hata oluştu.");
            }
        });

        // Nöbetçi Öğrencileri Düzenleme Fonksiyonu
        editDutyStudentsButton.addEventListener("click", async () => {
            const students = Object.keys(currentData);
            if (students.length < 2) {
                await showAlert("İki öğrenci seçmek için yeterli öğrenci yok.");
                return;
            }

            try {
                // Seçilebilecek tüm öğrenciler listesi
                const selectableStudents = students.map(id => `
                    <div class="checkbox-item">
                        <input type="checkbox" id="duty-${id}" name="duty-students" value="${id}">
                        <label for="duty-${id}">${currentData[id].name}</label>
                    </div>
                `).join('');

                // Modal'ı güncelle
                modalMessage.innerHTML = `Nöbetçi Öğrencileri seçin (2 öğrenci):<br>`;
                checkboxContainer.innerHTML = selectableStudents;
                checkboxContainer.style.display = "flex"; // Göster
                modalInput.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "inline-block";
                okBtn.style.display = "none";
                modal.showModal();

                confirmBtn.onclick = async () => {
                    const selectedCheckboxes = document.querySelectorAll('input[name="duty-students"]:checked');
                    if (selectedCheckboxes.length === 2) {
                        const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
                        await set(ref(db, `classes/${currentClass}/roles/dutyStudents`), selectedIds);
                        dutyStudentsCell.textContent = selectedIds.map(id => currentData[id]?.name).join(", ");
                        modal.close();
                    } else {
                        await showAlert("Lütfen iki öğrenci seçin.");
                    }
                };

                cancelBtn.onclick = () => {
                    modal.close();
                };
            } catch (error) {
                console.error("Error editing duty students:", error);
                await showAlert("Nöbetçi öğrencileri düzenlerken bir hata oluştu.");
            }
        });

        // Şanslı Öğrenci Seçimi
        luckyStudentBtn.addEventListener("click", () => {
            if (availableStudents.length === 0) {
                luckyStudentResult.textContent = "Seçilebilecek öğrenci kalmadı!";
                return;
            }
            const randomIndex = Math.floor(Math.random() * availableStudents.length);
            const chosenId = availableStudents[randomIndex];
            const chosenName = currentData[chosenId].name;

            luckyStudentResult.textContent = "Şanslı Öğrenci: " + chosenName;

            availableStudents.splice(randomIndex, 1);
        });

        // Şanslı Öğrencileri Sıfırlama
        resetLuckyBtn.addEventListener("click", () => {
            // availableStudents dizisini tüm öğrencilerle tekrar doldur
            availableStudents = Object.keys(currentData);
            luckyStudentResult.textContent = "";
        });

        // Görev Ekleme Butonu
        document.getElementById("add-task-btn").addEventListener("click", async () => {
            const taskName = await showPrompt("Yeni görev adını girin:");
            if (taskName) {
                const newTaskId = "task_" + Date.now();
                await set(ref(db, `classes/${currentClass}/tasks/${newTaskId}`), {
                    name: taskName,
                    assignedStudents: [] // Başlangıçta atanmış öğrenci yok
                });
                // Görev eklediğinizde, onValue listener table'ı güncelleyeceği için addTaskRow çağırmaya gerek yok
            }
        });

        // Görev Satırı Ekleme Fonksiyonu
        function addTaskRow(taskId, taskName) {
            const tbody = taskTableContainer.querySelector("tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${taskName}</td>
                <td id="task-${taskId}-student">Belirlenmedi</td>
                <td class="actions">
                    <button class="edit-button edit-task-btn" data-task-id="${taskId}">Düzenle</button>
                    <button class="edit-button delete-task-btn" data-task-id="${taskId}">Sil</button>
                </td>
            `;
            tbody.appendChild(row);

            // Silme butonuna event listener ekle
            const deleteBtn = row.querySelector(".delete-task-btn");
            const newDeleteBtn = deleteBtn.cloneNode(true);
            deleteBtn.parentNode.replaceChild(newDeleteBtn, deleteBtn);
            newDeleteBtn.addEventListener("click", async () => {
                const confirmDelete = await showConfirm("Bu görevi silmek istediğinize emin misiniz?");
                if (confirmDelete) {
                    await remove(ref(db, `classes/${currentClass}/tasks/${taskId}`));
                    row.remove();
                }
            });

            // Düzenleme butonuna event listener ekle
            const editBtn = row.querySelector(".edit-task-btn");
            const newEditBtn = editBtn.cloneNode(true);
            editBtn.parentNode.replaceChild(newEditBtn, editBtn);
            newEditBtn.addEventListener("click", async () => {
                const taskRef = ref(db, `classes/${currentClass}/tasks/${taskId}`);
                try {
                    const snapshot = await get(taskRef);
                    if (snapshot.exists()) {
                        const taskData = snapshot.val();
                        const assignedStudents = taskData.assignedStudents || [];

                        // Seçili öğrencileri listeye ekle
                        const selectableStudents = Object.keys(currentData).map(id => `
                            <div class="checkbox-item">
                                <input type="checkbox" id="task-${taskId}-student-${id}" name="task-students" value="${id}" ${assignedStudents.includes(id) ? 'checked' : ''}>
                                <label for="task-${taskId}-student-${id}">${currentData[id].name}</label>
                            </div>
                        `).join('');

                        // Modal'ı güncelle
                        modalMessage.innerHTML = `Göreve Atanacak Öğrencileri seçin:<br>`;
                        checkboxContainer.innerHTML = selectableStudents;
                        checkboxContainer.style.display = "flex"; // Göster
                        modalInput.style.display = "none";
                        cancelBtn.style.display = "inline-block";
                        confirmBtn.style.display = "inline-block";
                        okBtn.style.display = "none";
                        modal.showModal();

                        confirmBtn.onclick = async () => {
                            const selectedCheckboxes = document.querySelectorAll('input[name="task-students"]:checked');
                            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
                            await update(ref(db, `classes/${currentClass}/tasks/${taskId}`), {
                                assignedStudents: selectedIds
                            });

                            // Görev tablosunda öğrencileri güncelle
                            if (selectedIds.length > 0) {
                                const studentNames = selectedIds.map(id => currentData[id]?.name).join(", ");
                                row.querySelector(`#task-${taskId}-student`).textContent = studentNames;
                            } else {
                                row.querySelector(`#task-${taskId}-student`).textContent = "Belirlenmedi";
                            }

                            modal.close();
                        };

                        cancelBtn.onclick = () => {
                            modal.close();
                        };
                    } else {
                        await showAlert("Görev bulunamadı.");
                    }
                } catch (error) {
                    console.error("Error editing task:", error);
                    await showAlert("Görev düzenlenirken bir hata oluştu.");
                }
            });
        }

        // Görev Tablosunu Doldurma Fonksiyonu
        async function populateTaskTable() {
            const tasksRef = ref(db, `classes/${currentClass}/tasks`);
            try {
                const snapshot = await get(tasksRef);
                if (snapshot.exists()) {
                    const tasks = snapshot.val();
                    const tbody = taskTableContainer.querySelector("tbody");
                    // Mevcut görev satırlarını temizle (sabit satırlar hariç)
                    tbody.querySelectorAll("tr:not(#head-of-week-row):not(#duty-students-row)").forEach(row => row.remove());

                    for (let taskId in tasks) {
                        addTaskRow(taskId, tasks[taskId].name);
                        // Atanan öğrencileri tabloya yansıt
                        const assignedIds = tasks[taskId].assignedStudents || [];
                        const studentNames = assignedIds.map(id => currentData[id]?.name).join(", ");
                        const studentCell = document.getElementById(`task-${taskId}-student`);
                        if (studentCell) {
                            studentCell.textContent = assignedIds.length > 0 ? studentNames : "Belirlenmedi";
                        }
                    }
                } else {
                    // Eğer sınıfa ait görev yoksa, sadece başkan ve nöbetçi satırlarını bırak
                    const tbody = taskTableContainer.querySelector("tbody");
                    tbody.querySelectorAll("tr:not(#head-of-week-row):not(#duty-students-row)").forEach(row => row.remove());
                }
            } catch (error) {
                console.error("Error populating task table:", error);
            }
        }

        // Görevlerdeki Değişiklikleri İzleme Fonksiyonu
        function observeTasks(cls) {
            const tasksRef = ref(db, `classes/${cls}/tasks`);
            onValue(tasksRef, async (snapshot) => {
                await populateTaskTable();
            });
        }

        // Nöbetçi Öğrencilerdeki Değişiklikleri İzleme Fonksiyonu
        function observeDutyStudents() {
            const dutyStudentsRef = ref(db, `classes/${currentClass}/roles/dutyStudents`);
            onValue(dutyStudentsRef, (snapshot) => {
                if (snapshot.exists()) {
                    const dutyIds = snapshot.val(); // İki öğrenci ID'si
                    const dutyNames = dutyIds.map(id => currentData[id]?.name).filter(name => name);
                    dutyStudentsCell.textContent = dutyNames.length > 0 ? dutyNames.join(", ") : "Belirlenmedi";
                } else {
                    dutyStudentsCell.textContent = "Belirlenmedi";
                }
            });
        }

        // Oyun Başlat Butonuna Event Listener Ekleme
        startGameBtn.addEventListener("click", () => {
            // Öğrenci seçimi modalını göster
            studentSelectionModal.style.display = "flex";
        });

        // Öğrenci Seçim Modalını Kapatma Fonksiyonu
        closeSelectionBtn.addEventListener("click", () => {
            studentSelectionModal.style.display = "none";
        });

        // Seçim Onay Butonuna Event Listener Ekleme
        confirmSelectionBtn.addEventListener("click", () => {
            selectedLeftStudent = leftStudentSelectModal.value;
            selectedRightStudent = rightStudentSelectModal.value;

            if (!selectedLeftStudent || !selectedRightStudent) {
                showAlert("Her iki taraf için de bir öğrenci seçmeniz gerekiyor.");
                return;
            }

            if (selectedLeftStudent === selectedRightStudent) {
                showAlert("Aynı öğrenciyi her iki taraf için seçemezsiniz.");
                return;
            }

            // Modalı kapat
            studentSelectionModal.style.display = "none";

            // Oyunu başlat
            startGame(selectedLeftStudent, selectedRightStudent);
        });

        // Oyun Başlatma Fonksiyonu
        function startGame(leftId, rightId) {
            // Reset oyun durumu
            gameQuestions = generateQuestions(20); // 20 soru oluştur
            currentQuestionIndex = 0;
            leftSteps = 4; // Sol taraf için adım sayısı
            rightSteps = 4; // Sağ taraf için adım sayısı

            // Bunnies'i başlangıç pozisyonuna getir
            bunnyLeft.style.left = '0%';
            bunnyRight.style.right = '0%';

            // Oyunu başlatmak için gerekli kontroller
            if (!leftId || !rightId) {
                showAlert("Oyunu başlatmak için iki öğrenci seçmelisiniz.");
                return;
            }

            // Seçilen öğrencilerin isimlerini göster
            const leftName = currentData[leftId].name;
            const rightName = currentData[rightId].name;
            leftPlayerName.textContent = `${leftName}`;
            rightPlayerName.textContent = `${rightName}`;

            // Yıldızları görünür yap
            resetStars();

            // Oyunu başlatmadan önce Intro Video'yu göster
            introOverlay.style.display = "flex";
            introVideo.play();

            // 15 saniye sonra Intro Video'yu kapatıp oyun ekranını göster
            setTimeout(() => {
                introOverlay.style.display = "none";
                gameOverlay.style.display = "flex";

                // İlk soruyu yükle
                loadNextQuestion(leftId, rightId);
            }, 15000); // 15000 milisaniye = 15 saniye
        }

        // Oyun Kapatma Fonksiyonu
        closeGameBtn.addEventListener("click", () => {
            gameOverlay.style.display = "none";
            // Oyunu sıfırla
            gameQuestions = [];
            currentQuestionIndex = 0;
            leftSteps = 4;
            rightSteps = 4;
            questionText.textContent = "Soru burada olacak";
            leftAnswersDiv.innerHTML = "";
            rightAnswersDiv.innerHTML = "";
            leftPlayerName.textContent = "Seçilmedi";
            rightPlayerName.textContent = "Seçilmedi";
            winnerEffect.style.display = "none";

            // Ekrandaki diğer UI öğelerini yeniden normal hale getir
            document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
                element.style.filter = "none";
                element.style.pointerEvents = "auto";
                element.style.opacity = "1";
                element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
            });
        });

        // Soru Oluşturma Fonksiyonu
        function generateQuestions(count) {
            const questions = [];
            while (questions.length < count) {
                const num1 = getRandomInt(10, 89); // 10 ile 89 arasında
                const num2 = getRandomInt(10, 89); // 10 ile 89 arasında
                if (num1 + num2 <= 99) {
                    questions.push({ num1, num2, answer: num1 + num2 });
                }
            }
            return questions;
        }

        // Rastgele Tam Sayı Alma Fonksiyonu
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Sıradaki Soruyu Yükleme Fonksiyonu
        function loadNextQuestion(leftId, rightId) {
            if (currentQuestionIndex >= gameQuestions.length) {
                endGame(leftId, rightId);
                return;
            }

            const currentQuestion = gameQuestions[currentQuestionIndex];
            questionText.textContent = `Toplam: ${currentQuestion.num1} + ${currentQuestion.num2} = ?`;

            // Şıklar oluşturma
            const correctAnswer = currentQuestion.answer;
            const wrongAnswers = generateWrongAnswers(correctAnswer);
            const allAnswers = shuffleArray([correctAnswer, ...wrongAnswers]);

            // Şıkları sol ve sağ tarafa yerleştirme (şıkları aşağıya çekmek için flex yönünü değiştiriyoruz)
            leftAnswersDiv.innerHTML = "";
            rightAnswersDiv.innerHTML = "";

            allAnswers.forEach(ans => {
                const leftBtn = document.createElement("button");
                leftBtn.textContent = ans;
                leftBtn.classList.add("answer-btn");
                leftBtn.dataset.answer = ans;
                leftBtn.addEventListener("click", () => handleAnswer('left', ans, leftId, rightId));

                const rightBtn = document.createElement("button");
                rightBtn.textContent = ans;
                rightBtn.classList.add("answer-btn");
                rightBtn.dataset.answer = ans;
                rightBtn.addEventListener("click", () => handleAnswer('right', ans, leftId, rightId));

                leftAnswersDiv.appendChild(leftBtn);
                rightAnswersDiv.appendChild(rightBtn);
            });
        }

        // Yanlış Şıklar Oluşturma Fonksiyonu
        function generateWrongAnswers(correct) {
            const wrong = new Set();
            while (wrong.size < 2) { // 3 şık için 2 yanlış şık
                const delta = getRandomInt(1, 10);
                const sign = Math.random() < 0.5 ? -1 : 1;
                const ans = correct + (delta * sign);
                if (ans > 0 && ans !== correct && ans <= 99) {
                    wrong.add(ans);
                }
            }
            return Array.from(wrong);
        }

        // Diziyi Karıştırma Fonksiyonu
        function shuffleArray(array) {
            for (let i = array.length -1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i +1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Yanıtı İşleme Fonksiyonu
        function handleAnswer(side, selectedAnswer, leftId, rightId) {
            const currentQuestion = gameQuestions[currentQuestionIndex];
            const isCorrect = selectedAnswer === currentQuestion.answer;

            if (isCorrect) {
                // Doğru cevap sesini çal
                correctSound.currentTime = 0; // Sesi yeniden başlat
                correctSound.play();

                if (side === 'left') {
                    if (leftSteps > 0) {
                        leftSteps--;
                        updateStars('left', leftSteps);
                        moveBunny('left', leftId, rightId);
                    }
                } else {
                    if (rightSteps > 0) {
                        rightSteps--;
                        updateStars('right', rightSteps);
                        moveBunny('right', leftId, rightId);
                    }
                }
                showFeedback(side, true);
            } else {
                // Yanlış cevap sesini çal
                incorrectSound.currentTime = 0; // Sesi yeniden başlat
                incorrectSound.play();

                if (side === 'left') {
                    if (leftSteps < maxSteps) {
                        leftSteps++;
                        updateStars('left', leftSteps);
                        moveBunny('left', leftId, rightId, false);
                    }
                } else {
                    if (rightSteps < maxSteps) {
                        rightSteps++;
                        updateStars('right', rightSteps);
                        moveBunny('right', leftId, rightId, false);
                    }
                }
                showFeedback(side, false);
            }

            // Şıkları devre dışı bırak
            disableAnswerButtons();

            // Bir süre sonra sonraki soruya geç
            setTimeout(() => {
                currentQuestionIndex++;
                loadNextQuestion(leftId, rightId);
            }, 1000);
        }

        // Yıldızları Güncelleme Fonksiyonu
        function updateStars(side, steps) {
            const starsContainer = side === 'left' ? document.querySelector(".left-stars") : document.querySelector(".right-stars");
            const stars = starsContainer.querySelectorAll(".star");
            stars.forEach((star, index) => {
                if (index < steps) {
                    star.classList.remove("hidden-star");
                } else {
                    star.classList.add("hidden-star");
                }
            });
        }

        // Bunyaları Hareket Ettirme Fonksiyonu
        function moveBunny(side, leftId, rightId, forward=true) {
            const stepPercentage = 8; // Her adımda %8 ilerleme veya geri gitme
            if (side === 'left') {
                let currentLeft = parseFloat(bunnyLeft.style.left) || 0;
                if (forward) {
                    currentLeft += stepPercentage;
                } else {
                    currentLeft -= stepPercentage;
                }
                currentLeft = Math.max(0, Math.min(currentLeft, 40)); // %0 ile %40 arasında
                bunnyLeft.style.left = `${currentLeft}%`;

                // Check if left bunny reached havuç
                if (leftSteps === 0) {
                    const winnerName = currentData[leftId].name;
                    showWinner(`${winnerName} kazandı!`, 'left', leftId, rightId);
                }
            } else if (side === 'right') {
                let currentRight = parseFloat(bunnyRight.style.right) || 0;
                if (forward) {
                    currentRight += stepPercentage;
                } else {
                    currentRight -= stepPercentage;
                }
                currentRight = Math.max(0, Math.min(currentRight, 40)); // %0 ile %40 arasında
                bunnyRight.style.right = `${currentRight}%`;

                // Check if right bunny reached havuç
                if (rightSteps === 0) {
                    const winnerName = currentData[rightId].name;
                    showWinner(`${winnerName} kazandı!`, 'right', leftId, rightId);
                }
            }
        }

        // Şıkları Devre Dışı Bırakma Fonksiyonu
        function disableAnswerButtons() {
            document.querySelectorAll(".answer-btn").forEach(btn => {
                btn.classList.add("disabled");
                btn.disabled = true;
            });
        }

        // Geri Bildirim Gösterme Fonksiyonu
        function showFeedback(side, isCorrect) {
            const feedbackText = isCorrect ? "Doğru!" : "Yanlış!";
            const color = isCorrect ? "#4caf50" : "#f44336";

            const feedbackDiv = document.createElement("div");
            feedbackDiv.textContent = feedbackText;
            feedbackDiv.style.color = color;
            feedbackDiv.style.fontSize = "1.5em";
            feedbackDiv.style.marginTop = "10px";

            if (side === 'left') {
                leftAnswersDiv.appendChild(feedbackDiv);
            } else {
                rightAnswersDiv.appendChild(feedbackDiv);
            }
        }

        // Oyunu Bitirme Fonksiyonu
        function endGame(leftId, rightId) {
            let winner = "";
            if (leftSteps < rightSteps) {
                winner = `${currentData[leftId].name} kazandı!`;
            } else if (rightSteps < leftSteps) {
                winner = `${currentData[rightId].name} kazandı!`;
            } else {
                winner = "Berabere!";
            }

            showWinner(winner, null, leftId, rightId);
        }

        // Kazananı Gösterme Fonksiyonu
        function showWinner(winnerName, side, leftId, rightId) {
            // Kazananın ismini büyük, yeşil renkte göster
            winnerMessage.textContent = `${winnerName}`;
            winnerEffect.style.display = "flex";

            // Kazanan sesi çal
            winnerSound.currentTime = 0; // Sesi yeniden başlat
            winnerSound.play();

            // Ekrandaki diğer UI öğelerini bulanıklaştır ve etkileşimleri devre dışı bırak
            document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
                element.style.filter = "blur(5px)";
                element.style.pointerEvents = "none";
                element.style.opacity = "0.5";
                element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
            });
        }

        // Tekrar Oyna Butonuna Event Listener Ekleme
        playAgainBtn.addEventListener("click", () => {
            winnerEffect.style.display = "none";
            // Kazanan sesi durdur
            winnerSound.pause();
            winnerSound.currentTime = 0;

            // Ekrandaki diğer UI öğelerini yeniden normal hale getir
            document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
                element.style.filter = "none";
                element.style.pointerEvents = "auto";
                element.style.opacity = "1";
                element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
            });

            // Oyunu sıfırla
            gameQuestions = [];
            currentQuestionIndex = 0;
            leftSteps = 4;
            rightSteps = 4;
            questionText.textContent = "Soru burada olacak";
            leftAnswersDiv.innerHTML = "";
            rightAnswersDiv.innerHTML = "";
            leftPlayerName.textContent = "Seçilmedi";
            rightPlayerName.textContent = "Seçilmedi";
            winnerEffect.style.display = "none";

            // Yıldızları görünür yap
            resetStars();

            // Oyun ekranını kapat
            gameOverlay.style.display = "none";

            // Öğrenci seçim modalını göster
            studentSelectionModal.style.display = "flex";
        });

        // Başlangıçta öğrenci seçimlerini doldurmak için fonksiyon
        function populateStudentSelectionModal() {
            // Sol Öğrenci Seçimi
            leftStudentSelectModal.innerHTML = `<option value="">--Seçiniz--</option>`;
            Object.keys(currentData).forEach(id => {
                const option = document.createElement("option");
                option.value = id;
                option.textContent = currentData[id].name;
                leftStudentSelectModal.appendChild(option);
            });

            // Sağ Öğrenci Seçimi
            rightStudentSelectModal.innerHTML = `<option value="">--Seçiniz--</option>`;
            Object.keys(currentData).forEach(id => {
                const option = document.createElement("option");
                option.value = id;
                option.textContent = currentData[id].name;
                rightStudentSelectModal.appendChild(option);
            });
        }

        // Yıldızları Sıfırlama Fonksiyonu
        function resetStars() {
            updateStars('left', leftSteps);
            updateStars('right', rightSteps);
        }
    </script>
</body>
</html>
