<!DOCTYPE html>
<html lang="tr">
<head>

<style>
    /* Ensure Comfortaa font is applied to all elements in Game Area 1 */
    #game-overlay, #game-overlay * {
        font-family: 'Comfortaa', sans-serif !important;
    }
</style>


<style>
    /* Ensure Comfortaa font is applied to all elements in Game Area 2 */
    #game-overlay-2, #game-overlay-2 * {
        font-family: 'Comfortaa', sans-serif !important;
    }
</style>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Şampiyonlar Ligi</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f6f9;
        margin: 0;
        padding: 20px;
        text-align: center;
    }

    h1 {
        font-size: 3.5em;
        font-weight: bold;
        color: #ff4500;
        text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
        margin-bottom: 30px;
    }

    h1 span {
        color: #0078d7;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
    }

    .pin-container, #admin-panel {
        max-width: 400px;
        margin: 20px auto;
        padding: 20px;
        border-radius: 10px;
        background-color: #ffffff;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .pin-container input, .pin-container button, #admin-panel input, #admin-panel button {
        padding: 10px;
        margin: 5px;
        border: 1px solid #ddd;
        border-radius: 5px;
        width: calc(100% - 30px);
        box-sizing: border-box;
    }

    button {
        background-color: #0078d7;
        color: white;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        transition: background 0.3s ease;
        padding: 10px 20px;
        font-size: 1em;
    }

    button:hover {
        background-color: #005bb5;
    }

    #task-table-btn {
        margin-bottom: 20px;
        font-size: 1.2em;
        padding: 12px 20px;
        font-weight: bold;
        display: inline-block;
        background-color: #28a745;
        transition: background 0.3s ease;
        border: none;
        color: white;
    }

    #task-table-btn:hover {
        background-color: #218838;
    }

    .table-container, #task-table-container {
        max-width: 90%;
        margin: 20px auto;
        background-color: #ffffff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s ease-in-out;
        display: none;
    }

    .table-container:hover, #task-table-container:hover {
        transform: scale(1.02);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 1.1em;
        text-align: center;
    }

    th, td {
        padding: 15px;
        border-bottom: 1px solid #ddd;
    }

    th {
        background: linear-gradient(to right, #0078d7, #005bb5);
        color: white;
    }

    #task-table th {
        background: linear-gradient(to right, #28a745, #218838);
        color: white;
    }

    .actions {
        display: none; 
    }

    .edit-mode-enabled .actions {
        display: table-cell; 
    }

    td img {
        width: 65px;
        height: 65px;
        border-radius: 50%;
        object-fit: cover;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    td button {
        margin: 5px;
        padding: 5px 10px;
        font-size: 0.9em;
        border-radius: 5px;
    }

    .button-red {
        background-color: #f44336;
        color: white;
    }

    .button-green {
        background-color: #4caf50;
        color: white;
    }

    .button-update {
        background-color: #ffa500;
        color: white;
    }

    #save-changes {
        display: none;
        margin: 20px auto;
        padding: 10px 20px;
        font-size: 1em;
        background-color: #28a745;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        border: none;
    }

    #save-changes:hover {
        background-color: #218838;
    }

    #class-selection {
        margin-bottom: 20px;
    }

    @keyframes wave {
        0% {
            background-position: 0% 0%;
        }
        50% {
            background-position: 100% 100%;
        }
        100% {
            background-position: 0% 0%;
        }
    }

    .top-1 {
        background: linear-gradient(135deg, 
            #FFD700 0%, 
            #FFE033 20%, 
            #FFD700 40%, 
            #FFE033 60%, 
            #FFD700 80%, 
            #FFE033 100%
        );
        background-size: 400% 400%;
        animation: wave 5s linear infinite;
    }

    .top-2 {
        background: linear-gradient(135deg, 
            #FFE033 0%, 
            #FFF1A8 20%, 
            #FFE033 40%, 
            #FFF1A8 60%, 
            #FFE033 80%, 
            #FFF9C4 100%
        );
        background-size: 400% 400%;
        animation: wave 5s linear infinite;
    }

    .top-3 {
        background: linear-gradient(135deg, 
            #FFF1A8 0%, 
            #FFF9C4 20%, 
            #FFF1A8 40%, 
            #FFF9C4 60%, 
            #FFF1A8 80%, 
            #FFF9C4 100%
        );
        background-size: 400% 400%;
        animation: wave 5s linear infinite;
    }

    #lucky-student-btn {
        margin-bottom: 10px;
        font-size: 1.2em;
        padding: 12px 20px;
        font-weight: bold;
        display: inline-block;
    }

    #lucky-student-result {
        margin-bottom: 10px;
        font-weight: bold;
        font-size: 2em;
        color: #0078d7;
        text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
        animation: pulse 1.5s infinite alternate;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        100% { transform: scale(1.1); }
    }

    .score-display {
        position: relative;
        padding-left: 20px;
    }

    .score-display::before {
        content: "+";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        color: #4caf50;
        font-weight: bold;
        animation: plusBlink 1s infinite alternate;
    }

    @keyframes plusBlink {
        0% { opacity: 1; transform: translateY(-50%) scale(1); }
        100% { opacity: 0; transform: translateY(-50%) scale(1.5); }
    }

    #reset-lucky {
        margin-left: 10px;
        padding: 12px 15px;
        font-size: 1.2em;
        display: inline-block;
        position: relative;
        overflow: hidden;
        background-color: #0078d7;
        border: none;
        border-radius: 5px;
        color: white;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    #reset-lucky::before {
        content: "↻";
        display: inline-block;
        font-size: 1.4em;
        transform: rotate(0deg);
        transition: transform 0.5s ease;
    }

    #reset-lucky:hover {
        background-color: #005bb5;
    }

    #reset-lucky:hover::before {
        transform: rotate(360deg);
    }

    dialog {
        border: none;
        border-radius: 8px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        padding: 20px;
        max-width: 400px;
        width: 90%;
        text-align: center;
    }

    #modal-content p {
        margin-bottom: 20px;
        font-size: 1.2em;
    }

    #modal-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
    }

    #modal-buttons button {
        padding: 10px 20px;
        font-size: 1em;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    #modal-buttons .ok-btn {
        background-color: #0078d7;
        color: white;
    }

    #modal-buttons .cancel-btn {
        background-color: #6c757d;
        color: white;
    }

    #modal-buttons .confirm-btn {
        background-color: #28a745;
        color: white;
    }

    #modal-input {
        width: 100%;
        padding: 10px;
        margin-bottom: 20px;
        font-size: 1em;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
    }

    #task-table-container {
        max-width: 90%;
        margin: 20px auto;
        background-color: #ffffff;
        border: 3px solid #28a745;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s ease-in-out;
        display: none;
    }

    #task-table-container:hover {
        transform: scale(1.02);
    }

    #task-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 1.1em;
        text-align: center;
    }

    #task-table th, #task-table td {
        padding: 15px;
        border-bottom: 1px solid #ddd;
    }

    #task-table th {
        background: linear-gradient(to right, #28a745, #218838);
        color: white;
    }

    .highlighted {
        position: relative;
        animation: glow 2s infinite;
        border: 2px solid #FFD700;
        border-radius: 10px;
        padding: 10px;
    }

    @keyframes glow {
        0% {
            box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700;
        }
        50% {
            box-shadow: 0 0 20px #FFD700, 0 0 30px #FFD700, 0 0 40px #FFD700;
        }
        100% {
            box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700;
        }
    }

    .edit-button {
        background-color: #0078d7;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .edit-button:hover {
        background-color: #005bb5;
    }

    #add-task-btn {
        background-color: #17a2b8;
        margin-top: 10px;
        display: none;
    }

    #add-task-btn:hover {
        background-color: #138496;
    }

    .delete-task-btn {
        background-color: #dc3545;
    }

    .delete-task-btn:hover {
        background-color: #c82333;
    }

    .edit-task-btn {
        background-color: #ffc107;
        margin-right: 5px;
    }

    .edit-task-btn:hover {
        background-color: #e0a800;
    }

    .checkbox-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 20px;
    }

    .checkbox-item {
        display: flex;
        align-items: center;
        width: 45%;
    }

    .checkbox-item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
    }

    .checkbox-item label {
        flex: 1;
        text-align: left;
    }

    .editable-button {
        display: none;
    }

    .edit-mode-enabled .editable-button {
        display: inline-block;
    }

    @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        50% { transform: translateX(5px); }
        75% { transform: translateX(-5px); }
        100% { transform: translateX(0); }
    }

    #champion-competition-btn, #champion-settings-btn {
        font-size: 1.2em;
        font-weight: bold;
        margin: 20px 10px;
        background-color: #ff9800; 
        color: #343a40; 
        transition: all 0.3s ease; 
        border: none; 
        padding: 15px 20px; 
        border-radius: 10px; 
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        cursor: pointer; 
    }

    #champion-competition-btn:hover {
        animation: shake 0.5s ease-in-out; 
        background-color: #e68a00; 
        color: #fff; 
        transform: scale(1.1); 
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); 
    }

    #champion-settings-btn {
        background-color: #ff9800;
    }

    #champion-settings-btn:hover {
        background-color: #e68a00;
    }

    #champion-modal-content select, #champion-modal-content button {
        margin: 10px 0;
    }

    #champion-modal-content {
        text-align: center;
    }

    #settings-modal-content {
        max-height: 500px;
        overflow-y: auto;
        text-align: left;
    }

    #settings-nav {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 10px;
    }

    #settings-nav button {
        background: #0078d7;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px;
        cursor: pointer;
    }

    #settings-nav button:hover {
        background: #005bb5;
    }

    .settings-section {
        margin-bottom: 20px;
        display: none;
    }

    .settings-section.active {
        display: block;
    }

    .settings-section h3 {
        margin-bottom: 10px;
        text-align: center;
    }

    .settings-section input, .settings-section button, .settings-section select {
        display: block;
        margin: 5px auto;
        padding: 5px;
        width: 80%;
    }

    .heading-list, .lesson-list, .topic-list, .question-list {
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
    }

    .heading-item, .lesson-item, .topic-item, .question-item {
        margin-bottom: 5px;
    }

    .item-actions button {
        margin-left: 5px;
    }

    body.game-mode {
        overflow: hidden; 
    }

    #intro-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        display: none; 
        justify-content: center;
        align-items: center;
        z-index: 4000;
    }

    #intro-video {
        width: 150%;
        height: auto;
        max-width: 2200px;
        border-radius: 10px;
    }

    /* GAME OVERLAY 1 */
    #game-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('https://cdn.pixabay.com/photo/2024/05/21/17/36/fairytale-woods-8778691_1280.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 3000;
    }

    #game-container {
        background-color: rgba(255, 255, 255, 0.95);
        width: 90%;
        max-width: 1200px;
        height: 90%;
        border-radius: 10px;
        position: relative;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transform-origin: center center;
    }

    #close-game-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        cursor: pointer;
        font-size: 1.2em;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001;
    }

    #close-game-btn:hover {
        background-color: #d32f2f;
    }

    #question-area {
        position: relative;
        width: 100%;
        height: 300px;
        margin-bottom: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #question-text {
        position: absolute;
        top: 135%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        text-align: center;
        font-size: 2.5em;
        font-weight: bold;
        color: #000000;
        text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
        animation: fadeIn 1s;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    #bunny-left, #bunny-right, #carrot {
        position: absolute;
        top: 0;
        width: 155px;
        height: 105px;
        max-width: 100%;
        height: auto;
    }

    #bunny-left {
        left: 0%;
        transition: left 0.5s ease;
    }

    #bunny-right {
        right: 0%;
        transition: right 0.5s ease;
    }

    #carrot {
        left: 50%;
        transform: translateX(-50%);
    }

    .left-stars, .right-stars {
        position: absolute;
        top: 10%;
        display: flex;
        gap: 20px;
        transform: translateY(-50%);
    }

    .left-stars {
        left: 11%;
        flex-direction: row-reverse;
    }

    .right-stars {
        right: 11%;
        flex-direction: row;
    }

    .star {
        width: 80px;
        height: 80px;
        max-width: 100%;
        height: auto;
    }

    .hidden-star {
        visibility: hidden;
    }

    #game-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        height: 100%;
    }

    #game-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        position: relative;
        width: 100%;
        height: 100%;
        margin-top: 20px;
    }

    .player-section {
        width: 45%;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 20px;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .player-name {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .answers {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        width: 100%;
        justify-content: center;
        margin-top: 10px;
    }

    .answer-btn {
        padding: 10px 20px;
        background-color: #00b3ff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        flex: 1 1 30%;
        transition: background 0.3s ease;
        font-size: 1.2em;
    }

    .answer-btn:hover {
        background-color: #00a3e0;
    }

    .disabled {
        pointer-events: none;
        opacity: 0.6;
    }

    #winner-effect {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-image: url('https://github.com/d4rkd4/winnerarkaplan/blob/main/Yeni-projewinner-arka.gif?raw=true');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        color: #00FFFF; 
        font-family: 'Arial Black', Arial, sans-serif; 
        font-weight: bold; 
        font-size: 4em; 
        letter-spacing: 1px; 
        text-shadow: 3px 3px 12px rgba(0, 0, 0, 0.7); 
        padding: 100px 180px;
        border-radius: 15px;
        animation: popIn 1s, flash 2s infinite;
        z-index: 5000;
        display: none;
        box-shadow: 0 0 50px #66FFFF;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    @keyframes flash {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
    }

    @keyframes popIn {
        0% {
            transform: translate(-50%, -50%) scale(0.5);
            opacity: 0;
        }
        50% {
            transform: translate(-50%, -50%) scale(1.2);
            opacity: 1;
        }
        100% {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
    }

    #play-again-btn {
        margin-top: 20px;
        padding: 3px 6px;
        background-color: #00FF33;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.5em;
        transition: background 0.3s ease;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    #play-again-btn:hover {
        background-color: #104E8B;
    }

    .editable-button {
        display: none;
    }

    .edit-mode-enabled .editable-button {
        display: inline-block;
    }

    #question-text, .answer-btn {
        font-family: 'Comfortaa', sans-serif;
    }

    /* Ölçeklendirme slider için stil */
    #scale-slider-container {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 8px;
        z-index: 2000;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #fff;
        font-weight: bold;
    }

    #scale-slider {
        width: 100px;
    }

    /* ------------------- OYUN ALANI 2 (KOPYALAMA) ------------------ */
    #game-overlay-2 {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('https://upload.wikimedia.org/wikipedia/commons/8/80/Backgorund.gif');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 3000;
    }

    #game-container-2 {
        background-color: rgba(255, 255, 255, 0.95);
        width: 90%;
        max-width: 1200px;
        height: 90%;
        border-radius: 10px;
        position: relative;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transform-origin: center center;
    }

    #close-game-btn-2 {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        cursor: pointer;
        font-size: 1.2em;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001;
    }

    #close-game-btn-2:hover {
        background-color: #d32f2f;
    }

    #question-area-2 {
        position: relative;
        width: 100%;
        height: 300px;
        margin-bottom: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #question-text-2 {
        position: absolute;
        top: 135%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        text-align: center;
        font-size: 2.5em;
        font-weight: bold;
        color: #000000;
        text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
        animation: fadeIn 1s;
    }

    #bunny-left-2, #bunny-right-2, #carrot-2 {
        position: absolute;
        top: 0;
        width: 175px;
        height: 125px;
        max-width: 140%;
        height: auto;
    }

    #bunny-left-2 {
        left: 0%;
        transition: left 0.5s ease;
    }

    #bunny-right-2 {
        right: 0%;
        transition: right 0.5s ease;
    }

    #carrot-2 {
        left: 50%;
        transform: translateX(-50%);
    }

    .left-stars-2, .right-stars-2 {
        position: absolute;
        top: 10%;
        display: flex;
        gap: 20px;
        transform: translateY(-50%);
    }

    .left-stars-2 {
        left: 11%;
        flex-direction: row-reverse;
    }

    .right-stars-2 {
        right: 11%;
        flex-direction: row;
    }

    .star-2 {
        width: 80px;
        height: 80px;
        max-width: 100%;
        height: auto;
    }

    .hidden-star-2 {
        visibility: hidden;
    }

    #game-body-2 {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        height: 100%;
    }

    #game-content-2 {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        position: relative;
        width: 100%;
        height: 100%;
        margin-top: 20px;
    }

    .player-section-2 {
        width: 45%;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 20px;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .player-name-2 {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .answers-2 {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        width: 100%;
        justify-content: center;
        margin-top: 10px;
    }

    .answer-btn-2 {
        padding: 10px 20px;
        background-color: #00b3ff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        flex: 1 1 30%;
        transition: background 0.3s ease;
        font-size: 1.2em;
    }

    .answer-btn-2:hover {
        background-color: #00a3e0;
    }

    .disabled-2 {
        pointer-events: none;
        opacity: 0.6;
    }

    /* Ölçeklendirme slider (2.oyun alanı için de kullanabilir) */
    #scale-slider-container-2 {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 8px;
        z-index: 2000;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #fff;
        font-weight: bold;
    }

    #scale-slider-2 {
        width: 100px;
    }

    /* Second game area winner effect styling */
    #winner-effect-2 {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-image: url('https://raw.githubusercontent.com/d4rkd4/winnerarkaplan/refs/heads/main/Yeni-proje.gif');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        color: #ACED39; 
        font-family: 'Arial Black', Arial, sans-serif; 
        font-weight: bold; 
        font-size: 4em; 
        letter-spacing: 1px; 
        text-shadow: 3px 3px 12px rgba(0, 0, 0, 0.7); 
        padding: 100px 180px;
        border-radius: 15px;
        animation: popIn 1s, flash 2s infinite;
        z-index: 5000;
        display: none;
        box-shadow: 0 0 50px #00eeff;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
</style>

    </head>
    
<body>
    <h1>Şampiyonlar <span>+</span> Ligi</h1>
    <div id="class-selection">
        <label for="class-select">Sınıf Seçin:</label>
        <select id="class-select">
            <option value="">--Sınıf Seçin--</option>
        </select>
    </div>

    <button id="task-table-btn" style="display:none;">Görevli Tablosu</button>
    <div id="task-table-container">
        <table id="task-table">
            <thead>
                <tr>
                    <th>Görev</th>
                    <th>Öğrenci</th>
                    <th class="actions">İşlem</th>
                </tr>
            </thead>
            <tbody>
                <tr id="head-of-week-row" class="highlighted">
                    <td>Sınıf Başkanı</td>
                    <td id="head-of-week">Belirlenmedi</td>
                    <td class="actions">
                        <button class="edit-button" id="edit-head">Düzenle</button>
                    </td>
                </tr>
                <tr id="duty-students-row">
                    <td>Nöbetçi Öğrenciler</td>
                    <td id="duty-students">Belirlenmedi</td>
                    <td class="actions">
                        <button class="edit-button" id="edit-duty-students">Düzenle</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <button id="add-task-btn">Görev Ekle</button>
    </div>

    <button id="lucky-student-btn" style="display:none;">Şanslı Öğrenci Seç</button>
    <button id="reset-lucky" style="display:none;" title="Şanslı seçimleri sıfırla"></button>
    <div id="lucky-student-result"></div>

    <button id="edit-mode" style="display:none;">Düzenle</button>
    <div class="pin-container" id="pin-check" style="display: none;">
        <input type="password" id="pin" placeholder="PIN Girin">
        <button id="pin-submit">Doğrula</button>
    </div>
    <div id="admin-panel" style="display: none;">
        <h2>Öğrenci Ekle</h2>
        <input type="text" id="student-name" placeholder="Öğrenci Adı">
        <input type="text" id="photo-url" placeholder="Fotoğraf URL'si (Opsiyonel)">
        <button id="add-student">Öğrenci Ekle</button>
    </div>
    <button id="save-changes">Kaydet</button>
    <div class="table-container" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Fotoğraf</th>
                    <th>İsim</th>
                    <th>Genel Puan</th>
                    <th class="actions">İşlemler</th>
                </tr>
            </thead>
            <tbody id="student-table">
            </tbody>
        </table>
    </div>

    <dialog id="modal">
        <div id="modal-content">
            <p id="modal-message"></p>
            <div id="checkbox-container" class="checkbox-container" style="display: none;"></div>
            <input type="text" id="modal-input" style="display:none;" />
            <div id="modal-buttons">
                <button class="ok-btn">OK</button>
                <button class="cancel-btn" style="display:none;">Cancel</button>
                <button class="confirm-btn" style="display:none;">Confirm</button>
            </div>
        </div>
    </dialog>

    <button id="champion-competition-btn" style="display:none;">🥇Şampiyon Mücadelesi🥇 (AKILLI TAHTA) </button>
    <button id="champion-settings-btn" style="display:none;">⚙</button>

    <dialog id="champion-modal">
        <div id="champion-modal-content">
            <h3>Şampiyon Mücadelesi</h3>
            <select id="heading-select"><option value="">Sınıf Seç</option></select>
            <select id="lesson-select"><option value="">Ders Seç</option></select>
            <select id="topic-select"><option value="">Konu Seç</option></select>
            <select id="player1-select"><option value="">Oyuncu 1 Seç</option></select>
            <select id="player2-select"><option value="">Oyuncu 2 Seç</option></select>
            <select id="game-area-select">
                <option value="1">Oyun Alanı 1</option>
                <option value="2">Oyun Alanı 2</option>
            </select>
            <button id="start-game-btn">Oyna</button>
            <button id="close-champion-modal">Kapat</button>
        </div>
    </dialog>

    <dialog id="settings-modal">
        <div id="settings-modal-content">
            <div id="settings-nav">
                <button data-section="heading-section">Sınıflar</button>
                <button data-section="lesson-section">Dersler</button>
                <button data-section="topic-section">Konular</button>
                <button data-section="question-section">Sorular</button>
            </div>

            <div class="settings-section" id="heading-section">
                <h3>Sınıflar</h3>
                <input type="text" id="new-heading-name" placeholder="Yeni Sınıf Adı">
                <button id="add-heading-btn">Sınıf Ekle</button>
                <div class="heading-list"></div>
            </div>

            <div class="settings-section" id="lesson-section">
                <h3>Dersler</h3>
                <select id="heading-for-lesson"></select>
                <input type="text" id="new-lesson-name" placeholder="Yeni Ders Adı">
                <button id="add-lesson-btn">Ders Ekle</button>
                <div class="lesson-list"></div>
            </div>

            <div class="settings-section" id="topic-section">
                <h3>Konular</h3>
                <select id="lesson-for-topic"></select>
                <input type="text" id="new-topic-name" placeholder="Yeni Konu Adı">
                <button id="add-topic-btn">Konu Ekle</button>
                <div class="topic-list"></div>
            </div>

            <div class="settings-section" id="question-section">
                <h3>Sorular</h3>
                <select id="lesson-for-question"></select>
                <select id="topic-for-question"></select>
                <input type="text" id="new-question-text" placeholder="Soru Metni veya Resim URL'si">
                <input type="text" id="new-question-correct" placeholder="Doğru Cevap">
                <input type="text" id="new-question-wrong1" placeholder="Yanlış Cevap 1">
                <input type="text" id="new-question-wrong2" placeholder="Yanlış Cevap 2">
                <button id="add-question-btn">Soru Ekle</button>
                <div class="question-list"></div>
            </div>

            <button id="close-settings-modal">Kapat</button>
        </div>
    </dialog>

    <div id="intro-overlay">
        <video id="intro-video" src="https://github.com/d4rkd4/G-R-V-DE/raw/refs/heads/main/BA%C5%9ELA.mp4"></video>
    </div>

    <!-- Orijinal Oyun Alanı -->
    <div id="game-overlay">
        <div id="scale-slider-container">
            <label for="scale-slider">Ölçek:</label>
            <input type="range" id="scale-slider" min="0.5" max="2" step="0.01" value="1">
        </div>

        <div id="game-container">
            <button id="close-game-btn">X</button>
            <div id="question-area">
                <img src="https://cdn.pixabay.com/animation/2024/02/23/15/15/15-15-50-56_512.gif" alt="Tavşan Sol" id="bunny-left">
                <div class="left-stars">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star left-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                </div>
                <img src="https://media4.giphy.com/media/ZzPjgVE12gU54wIVtf/giphy.webp" alt="Havuç" id="carrot">
                <div class="right-stars">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                    <img class="star right-star" src="https://cdn.pixabay.com/animation/2024/05/09/14/36/14-36-39-632_512.gif" alt="Star">
                </div>
                <img src="https://cdn.pixabay.com/animation/2024/02/23/15/15/15-15-50-56_512.gif" alt="Tavşan Sağ" id="bunny-right">
                <div id="question-text">Soru burada olacak</div>
            </div>
            <div id="game-body">
                <div id="game-content">
                    <div class="player-section" id="left-panel">
                        <div class="player-name" id="left-player-name">Oyuncu 1</div>
                        <div id="left-answers" class="answers"></div>
                    </div>
                    <div class="player-section" id="right-panel">
                        <div class="player-name" id="right-player-name">Oyuncu 2</div>
                        <div id="right-answers" class="answers"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- İkinci Oyun Alanı -->
    <div id="game-overlay-2">
        <div id="scale-slider-container-2">
            <label for="scale-slider-2">Ölçek:</label>
            <input type="range" id="scale-slider-2" min="0.5" max="2" step="0.01" value="1">
        </div>

        <div id="game-container-2">
            <button id="close-game-btn-2">X</button>
            <div id="question-area-2">
                <img src="https://cdn.pixabay.com/animation/2024/04/27/19/29/19-29-06-468_512.gif" alt="Tavşan Sol" id="bunny-left-2">
                <div class="left-stars-2">
                    <img class="star-2 left-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                    <img class="star-2 left-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                    <img class="star-2 left-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                    <img class="star-2 left-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                </div>
                <img src="https://cdn.pixabay.com/animation/2024/05/02/06/07/06-07-23-815_512.gif" alt="Havuç" id="carrot-2">
                <div class="right-stars-2">
                    <img class="star-2 right-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                    <img class="star-2 right-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                    <img class="star-2 right-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                    <img class="star-2 right-star-2" src="https://cdn.pixabay.com/animation/2024/03/11/09/49/09-49-12-_512.gif" alt="Star">
                </div>
                <img src="https://cdn.pixabay.com/animation/2024/04/27/19/29/19-29-06-468_512.gif" alt="Tavşan Sağ" id="bunny-right-2">
                <div id="question-text-2">Soru burada olacak</div>
            </div>
            <div id="game-body-2">
                <div id="game-content-2">
                    <div class="player-section-2" id="left-panel-2">
                        <div class="player-name-2" id="left-player-name-2">Oyuncu 1</div>
                        <div id="left-answers-2" class="answers-2"></div>
                    </div>
                    <div class="player-section-2" id="right-panel-2">
                        <div class="player-name-2" id="right-player-name-2">Oyuncu 2</div>
                        <div id="right-answers-2" class="answers-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="winner-effect">
        <div id="winner-message">Kazanan: Oyuncu</div>
        <button id="play-again-btn">↻ Tekrar Oyna</button>

<script>
    // 1. stopAllMusic Fonksiyonunu Tanımla
    function stopAllMusic() {
        const audios = document.querySelectorAll("audio");
        audios.forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });
    }

    // 2. Tüm "Tekrar Oyna" Butonlarını Seç ve Event Listener Ekle
    const playAgainButtons = document.querySelectorAll("#play-again-btn, #play-again-btn-2");

    playAgainButtons.forEach(button => {
        button.addEventListener("click", () => {
            stopAllMusic();
            // 3. Kazanan Ekranlarını Gizle
            document.querySelectorAll(".winner-effect, #winner-effect-2").forEach(effect => {
                effect.style.display = "none";
            });
            // 4. Sayfa Stillerini Sıfırla
            document.querySelectorAll("body > *:not(.winner-effect):not(#winner-effect-2)").forEach(element => {
                element.style.filter = "none";
                element.style.pointerEvents = "auto";
                element.style.opacity = "1";
                element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
            });
        });
    });
</script>
</div>

<!-- Ses Dosyaları -->
<audio id="correct-sound" src="https://github.com/d4rkd4/audio-assets/raw/3925758c22f90c4e9ac2b81bf41a65fd8c8d85be/new-level-142995.mp3" preload="auto"></audio>
<audio id="incorrect-sound" src="https://github.com/d4rkd4/audio-assets/raw/3925758c22f90c4e9ac2b81bf41a65fd8c8d85be/fail-234710.mp3" preload="auto"></audio>
<audio id="winner-sound" src="https://github.com/d4rkd4/audio-assets/raw/refs/heads/main/finish%20k%C4%B1sa.mp3" preload="auto"></audio>
<audio id="background-music" src="https://github.com/d4rkd4/winnerarkaplan/raw/refs/heads/main/soru%20arka.mp3" loop></audio>

<script type="module">
    function showWinner2(winnerName) {
        const winnerEffect2 = document.getElementById("winner-effect-2");
        const winnerMessage2 = document.getElementById("winner-message-2");
        winnerMessage2.textContent = `${winnerName} kazandı!`;
        winnerEffect2.style.display = "flex";

        // 1. winner-sound'u Oynat
        const winnerSound = document.getElementById("winner-sound");
        if (winnerSound) {
            winnerSound.currentTime = 0;
            winnerSound.play();
        }

        // 2. Sayfa Stillerini Uygula
        document.querySelectorAll("body > *:not(#winner-effect-2)").forEach(element => {
            element.style.filter = "blur(5px)";
            element.style.pointerEvents = "none";
            element.style.opacity = "0.5";
            element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
        });
    }

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, set, get, remove } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "sampiyonlar-ligi.firebaseapp.com",
        databaseURL: "https://sampiyonlar-ligi-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "sampiyonlar-ligi",
        storageBucket: "sampiyonlar-ligi.appspot.com",
        messagingSenderId: "248285384149",
        appId: "1:248285384149:web:39116a8e31ef61d16f815c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const classSelect = document.getElementById("class-select");
    const editModeButton = document.getElementById("edit-mode");
    const pinCheck = document.getElementById("pin-check");
    const adminPanel = document.getElementById("admin-panel");
    const saveChangesButton = document.getElementById("save-changes");
    const studentTable = document.getElementById("student-table");
    const tableContainer = document.querySelector(".table-container");

    const pinInput = document.getElementById("pin");
    const pinSubmit = document.getElementById("pin-submit");
    const addStudentButton = document.getElementById("add-student");
    const studentNameInput = document.getElementById("student-name");
    const photoUrlInput = document.getElementById("photo-url");

    const luckyStudentBtn = document.getElementById("lucky-student-btn");
    const luckyStudentResult = document.getElementById("lucky-student-result");
    const resetLuckyBtn = document.getElementById("reset-lucky");

    const taskTableBtn = document.getElementById("task-table-btn");
    const taskTableContainer = document.getElementById("task-table-container");
    const headOfWeekCell = document.getElementById("head-of-week");
    const editHeadButton = document.getElementById("edit-head");
    const dutyStudentsCell = document.getElementById("duty-students");
    const editDutyStudentsButton = document.getElementById("edit-duty-students"); 
    const addTaskBtn = document.getElementById("add-task-btn");

    const modal = document.getElementById("modal");
    const modalMessage = document.getElementById("modal-message");
    const modalButtons = document.getElementById("modal-buttons");
    const modalInput = document.getElementById("modal-input");
    const okBtn = document.querySelector(".ok-btn");
    const cancelBtn = document.querySelector(".cancel-btn");
    const confirmBtn = document.querySelector(".confirm-btn");
    const checkboxContainer = document.getElementById("checkbox-container");

    const championCompetitionBtn = document.getElementById("champion-competition-btn");
    const championModal = document.getElementById("champion-modal");
    const headingSelect = document.getElementById("heading-select");
    const lessonSelect = document.getElementById("lesson-select");
    const topicSelect = document.getElementById("topic-select");
    const player1Select = document.getElementById("player1-select");
    const player2Select = document.getElementById("player2-select");
    const startGameBtn = document.getElementById("start-game-btn");
    const closeChampionModalBtn = document.getElementById("close-champion-modal");
    const gameAreaSelect = document.getElementById("game-area-select");

    const championSettingsBtn = document.getElementById("champion-settings-btn");
    const settingsModal = document.getElementById("settings-modal");
    const closeSettingsModalBtn = document.getElementById("close-settings-modal");

    const headingSection = document.getElementById("heading-section");
    const lessonSection = document.getElementById("lesson-section");
    const topicSection = document.getElementById("topic-section");
    const questionSection = document.getElementById("question-section");

    const newHeadingNameInput = document.getElementById("new-heading-name");
    const addHeadingBtn = document.getElementById("add-heading-btn");
    const headingListDiv = headingSection.querySelector(".heading-list");

    const headingForLessonSelect = document.getElementById("heading-for-lesson");
    const newLessonNameInput = document.getElementById("new-lesson-name");
    const addLessonBtn = document.getElementById("add-lesson-btn");
    const lessonListDiv = lessonSection.querySelector(".lesson-list");

    const lessonForTopicSelect = document.getElementById("lesson-for-topic");
    const newTopicNameInput = document.getElementById("new-topic-name");
    const addTopicBtn = document.getElementById("add-topic-btn");
    const topicListDiv = topicSection.querySelector(".topic-list");

    const lessonForQuestionSelect = document.getElementById("lesson-for-question");
    const topicForQuestionSelect = document.getElementById("topic-for-question");
    const newQuestionTextInput = document.getElementById("new-question-text");
    const newQuestionCorrectInput = document.getElementById("new-question-correct");
    const newQuestionWrong1Input = document.getElementById("new-question-wrong1");
    const newQuestionWrong2Input = document.getElementById("new-question-wrong2");
    const addQuestionBtn = document.getElementById("add-question-btn");
    const questionListDiv = questionSection.querySelector(".question-list");

    const settingsNav = document.getElementById("settings-nav");
    const settingsSections = [headingSection, lessonSection, topicSection, questionSection];

    let currentClass = "";
    let currentClassPin = "";
    let currentData = {};
    let pendingChanges = {}; 
    const defaultPhotoURL = "https://cdn.pixabay.com/photo/2013/07/13/13/42/tux-161406_1280.png";

    let availableStudents = [];
    let championHeadings = {}; 
    let selectedHeadingId = "";
    let championSettingsPin = "817641";

    let currentSelectedHeadingForLesson = "";
    let currentSelectedLessonForTopic = "";
    let currentSelectedLessonForQuestion = "";
    let currentSelectedTopicForQuestion = "";

    function showAlert(message) {
        return new Promise((resolve) => {
            modalMessage.textContent = message;
            modalInput.style.display = "none";
            checkboxContainer.style.display = "none";
            cancelBtn.style.display = "none";
            confirmBtn.style.display = "none";
            okBtn.style.display = "inline-block";
            okBtn.textContent = "OK";
            modal.showModal();

            okBtn.onclick = () => {
                modal.close();
                resolve();
            };
        });
    }

    function showPrompt(message, type='text') {
        return new Promise((resolve) => {
            modalMessage.textContent = message;
            modalInput.style.display = "block";
            modalInput.value = "";
            modalInput.type = type;
            checkboxContainer.style.display = "none";
            cancelBtn.style.display = "inline-block";
            confirmBtn.style.display = "none";
            okBtn.style.display = "inline-block";
            okBtn.textContent = "OK";
            modal.showModal();

            okBtn.onclick = () => {
                const inputValue = modalInput.value;
                modal.close();
                resolve(inputValue);
            };

            cancelBtn.onclick = () => {
                modal.close();
                resolve(null);
            };
        });
    }

    function showConfirm(message) {
        return new Promise((resolve) => {
            modalMessage.textContent = message;
            modalInput.style.display = "none";
            checkboxContainer.style.display = "none";
            cancelBtn.style.display = "inline-block";
            confirmBtn.style.display = "inline-block";
            okBtn.style.display = "none";
            modal.showModal();

            confirmBtn.onclick = () => {
                modal.close();
                resolve(true);
            };

            cancelBtn.onclick = () => {
                modal.close();
                resolve(false);
            };
        });
    }

    async function loadClasses() {
        try {
            const classesRef = ref(db, 'classes');
            const snapshot = await get(classesRef);
            if (snapshot.exists()) {
                const data = snapshot.val();
                while (classSelect.options.length > 1) {
                    classSelect.remove(1);
                }
                for (let classKey in data) {
                    const option = document.createElement("option");
                    option.value = classKey;
                    option.textContent = classKey;
                    classSelect.appendChild(option);
                }

            } else {
                await showAlert("Hiç sınıf yok.");
            }
        } catch (error) {
            console.error("Error loading classes:", error);
            await showAlert("Sınıflar yüklenirken bir hata oluştu.");
        }
    }

    loadClasses();

    async function loadChampionData() {
        const headingsRef = ref(db, 'championData/headings');
        const snapshot = await get(headingsRef);
        if (snapshot.exists()) {
            championHeadings = snapshot.val();
        } else {
            championHeadings = {};
        }
        renderHeadings();
        populateHeadingSelect();
        updateHeadingForLessonSelect();
    }

    function renderHeadings() {
        headingListDiv.innerHTML = "";
        for (let hId in championHeadings) {
            const div = document.createElement("div");
            div.className = "heading-item";
            div.textContent = championHeadings[hId].name;

            const actions = document.createElement("div");
            actions.className = "item-actions";

            const editBtn = document.createElement("button");
            editBtn.textContent = "Düzenle";
            editBtn.addEventListener("click", async () => {
                const newName = prompt("Yeni sınıf adı:", championHeadings[hId].name);
                if (newName) {
                    await update(ref(db, `championData/headings/${hId}`), {name:newName});
                    await loadChampionData();
                    restoreSelectionAfterDataLoad();
                }
            });

            const delBtn = document.createElement("button");
            delBtn.textContent = "Sil";
            delBtn.addEventListener("click", async () => {
                const confirmDel = confirm("Bu başlığı silmek istediğinize emin misiniz? Tüm dersler, konular ve sorular da silinir!");
                if (confirmDel) {
                    await remove(ref(db, `championData/headings/${hId}`));
                    await loadChampionData();
                    restoreSelectionAfterDataLoad();
                }
            });

            actions.appendChild(editBtn);
            actions.appendChild(delBtn);
            div.appendChild(actions);
            headingListDiv.appendChild(div);
        }

        if (Object.keys(championHeadings).length > 0) {
            lessonSection.style.display = "block";
        } else {
            lessonSection.style.display = "none";
            topicSection.style.display = "none";
            questionSection.style.display = "none";
        }
    }

    addHeadingBtn.addEventListener("click", async () => {
        const headingName = newHeadingNameInput.value.trim();
        if (!headingName) {
            alert("Sınıf adı girin.");
            return;
        }
        const newRef = push(ref(db, 'championData/headings'));
        await set(newRef, {
            name: headingName
        });
        newHeadingNameInput.value = "";
        await loadChampionData();
        restoreSelectionAfterDataLoad();
    });

    function populateHeadingSelect() {
        headingSelect.innerHTML = '<option value="">Sınıf Seç</option>';
        for (let hId in championHeadings) {
            const opt = document.createElement("option");
            opt.value = hId;
            opt.textContent = championHeadings[hId].name;
            headingSelect.appendChild(opt);
        }
    }

    headingSelect.addEventListener("change", () => {
        selectedHeadingId = headingSelect.value;
        updateLessonSelect();
    });

    function updateLessonSelect() {
        lessonSelect.innerHTML = '<option value="">Ders Seç</option>';
        if (selectedHeadingId && championHeadings[selectedHeadingId].lessons) {
            const lessons = championHeadings[selectedHeadingId].lessons;
            for (let lId in lessons) {
                const opt = document.createElement("option");
                opt.value = lId;
                opt.textContent = lessons[lId].name;
                lessonSelect.appendChild(opt);
            }
        }
        updateTopicSelect();
    }

    lessonSelect.addEventListener("change", () => {
        updateTopicSelect();
    });

    function updateTopicSelect() {
        topicSelect.innerHTML = '<option value="">Konu Seç</option>';
        const selectedLessonId = lessonSelect.value;
        if (selectedHeadingId && selectedLessonId && championHeadings[selectedHeadingId].lessons && championHeadings[selectedHeadingId].lessons[selectedLessonId].topics) {
            const topics = championHeadings[selectedHeadingId].lessons[selectedLessonId].topics;
            for (let topicId in topics) {
                const opt = document.createElement("option");
                opt.value = topicId;
                opt.textContent = topics[topicId].name;
                topicSelect.appendChild(opt);
            }
        }
    }

    classSelect.addEventListener("change", async () => {
        currentClass = classSelect.value;
        if (currentClass) {
            try {
                const pinRef = ref(db, `classes/${currentClass}/pin`);
                const pinSnap = await get(pinRef);
                if (pinSnap.exists()) {
                    currentClassPin = pinSnap.val();
                } else {
                    await showAlert("Seçtiğiniz sınıf veritabanında PIN ile yok!");
                    return;
                }

                loadClassData(currentClass);
                tableContainer.style.display = "block";
                editModeButton.style.display = "inline-block";
                luckyStudentBtn.style.display = "inline-block";
                resetLuckyBtn.style.display = "inline-block";
                taskTableBtn.style.display = "inline-block"; 
                championCompetitionBtn.style.display = "inline-block";
                championSettingsBtn.style.display = "inline-block";
                taskTableContainer.style.display = "none";
                addTaskBtnDisplay(false);
                exitEditMode();
                await loadChampionData();
                restoreSelectionAfterDataLoad();
            } catch (error) {
                console.error("Error selecting class:", error);
                await showAlert("Sınıf seçimi sırasında bir hata oluştu.");
            }
        } else {
            tableContainer.style.display = "none";
            editModeButton.style.display = "none";
            adminPanel.style.display = "none";
            saveChangesButton.style.display = "none";
            luckyStudentBtn.style.display = "none";
            resetLuckyBtn.style.display = "none";
            taskTableBtn.style.display = "none";
            championCompetitionBtn.style.display = "none";
            championSettingsBtn.style.display = "none";
            taskTableContainer.style.display = "none";
            addTaskBtnDisplay(false);
            luckyStudentResult.textContent = "";
        }
    });

    function addTaskBtnDisplay(show) {
        if (show) {
            addTaskBtn.style.display = "inline-block";
        } else {
            addTaskBtn.style.display = "none";
        }
    }

    function loadClassData(cls) {
        const classDataRef = ref(db, `classes/${cls}/students`);
        onValue(classDataRef, async (snapshot) => {
            const data = snapshot.val() || {};
            currentData = data;
            populateTable(currentData);
            availableStudents = Object.keys(currentData);
            await loadRoles(cls);
            populateTaskTable(); 
            observeTasks(cls); 
            observeDutyStudents();
            populatePlayerSelects();
        }, {
            onlyOnce: false
        });
    }

    function populatePlayerSelects() {
        player1Select.innerHTML = '<option value="">Oyuncu 1 Seç</option>';
        player2Select.innerHTML = '<option value="">Oyuncu 2 Seç</option>';
        for (let id in currentData) {
            const opt1 = document.createElement("option");
            opt1.value = id;
            opt1.textContent = currentData[id].name;

            const opt2 = opt1.cloneNode(true);

            player1Select.appendChild(opt1);
            player2Select.appendChild(opt2);
        }
    }

    async function loadRoles(cls) {
        const rolesRef = ref(db, `classes/${cls}/roles`);
        try {
            const snapshot = await get(rolesRef);
            if (snapshot.exists()) {
                const roles = snapshot.val();
                const presidentId = roles.headOfWeek;
                const presidentName = currentData[presidentId]?.name || "Belirlenmedi";
                headOfWeekCell.innerHTML = presidentId ? `🏆 ${presidentName}` : "Belirlenmedi";

                dutyStudentsCell.textContent = roles.dutyStudents ? roles.dutyStudents.map(id => currentData[id]?.name).join(", ") : "Belirlenmedi";
            } else {
                headOfWeekCell.innerHTML = "Belirlenmedi";
                dutyStudentsCell.textContent = "Belirlenmedi";
            }
        } catch (error) {
            console.error("Error loading roles:", error);
        }
    }

    editModeButton.addEventListener("click", () => {
        pinCheck.style.display = "block";
    });

    pinSubmit.addEventListener("click", async () => {
        const enteredPin = pinInput.value;
        if (enteredPin === currentClassPin) {
            pinCheck.style.display = "none";
            adminPanel.style.display = "block";
            saveChangesButton.style.display = "inline-block";
            tableContainer.querySelector("table").classList.add("edit-mode-enabled");
            taskTableContainer.classList.add("edit-mode-enabled"); 
            addTaskBtnDisplay(true);
        } else {
            await showAlert("Hatalı PIN!");
        }
    });

    function populateTable(data) {
        studentTable.innerHTML = "";
        const sortedData = Object.entries(data).sort((a,b) => (b[1].totalScore || 0) - (a[1].totalScore || 0));

        sortedData.forEach(([id, student], index) => {
            const row = document.createElement("tr");

            if (index === 0) row.classList.add("top-1");
            if (index === 1) row.classList.add("top-2");
            if (index === 2) row.classList.add("top-3");

            const studentPhoto = student.photo || defaultPhotoURL;

            row.innerHTML = `
                <td>
                    <img src="${studentPhoto}" alt="Fotoğraf">
                    <button class="button-update editable-button" data-id="${id}">Güncelle</button>
                </td>
                <td>${student.name}</td>
                <td>
                    <button class="button-red editable-button" data-id="${id}" data-type="total">-</button>
                    <span class="score-display">${student.totalScore || 0}</span>
                    <button class="button-green editable-button" data-id="${id}" data-type="total">+</button>
                </td>
                <td class="actions">
                    <button class="button-red" data-id="${id}" data-action="delete">X</button>
                </td>
            `;
            studentTable.appendChild(row);
        });

        addEventListeners();
    }

    function addEventListeners() {
        document.querySelectorAll("[data-type='total']").forEach((button) => {
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            newButton.addEventListener("click", () => {
                const id = newButton.dataset.id;
                const action = newButton.classList.contains("button-green") ? 1 : -1;
                const newScore = Math.max(0, (currentData[id].totalScore || 0) + action);
                currentData[id].totalScore = newScore;

                if (!pendingChanges[id]) {
                    pendingChanges[id] = {};
                }
                pendingChanges[id].totalScore = newScore;

                const span = newButton.parentElement.querySelector("span.score-display");
                span.textContent = newScore;
            });
        });

        document.querySelectorAll(".button-update").forEach((button) => {
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            newButton.addEventListener("click", async () => {
                const id = newButton.dataset.id;
                const newPhoto = await showPrompt("Yeni Fotoğraf URL'si girin:");
                if (newPhoto) {
                    currentData[id].photo = newPhoto;
                    if (!pendingChanges[id]) {
                        pendingChanges[id] = {};
                    }
                    pendingChanges[id].photo = newPhoto;
                    const img = newButton.parentElement.querySelector("img");
                    img.src = newPhoto;
                }
            });
        });

        document.querySelectorAll("[data-action='delete']").forEach((button) => {
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            newButton.addEventListener("click", async () => {
                const id = newButton.dataset.id;
                const confirmDelete = await showConfirm("Bu öğrenciyi silmek istediğinize emin misiniz?");
                if (confirmDelete) {
                    pendingChanges[id] = { delete: true };
                    newButton.parentElement.parentElement.remove();
                    delete currentData[id]; 
                    availableStudents = availableStudents.filter(sId => sId !== id);
                }
            });
        });
    }

    addStudentButton.addEventListener("click", async () => {
        const name = studentNameInput.value.trim();
        let photo = photoUrlInput.value.trim();

        if (!name) {
            await showAlert("Lütfen öğrenci adını girin!");
            return;
        }

        if (!photo) {
            photo = defaultPhotoURL;
        }

        const tempId = "temp_"+Date.now();
        currentData[tempId] = {
            name,
            photo,
            totalScore: 0
        };

        pendingChanges[tempId] = {
            name,
            photo,
            totalScore: 0,
            isNew: true
        };

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>
                <img src="${photo}" alt="Fotoğraf">
                <button class="button-update editable-button" data-id="${tempId}">Güncelle</button>
            </td>
            <td>${name}</td>
            <td>
                <button class="button-red editable-button" data-id="${tempId}" data-type="total">-</button>
                <span class="score-display">0</span>
                <button class="button-green editable-button" data-id="${tempId}" data-type="total">+</button>
            </td>
            <td class="actions">
                <button class="button-red" data-id="${tempId}" data-action="delete">X</button>
            </td>
        `;
        studentTable.appendChild(row);
        addEventListeners(); 

        studentNameInput.value = "";
        photoUrlInput.value = "";

        availableStudents.push(tempId);
    });

    saveChangesButton.addEventListener("click", async () => {
        try {
            await commitChanges();
            exitEditMode();
            await showAlert("Değişiklikler kaydedildi!");
            await loadRoles(currentClass); 
        } catch (error) {
            console.error("Error saving changes:", error);
            await showAlert("Değişiklikler kaydedilirken bir hata oluştu.");
        }
    });

    async function commitChanges() {
        const studentsRef = ref(db, `classes/${currentClass}/students`);
        for (const id in pendingChanges) {
            const changes = pendingChanges[id];
            if (changes.delete) {
                if (!id.startsWith("temp_")) {
                    await remove(ref(db, `classes/${currentClass}/students/${id}`));
                }
            } else if (changes.isNew) {
                const newRef = push(studentsRef);
                await set(newRef, {
                    name: changes.name,
                    photo: changes.photo,
                    totalScore: changes.totalScore
                });
            } else {
                if (!id.startsWith("temp_")) {
                    const updates = {};
                    if (changes.totalScore !== undefined) updates.totalScore = changes.totalScore;
                    if (changes.photo !== undefined) updates.photo = changes.photo;
                    await update(ref(db, `classes/${currentClass}/students/${id}`), updates);
                } else {
                    const newRef = push(studentsRef);
                    await set(newRef, currentData[id]);
                }
            }
        }
        pendingChanges = {};
    }

    function exitEditMode() {
        adminPanel.style.display = "none";
        saveChangesButton.style.display = "none";
        tableContainer.querySelector("table").classList.remove("edit-mode-enabled");
        taskTableContainer.classList.remove("edit-mode-enabled");
        addTaskBtnDisplay(false);
        pinInput.value = "";
        pinCheck.style.display = "none";
    }

    taskTableBtn.addEventListener("click", () => {
        if (taskTableContainer.style.display === "none") {
            taskTableContainer.style.display = "block";
        } else {
            taskTableContainer.style.display = "none";
        }
    });

    editHeadButton.addEventListener("click", async () => {
        const students = Object.keys(currentData);
        if (students.length === 0) {
            await showAlert("Öğrenci yok!");
            return;
        }

        const selectableStudents = students.map(id => `<option value="${id}">${currentData[id].name}</option>`).join('');

        modalMessage.innerHTML = `Yeni Sınıf Başkanını seçin:<br><select id="head-select">${selectableStudents}</select>`;
        modalInput.style.display = "none";
        checkboxContainer.style.display = "none";
        cancelBtn.style.display = "inline-block";
        confirmBtn.style.display = "inline-block";
        okBtn.style.display = "none";
        modal.showModal();

        const headSelect = document.getElementById("head-select");
        confirmBtn.onclick = async () => {
            const selectedId = headSelect.value;
            await set(ref(db, `classes/${currentClass}/roles/headOfWeek`), selectedId);
            headOfWeekCell.innerHTML = `🏆 ${currentData[selectedId]?.name || "Belirlenmedi"}`;
            modal.close();
        };

        cancelBtn.onclick = () => {
            modal.close();
        };
    });

    editDutyStudentsButton.addEventListener("click", async () => {
        const students = Object.keys(currentData);
        if (students.length < 2) {
            await showAlert("İki öğrenci seçmek için yeterli öğrenci yok.");
            return;
        }

        const selectableStudents = students.map(id => `
            <div class="checkbox-item">
                <input type="checkbox" id="duty-${id}" name="duty-students" value="${id}">
                <label for="duty-${id}">${currentData[id].name}</label>
            </div>
        `).join('');

        modalMessage.innerHTML = `Nöbetçi Öğrencileri seçin (2 öğrenci):<br>`;
        checkboxContainer.innerHTML = selectableStudents;
        checkboxContainer.style.display = "flex";
        modalInput.style.display = "none";
        cancelBtn.style.display = "inline-block";
        confirmBtn.style.display = "inline-block";
        okBtn.style.display = "none";
        modal.showModal();

        confirmBtn.onclick = async () => {
            const selectedCheckboxes = document.querySelectorAll('input[name="duty-students"]:checked');
            if (selectedCheckboxes.length === 2) {
                const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
                await set(ref(db, `classes/${currentClass}/roles/dutyStudents`), selectedIds);
                dutyStudentsCell.textContent = selectedIds.map(id => currentData[id]?.name).join(", ");
                modal.close();
            } else {
                await showAlert("Lütfen iki öğrenci seçin.");
            }
        };

        cancelBtn.onclick = () => {
            modal.close();
        };
    });

    luckyStudentBtn.addEventListener("click", () => {
        if (availableStudents.length === 0) {
            luckyStudentResult.textContent = "Seçilebilecek öğrenci kalmadı!";
            return;
        }
        const randomIndex = Math.floor(Math.random() * availableStudents.length);
        const chosenId = availableStudents[randomIndex];
        const chosenName = currentData[chosenId].name;

        luckyStudentResult.textContent = "Şanslı Öğrenci: " + chosenName;
        availableStudents.splice(randomIndex, 1);
    });

    resetLuckyBtn.addEventListener("click", () => {
        availableStudents = Object.keys(currentData);
        luckyStudentResult.textContent = "";
    });

    addTaskBtn.addEventListener("click", async () => {
        const taskName = await showPrompt("Yeni görev adını girin:");
        if (taskName) {
            const newTaskId = "task_" + Date.now();
            await set(ref(db, `classes/${currentClass}/tasks/${newTaskId}`), {
                name: taskName,
                assignedStudents: []
            });
        }
    });

    function addTaskRow(taskId, taskName) {
        const tbody = taskTableContainer.querySelector("tbody");
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${taskName}</td>
            <td id="task-${taskId}-student">Belirlenmedi</td>
            <td class="actions">
                <button class="edit-button edit-task-btn" data-task-id="${taskId}">Düzenle</button>
                <button class="edit-button delete-task-btn" data-task-id="${taskId}">Sil</button>
            </td>
        `;
        tbody.appendChild(row);

        const deleteBtn = row.querySelector(".delete-task-btn");
        const newDeleteBtn = deleteBtn.cloneNode(true);
        deleteBtn.parentNode.replaceChild(newDeleteBtn, deleteBtn);
        newDeleteBtn.addEventListener("click", async () => {
            const confirmDelete = await showConfirm("Bu görevi silmek istediğinize emin misiniz?");
            if (confirmDelete) {
                await remove(ref(db, `classes/${currentClass}/tasks/${taskId}`));
                row.remove();
            }
        });

        const editBtn = row.querySelector(".edit-task-btn");
        const newEditBtn = editBtn.cloneNode(true);
        editBtn.parentNode.replaceChild(newEditBtn, editBtn);
        newEditBtn.addEventListener("click", async () => {
            const taskRef = ref(db, `classes/${currentClass}/tasks/${taskId}`);
            try {
                const snapshot = await get(taskRef);
                if (snapshot.exists()) {
                    const taskData = snapshot.val();
                    const assignedStudents = taskData.assignedStudents || [];

                    const selectableStudents = Object.keys(currentData).map(id => `
                        <div class="checkbox-item">
                            <input type="checkbox" id="task-${taskId}-student-${id}" name="task-students" value="${id}" ${assignedStudents.includes(id) ? 'checked' : ''}>
                            <label for="task-${taskId}-student-${id}">${currentData[id].name}</label>
                        </div>
                    `).join('');

                    modalMessage.innerHTML = `Göreve Atanacak Öğrencileri seçin:<br>`;
                    checkboxContainer.innerHTML = selectableStudents;
                    checkboxContainer.style.display = "flex"; 
                    modalInput.style.display = "none";
                    cancelBtn.style.display = "inline-block";
                    confirmBtn.style.display = "inline-block";
                    okBtn.style.display = "none";
                    modal.showModal();

                    confirmBtn.onclick = async () => {
                        const selectedCheckboxes = document.querySelectorAll('input[name="task-students"]:checked');
                        const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
                        await update(ref(db, `classes/${currentClass}/tasks/${taskId}`), {
                            assignedStudents: selectedIds
                        });

                        if (selectedIds.length > 0) {
                            const studentNames = selectedIds.map(id => currentData[id]?.name).join(", ");
                            row.querySelector(`#task-${taskId}-student`).textContent = studentNames;
                        } else {
                            row.querySelector(`#task-${taskId}-student`).textContent = "Belirlenmedi";
                        }

                        modal.close();
                    };

                    cancelBtn.onclick = () => {
                        modal.close();
                    };
                } else {
                    await showAlert("Görev bulunamadı.");
                }
            } catch (error) {
                console.error("Error editing task:", error);
                await showAlert("Görev düzenlenirken bir hata oluştu.");
            }
        });
    }

    async function populateTaskTable() {
        const tasksRef = ref(db, `classes/${currentClass}/tasks`);
        try {
            const snapshot = await get(tasksRef);
            if (snapshot.exists()) {
                const tasks = snapshot.val();
                const tbody = taskTableContainer.querySelector("tbody");
                tbody.querySelectorAll("tr:not(#head-of-week-row):not(#duty-students-row)").forEach(row => row.remove());

                for (let taskId in tasks) {
                    addTaskRow(taskId, tasks[taskId].name);
                    const assignedIds = tasks[taskId].assignedStudents || [];
                    const studentNames = assignedIds.map(id => currentData[id]?.name).join(", ");
                    const studentCell = document.getElementById(`task-${taskId}-student`);
                    if (studentCell) {
                        studentCell.textContent = assignedIds.length > 0 ? studentNames : "Belirlenmedi";
                    }
                }
            } else {
                const tbody = taskTableContainer.querySelector("tbody");
                tbody.querySelectorAll("tr:not(#head-of-week-row):not(#duty-students-row)").forEach(row => row.remove());
            }
        } catch (error) {
            console.error("Error populating task table:", error);
        }
    }

    function observeTasks(cls) {
        const tasksRef = ref(db, `classes/${cls}/tasks`);
        onValue(tasksRef, async (snapshot) => {
            await populateTaskTable();
        });
    }

    function observeDutyStudents() {
        const dutyStudentsRef = ref(db, `classes/${currentClass}/roles/dutyStudents`);
        onValue(dutyStudentsRef, (snapshot) => {
            if (snapshot.exists()) {
                const dutyIds = snapshot.val();
                const dutyNames = dutyIds.map(id => currentData[id]?.name).filter(name => name);
                dutyStudentsCell.textContent = dutyNames.length > 0 ? dutyNames.join(", ") : "Belirlenmedi";
            } else {
                dutyStudentsCell.textContent = "Belirlenmedi";
            }
        });
    }

    championCompetitionBtn.addEventListener("click", async () => {
        const enteredPin = await showPrompt("Şampiyon Mücadelesi için PIN girin:", 'password');
        if (enteredPin === currentClassPin) {
            championModal.showModal();
        } else {
            await showAlert("Hatalı PIN!");
        }
    });

    closeChampionModalBtn.addEventListener("click", () => {
        championModal.close();
    });

    let gameQuestions = []; 
    let currentQuestionIndex = 0;
    let leftSteps = 4;
    let rightSteps = 4;
    let maxSteps = 4;
    let gameStartTimer;
    let player1Name = "Oyuncu 1";
    let player2Name = "Oyuncu 2";
    let selectedGameArea = "1"; 

    startGameBtn.addEventListener("click", async () => {
        const selectedHeading = headingSelect.value;
        const selectedLesson = lessonSelect.value;
        const selectedTopic = topicSelect.value;
        const player1 = player1Select.value;
        const player2 = player2Select.value;
        selectedGameArea = gameAreaSelect.value;

        if (!selectedHeading || !selectedLesson || !selectedTopic || !player1 || !player2) {
            alert("Lütfen tüm seçimleri yapınız.");
            return;
        }

        const questionsRef = ref(db, `championData/headings/${selectedHeading}/lessons/${selectedLesson}/topics/${selectedTopic}/questions`);
        const qSnap = await get(questionsRef);

        if (!qSnap.exists()) {
            alert("Bu konuda soru yok.");
            return;
        }

        const qData = qSnap.val();
        gameQuestions = [];
        Object.values(qData).forEach(q => {
            gameQuestions.push({
                qText: q.question,
                answer: q.correct,
                wrongs: [q.wrong1, q.wrong2]
            });
        });

        gameQuestions = shuffleArray(gameQuestions);

        player1Name = currentData[player1].name;
        player2Name = currentData[player2].name;

        championModal.close();
        document.body.classList.add("game-mode");

        document.getElementById("intro-overlay").style.display = "flex";
        const introVideo = document.getElementById("intro-video");
        introVideo.currentTime = 0;
        introVideo.play();

        if (gameStartTimer) {
            clearTimeout(gameStartTimer);
        }
        gameStartTimer = setTimeout(() => {
            document.getElementById("intro-overlay").style.display = "none";
            startGame(selectedGameArea);
        }, 14000); 
    });

    championSettingsBtn.addEventListener("click", async () => {
        const enteredPin = await showPrompt("Ayarlar için Yetkili Şifresi Gereklidir:", 'password');
        if (enteredPin === championSettingsPin) {
            settingsModal.showModal();
            await loadChampionData();
            restoreSelectionAfterDataLoad();
            switchSettingsSection("heading-section");
        } else {
            await showAlert("Hatalı PIN!");
        }
    });

    closeSettingsModalBtn.addEventListener("click", () => {
        settingsModal.close();
    });

    addLessonBtn.addEventListener("click", async () => {
        const lessonName = newLessonNameInput.value.trim();
        const headingId = headingForLessonSelect.value;
        if (!headingId) {
            alert("Önce bir sınıf seçin.");
            return;
        }
        if (!lessonName) {
            alert("Ders adı girin.");
            return;
        }
        const newRef = push(ref(db, `championData/headings/${headingId}/lessons`));
        await set(newRef, {
            name: lessonName
        });
        newLessonNameInput.value = "";
        championHeadings[headingId].lessons = championHeadings[headingId].lessons || {};
        championHeadings[headingId].lessons[newRef.key] = {name:lessonName};
        renderLessons();
    });

    function updateHeadingForLessonSelect() {
        headingForLessonSelect.innerHTML = "";
        for (let hId in championHeadings) {
            const opt = document.createElement("option");
            opt.value = hId;
            opt.textContent = championHeadings[hId].name;
            headingForLessonSelect.appendChild(opt);
        }
        if (headingForLessonSelect.options.length > 0) {
            if (currentSelectedHeadingForLesson) {
                headingForLessonSelect.value = currentSelectedHeadingForLesson;
            }
            renderLessons();
        } else {
            lessonSection.style.display = "none";
            topicSection.style.display = "none";
            questionSection.style.display = "none";
        }
    }

    headingForLessonSelect.addEventListener("change", () => {
        currentSelectedHeadingForLesson = headingForLessonSelect.value;
        renderLessons();
    });

    function renderLessons() {
        lessonListDiv.innerHTML = "";
        const selectedHeading = headingForLessonSelect.value;
        if (selectedHeading && championHeadings[selectedHeading].lessons) {
            const lessons = championHeadings[selectedHeading].lessons;
            for (let lessonId in lessons) {
                const div = document.createElement("div");
                div.className = "lesson-item";
                div.textContent = lessons[lessonId].name;

                const actions = document.createElement("div");
                actions.className = "item-actions";

                const editBtn = document.createElement("button");
                editBtn.textContent = "Düzenle";
                editBtn.addEventListener("click", async () => {
                    const newName = prompt("Yeni ders adı:", lessons[lessonId].name);
                    if (newName) {
                        await update(ref(db, `championData/headings/${selectedHeading}/lessons/${lessonId}`), {name:newName});
                        championHeadings[selectedHeading].lessons[lessonId].name = newName;
                        renderLessons();
                    }
                });

                const delBtn = document.createElement("button");
                delBtn.textContent = "Sil";
                delBtn.addEventListener("click", async () => {
                    const confirmDel = confirm("Bu dersi silmek istediğinize emin misiniz?");
                    if (confirmDel) {
                        await remove(ref(db, `championData/headings/${selectedHeading}/lessons/${lessonId}`));
                        delete championHeadings[selectedHeading].lessons[lessonId];
                        renderLessons();
                    }
                });

                const manageTopicsBtn = document.createElement("button");
                manageTopicsBtn.textContent = "Konular";
                manageTopicsBtn.addEventListener("click", () => {
                    switchSettingsSection("topic-section");
                    updateLessonForTopicSelect(selectedHeading);
                    lessonForTopicSelect.value = lessonId;
                    currentSelectedLessonForTopic = lessonId;
                    renderTopics();
                });

                actions.appendChild(editBtn);
                actions.appendChild(delBtn);
                actions.appendChild(manageTopicsBtn);
                div.appendChild(actions);
                lessonListDiv.appendChild(div);
            }
        }
    }

    function updateLessonForTopicSelect(headingId) {
        lessonForTopicSelect.innerHTML = "";
        if (!headingId) headingId = headingForLessonSelect.value;
        if (headingId && championHeadings[headingId].lessons) {
            const lessons = championHeadings[headingId].lessons;
            for (let lessonId in lessons) {
                const opt = document.createElement("option");
                opt.value = lessonId;
                opt.textContent = lessons[lessonId].name;
                lessonForTopicSelect.appendChild(opt);
            }
            if (currentSelectedLessonForTopic) {
                lessonForTopicSelect.value = currentSelectedLessonForTopic;
            }
            renderTopics();
        } else {
            topicSection.style.display = "none";
            questionSection.style.display = "none";
        }
    }

    lessonForTopicSelect.addEventListener("change", () => {
        currentSelectedLessonForTopic = lessonForTopicSelect.value;
        renderTopics();
    });

    function renderTopics() {
        topicListDiv.innerHTML = "";
        const headingId = headingForLessonSelect.value;
        const lessonId = lessonForTopicSelect.value;
        if (headingId && lessonId && championHeadings[headingId].lessons && championHeadings[headingId].lessons[lessonId].topics) {
            const topics = championHeadings[headingId].lessons[lessonId].topics;
            for (let topicId in topics) {
                const div = document.createElement("div");
                div.className = "topic-item";
                div.textContent = topics[topicId].name;

                const actions = document.createElement("div");
                actions.className = "item-actions";

                const editBtn = document.createElement("button");
                editBtn.textContent = "Düzenle";
                editBtn.addEventListener("click", async () => {
                    const newName = prompt("Yeni konu adı:", topics[topicId].name);
                    if (newName) {
                        await update(ref(db, `championData/headings/${headingId}/lessons/${lessonId}/topics/${topicId}`), {name:newName});
                        championHeadings[headingId].lessons[lessonId].topics[topicId].name = newName;
                        renderTopics();
                    }
                });

                const delBtn = document.createElement("button");
                delBtn.textContent = "Sil";
                delBtn.addEventListener("click", async () => {
                    const confirmDel = confirm("Bu konuyu silmek istediğinize emin misiniz?");
                    if (confirmDel) {
                        await remove(ref(db, `championData/headings/${headingId}/lessons/${lessonId}/topics/${topicId}`));
                        delete championHeadings[headingId].lessons[lessonId].topics[topicId];
                        renderTopics();
                    }
                });

                const manageQuestionsBtn = document.createElement("button");
                manageQuestionsBtn.textContent = "Sorular";
                manageQuestionsBtn.addEventListener("click", () => {
                    switchSettingsSection("question-section");
                    updateLessonForQuestionSelect();
                    lessonForQuestionSelect.value = lessonId;
                    currentSelectedLessonForQuestion = lessonId;
                    updateTopicForQuestionSelect(lessonId);
                    topicForQuestionSelect.value = topicId;
                    currentSelectedTopicForQuestion = topicId;
                    renderQuestions();
                });

                actions.appendChild(editBtn);
                actions.appendChild(delBtn);
                actions.appendChild(manageQuestionsBtn);
                div.appendChild(actions);
                topicListDiv.appendChild(div);
            }
        }
    }

    addTopicBtn.addEventListener("click", async () => {
        const headingId = headingForLessonSelect.value;
        const selectedLessonId = lessonForTopicSelect.value;
        if (!selectedLessonId || !headingId) {
            alert("Önce ders seçin.");
            return;
        }
        const topicName = newTopicNameInput.value.trim();
        if (!topicName) {
            alert("Konu adı girin.");
            return;
        }
        const newRef = push(ref(db, `championData/headings/${headingId}/lessons/${selectedLessonId}/topics`));
        await set(newRef, {
            name: topicName
        });
        newTopicNameInput.value = "";
        championHeadings[headingId].lessons[selectedLessonId].topics = championHeadings[headingId].lessons[selectedLessonId].topics || {};
        championHeadings[headingId].lessons[selectedLessonId].topics[newRef.key] = {name:topicName};
        renderTopics();
    });

    function updateLessonForQuestionSelect() {
        lessonForQuestionSelect.innerHTML = "";
        const headingId = headingForLessonSelect.value;
        if (headingId && championHeadings[headingId].lessons) {
            const lessons = championHeadings[headingId].lessons;
            for (let lessonId in lessons) {
                const opt = document.createElement("option");
                opt.value = lessonId;
                opt.textContent = lessons[lessonId].name;
                lessonForQuestionSelect.appendChild(opt);
            }
            if (currentSelectedLessonForQuestion) {
                lessonForQuestionSelect.value = currentSelectedLessonForQuestion;
            }
            updateTopicForQuestionSelect(lessonForQuestionSelect.value);
        }
    }

    lessonForQuestionSelect.addEventListener("change", () => {
        currentSelectedLessonForQuestion = lessonForQuestionSelect.value;
        updateTopicForQuestionSelect(lessonForQuestionSelect.value);
    });

    function updateTopicForQuestionSelect(lessonId) {
        topicForQuestionSelect.innerHTML = "";
        const headingId = headingForLessonSelect.value;
        if (lessonId && headingId && championHeadings[headingId].lessons[lessonId].topics) {
            const topics = championHeadings[headingId].lessons[lessonId].topics;
            for (let topicId in topics) {
                const opt = document.createElement("option");
                opt.value = topicId;
                opt.textContent = topics[topicId].name;
                topicForQuestionSelect.appendChild(opt);
            }
            if (currentSelectedTopicForQuestion) {
                topicForQuestionSelect.value = currentSelectedTopicForQuestion;
            }
            renderQuestions();
        } else {
            questionListDiv.innerHTML = "";
        }
    }

    topicForQuestionSelect.addEventListener("change", () => {
        currentSelectedTopicForQuestion = topicForQuestionSelect.value;
        renderQuestions();
    });

    function renderQuestions() {
        questionListDiv.innerHTML = "";
        const headingId = headingForLessonSelect.value;
        const lessonId = lessonForQuestionSelect.value;
        const topicId = topicForQuestionSelect.value;
        if (headingId && lessonId && topicId && championHeadings[headingId].lessons && championHeadings[headingId].lessons[lessonId].topics && championHeadings[headingId].lessons[lessonId].topics[topicId].questions) {
            const questions = championHeadings[headingId].lessons[lessonId].topics[topicId].questions;
            for (let qId in questions) {
                const qData = questions[qId];
                const div = document.createElement("div");
                div.className = "question-item";
                
                let questionDisplay = "";
                if (qData.question && (qData.question.startsWith("http://") || qData.question.startsWith("https://"))) {
                    questionDisplay = `<img src="${qData.question}" alt="Soru Resmi" style="max-width:100px;max-height:100px;">`;
                } else {
                    questionDisplay = `Soru: ${qData.question}`;
                }

                div.innerHTML = `${questionDisplay} | Doğru: ${qData.correct} | Yanlışlar: ${qData.wrong1}, ${qData.wrong2}`;

                const actions = document.createElement("div");
                actions.className = "item-actions";

                const editBtn = document.createElement("button");
                editBtn.textContent = "Düzenle";
                editBtn.addEventListener("click", async () => {
                    const newQuestion = prompt("Yeni soru metni veya Resim URL'si:", qData.question);
                    if (newQuestion === null) return;
                    const newCorrect = prompt("Yeni doğru cevap:", qData.correct);
                    if (newCorrect === null) return;
                    const newWrong1 = prompt("Yeni yanlış cevap 1:", qData.wrong1);
                    if (newWrong1 === null) return;
                    const newWrong2 = prompt("Yeni yanlış cevap 2:", qData.wrong2);
                    if (newWrong2 === null) return;

                    await update(ref(db, `championData/headings/${headingId}/lessons/${lessonId}/topics/${topicId}/questions/${qId}`), {
                        question: newQuestion,
                        correct: newCorrect,
                        wrong1: newWrong1,
                        wrong2: newWrong2
                    });

                    championHeadings[headingId].lessons[lessonId].topics[topicId].questions[qId] = {
                        question: newQuestion,
                        correct: newCorrect,
                        wrong1: newWrong1,
                        wrong2: newWrong2
                    };
                    renderQuestions();
                });

                const delBtn = document.createElement("button");
                delBtn.textContent = "Sil";
                delBtn.addEventListener("click", async () => {
                    const confirmDel = confirm("Bu soruyu silmek istediğinize emin misiniz?");
                    if (confirmDel) {
                        await remove(ref(db, `championData/headings/${headingId}/lessons/${lessonId}/topics/${topicId}/questions/${qId}`));
                        delete championHeadings[headingId].lessons[lessonId].topics[topicId].questions[qId];
                        renderQuestions();
                    }
                });

                actions.appendChild(editBtn);
                actions.appendChild(delBtn);
                div.appendChild(actions);
                questionListDiv.appendChild(div);
            }
        }
    }

    addQuestionBtn.addEventListener("click", async () => {
        const headingId = headingForLessonSelect.value;
        const lessonId = lessonForQuestionSelect.value;
        const topicId = topicForQuestionSelect.value;
        if (!headingId || !lessonId || !topicId) {
            alert("Sınıf, ders ve konu seçin.");
            return;
        }
        const qText = newQuestionTextInput.value.trim();
        const qCorrect = newQuestionCorrectInput.value.trim();
        const qWrong1 = newQuestionWrong1Input.value.trim();
        const qWrong2 = newQuestionWrong2Input.value.trim();

        if (!qText || !qCorrect || !qWrong1 || !qWrong2) {
            alert("Soru, doğru cevap ve iki yanlış cevap girin.");
            return;
        }
        const newRef = push(ref(db, `championData/headings/${headingId}/lessons/${lessonId}/topics/${topicId}/questions`));
        await set(newRef, {
            question: qText,
            correct: qCorrect,
            wrong1: qWrong1,
            wrong2: qWrong2
        });

        championHeadings[headingId].lessons[lessonId].topics[topicId].questions = championHeadings[headingId].lessons[lessonId].topics[topicId].questions || {};
        championHeadings[headingId].lessons[lessonId].topics[topicId].questions[newRef.key] = {
            question: qText,
            correct: qCorrect,
            wrong1: qWrong1,
            wrong2: qWrong2
        };

        newQuestionTextInput.value = "";
        newQuestionCorrectInput.value = "";
        newQuestionWrong1Input.value = "";
        newQuestionWrong2Input.value = "";
        renderQuestions();
    });

    function shuffleArray(array) {
        for (let i = array.length -1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i +1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    const introOverlay = document.getElementById("intro-overlay");
    const introVideo = document.getElementById("intro-video");
    const gameOverlay = document.getElementById("game-overlay");
    const closeGameBtn = document.getElementById("close-game-btn");
    const leftAnswersDiv = document.getElementById("left-answers");
    const rightAnswersDiv = document.getElementById("right-answers");
    const questionText = document.getElementById("question-text");
    const bunnyLeft = document.getElementById("bunny-left");
    const bunnyRight = document.getElementById("bunny-right");
    const winnerEffect = document.getElementById("winner-effect");
    const winnerMessage = document.getElementById("winner-message");
    const playAgainBtn = document.getElementById("play-again-btn");
    const correctSound = document.getElementById("correct-sound");
    const incorrectSound = document.getElementById("incorrect-sound");
    const winnerSound = document.getElementById("winner-sound");
    const carrot = document.getElementById("carrot");

    const gameOverlay2 = document.getElementById("game-overlay-2");
    const closeGameBtn2 = document.getElementById("close-game-btn-2");
    const leftAnswersDiv2 = document.getElementById("left-answers-2");
    const rightAnswersDiv2 = document.getElementById("right-answers-2");
    const questionText2 = document.getElementById("question-text-2");
    const bunnyLeft2 = document.getElementById("bunny-left-2");
    const bunnyRight2 = document.getElementById("bunny-right-2");
    const carrot2 = document.getElementById("carrot-2");
    const scaleSlider = document.getElementById("scale-slider");
    const gameContainer = document.getElementById("game-container");

    const scaleSlider2 = document.getElementById("scale-slider-2");
    const gameContainer2 = document.getElementById("game-container-2");

    function resetStars(gameArea) {
        if (gameArea === "2") {
            updateStars('left', leftSteps, gameArea);
            updateStars('right', rightSteps, gameArea);
        } else {
            updateStars('left', leftSteps, gameArea);
            updateStars('right', rightSteps, gameArea);
        }
    }

    function startGame(gameArea) {
        currentQuestionIndex = 0;
        leftSteps = 4;
        rightSteps = 4;

        if (gameArea === "2") {
            bunnyLeft2.style.left = '0%';
            bunnyRight2.style.right = '0%';
            document.getElementById("left-player-name-2").textContent = player1Name;
            document.getElementById("right-player-name-2").textContent = player2Name;

            resetStars("2");
            gameOverlay2.style.display = "flex";
        } else {
            bunnyLeft.style.left = '0%';
            bunnyRight.style.right = '0%';
            document.getElementById("left-player-name").textContent = player1Name;
            document.getElementById("right-player-name").textContent = player2Name;

            resetStars("1");
            gameOverlay.style.display = "flex";
        }
        loadNextQuestion(gameArea);
    }

    function loadNextQuestion(gameArea) {
        if (currentQuestionIndex >= gameQuestions.length) {
            endGame(gameArea);
            return;
        }

        const currentQ = gameQuestions[currentQuestionIndex];
        const qTextElem = (gameArea === "2") ? questionText2 : questionText;

        if (currentQ.qText.startsWith("http://") || currentQ.qText.startsWith("https://")) {
            qTextElem.innerHTML = `<img src="${currentQ.qText}" alt="Soru Resmi" style="max-width:100%; max-height:300px; display:block; margin:0 auto;">`;
        } else {
            qTextElem.textContent = (currentQ.qText || "Soru burada olacak");
        }

        const correctAnswer = currentQ.answer;
        const wrongAnswers = currentQ.wrongs;
        const allAnswers = shuffleArray([correctAnswer, ...wrongAnswers]);

        const leftDiv = (gameArea === "2") ? leftAnswersDiv2 : leftAnswersDiv;
        const rightDiv = (gameArea === "2") ? rightAnswersDiv2 : rightAnswersDiv;
        leftDiv.innerHTML = "";
        rightDiv.innerHTML = "";

        allAnswers.forEach(ans => {
            const leftBtn = document.createElement("button");
            leftBtn.textContent = ans;
            leftBtn.classList.add(gameArea === "2" ? "answer-btn-2" : "answer-btn");
            leftBtn.dataset.answer = ans;
            leftBtn.addEventListener("click", () => handleAnswer('left', ans, gameArea));

            const rightBtn = document.createElement("button");
            rightBtn.textContent = ans;
            rightBtn.classList.add(gameArea === "2" ? "answer-btn-2" : "answer-btn");
            rightBtn.dataset.answer = ans;
            rightBtn.addEventListener("click", () => handleAnswer('right', ans, gameArea));

            leftDiv.appendChild(leftBtn);
            rightDiv.appendChild(rightBtn);
        });
    }

    function handleAnswer(side, selectedAnswer, gameArea) {
        const currentQ = gameQuestions[currentQuestionIndex];
        const isCorrect = (selectedAnswer === currentQ.answer);

        if (isCorrect) {
            correctSound.currentTime = 0;
            correctSound.play();

            if (side === 'left') {
                if (leftSteps > 0) {
                    leftSteps--;
                    updateStars('left', leftSteps, gameArea);
                    moveBunny('left', true, gameArea);
                }
            } else {
                if (rightSteps > 0) {
                    rightSteps--;
                    updateStars('right', rightSteps, gameArea);
                    moveBunny('right', true, gameArea);
                }
            }
            showFeedback(side, true, gameArea);
        } else {
            incorrectSound.currentTime = 0;
            incorrectSound.play();

            if (side === 'left') {
                if (leftSteps < maxSteps) {
                    leftSteps++;
                    updateStars('left', leftSteps, gameArea);
                    moveBunny('left', false, gameArea);
                }
            } else {
                if (rightSteps < maxSteps) {
                    rightSteps++;
                    updateStars('right', rightSteps, gameArea);
                    moveBunny('right', false, gameArea);
                }
            }
            showFeedback(side, false, gameArea);
        }

        disableAnswerButtons(gameArea);
        setTimeout(() => {
            currentQuestionIndex++;
            loadNextQuestion(gameArea);
        }, 1000);
    }

    function updateStars(side, steps, gameArea) {
        let starsContainer, starClass, hiddenClass;
        if (gameArea === "2") {
            starsContainer = side === 'left' ? document.querySelector(".left-stars-2") : document.querySelector(".right-stars-2");
            starClass = "star-2";
            hiddenClass = "hidden-star-2";
        } else {
            starsContainer = side === 'left' ? document.querySelector(".left-stars") : document.querySelector(".right-stars");
            starClass = "star";
            hiddenClass = "hidden-star";
        }

        const stars = starsContainer.querySelectorAll(`.${starClass}`);
        stars.forEach((star, index) => {
            if (index < steps) {
                star.classList.remove(hiddenClass);
            } else {
                star.classList.add(hiddenClass);
            }
        });
    }

    function moveBunny(side, forward, gameArea) {
        const stepPercentage = 8; 
        if (gameArea === "2") {
            if (side === 'left') {
                let currentLeft = parseFloat(bunnyLeft2.style.left) || 0;
                currentLeft = forward ? currentLeft + stepPercentage : currentLeft - stepPercentage;
                currentLeft = Math.max(0, Math.min(currentLeft, 40)); 
                bunnyLeft2.style.left = `${currentLeft}%`;

                if (leftSteps === 0) {
                    const winnerName = player1Name;
                    if (gameArea === "2") {
                        showWinner2(winnerName);
                    } else {
                        showWinner(`${winnerName} kazandı!`);
                    }
                }
            } else if (side === 'right') {
                let currentRight = parseFloat(bunnyRight2.style.right) || 0;
                currentRight = forward ? currentRight + stepPercentage : currentRight - stepPercentage;
                currentRight = Math.max(0, Math.min(currentRight, 40)); 
                bunnyRight2.style.right = `${currentRight}%`;

                if (rightSteps === 0) {
                    const winnerName = player2Name;
                    if (gameArea === "2") {
                        showWinner2(winnerName);
                    } else {
                        showWinner(`${winnerName} kazandı!`);
                    }
                }
            }
        } else {
            if (side === 'left') {
                let currentLeft = parseFloat(bunnyLeft.style.left) || 0;
                currentLeft = forward ? currentLeft + stepPercentage : currentLeft - stepPercentage;
                currentLeft = Math.max(0, Math.min(currentLeft, 40)); 
                bunnyLeft.style.left = `${currentLeft}%`;

                if (leftSteps === 0) {
                    const winnerName = player1Name;
                    showWinner(`${winnerName} kazandı!`);
                }
            } else if (side === 'right') {
                let currentRight = parseFloat(bunnyRight.style.right) || 0;
                currentRight = forward ? currentRight + stepPercentage : currentRight - stepPercentage;
                currentRight = Math.max(0, Math.min(currentRight, 40)); 
                bunnyRight.style.right = `${currentRight}%`;

                if (rightSteps === 0) {
                    const winnerName = player2Name;
                    showWinner(`${winnerName} kazandı!`);
                }
            }
        }
    }

    function disableAnswerButtons(gameArea) {
        const btnClass = (gameArea === "2") ? ".answer-btn-2" : ".answer-btn";
        document.querySelectorAll(btnClass).forEach(btn => {
            btn.classList.add((gameArea === "2") ? "disabled-2" : "disabled");
            btn.disabled = true;
        });
    }

    function showFeedback(side, isCorrect, gameArea) {
        const feedbackText = isCorrect ? "Doğru!" : "Yanlış!";
        const color = isCorrect ? "#4caf50" : "#f44336";

        const feedbackDiv = document.createElement("div");
        feedbackDiv.textContent = feedbackText;
        feedbackDiv.style.color = color;
        feedbackDiv.style.fontSize = "1.5em";
        feedbackDiv.style.marginTop = "10px";

        if (gameArea === "2") {
            if (side === 'left') {
                leftAnswersDiv2.appendChild(feedbackDiv);
            } else {
                rightAnswersDiv2.appendChild(feedbackDiv);
            }
        } else {
            if (side === 'left') {
                leftAnswersDiv.appendChild(feedbackDiv);
            } else {
                rightAnswersDiv.appendChild(feedbackDiv);
            }
        }
    }

    function endGame(gameArea) {
        let winner = "";
        if (leftSteps < rightSteps) {
            winner = `${player1Name} kazandı!`;
        } else if (rightSteps < leftSteps) {
            winner = `${player2Name} kazandı!`;
        } else {
            winner = "Berabere!";
        }

        if (gameArea === "2") {
            showWinner2(winner);
        } else {
            showWinner(winner);
        }
    }

    function showWinner(winnerName) {
        winnerMessage.textContent = `${winnerName}`;
        winnerEffect.style.display = "flex";

        winnerSound.currentTime = 0;
        winnerSound.play();

        document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
            element.style.filter = "blur(5px)";
            element.style.pointerEvents = "none";
            element.style.opacity = "0.5";
            element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
        });
    }

    playAgainBtn.addEventListener("click", () => {
        winnerEffect.style.display = "none";
        winnerSound.pause();
        winnerSound.currentTime = 0;

        document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
            element.style.filter = "none";
            element.style.pointerEvents = "auto";
            element.style.opacity = "1";
            element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
        });

        gameQuestions = [];
        currentQuestionIndex = 0;
        leftSteps = 4;
        rightSteps = 4;
        questionText.textContent = "Soru burada olacak";
        leftAnswersDiv.innerHTML = "";
        rightAnswersDiv.innerHTML = "";
        document.getElementById("left-player-name").textContent = player1Name;
        document.getElementById("right-player-name").textContent = player2Name;
        winnerEffect.style.display = "none";

        resetStars("1");

        gameOverlay.style.display = "none";
        gameOverlay2.style.display = "none"; 
        document.body.classList.remove("game-mode");
        document.getElementById("champion-modal").showModal();
    });

    const playAgainBtn2 = document.getElementById("play-again-btn-2");
    playAgainBtn2.addEventListener("click", () => {
        winnerEffect2.style.display = "none";
        winnerSound.pause();
        winnerSound.currentTime = 0;

        document.querySelectorAll("body > *:not(#winner-effect-2)").forEach(element => {
            element.style.filter = "none";
            element.style.pointerEvents = "auto";
            element.style.opacity = "1";
            element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
        });

        gameQuestions = [];
        currentQuestionIndex = 0;
        leftSteps = 4;
        rightSteps = 4;
        questionText2.textContent = "Soru burada olacak";
        leftAnswersDiv2.innerHTML = "";
        rightAnswersDiv2.innerHTML = "";
        document.getElementById("left-player-name-2").textContent = player1Name;
        document.getElementById("right-player-name-2").textContent = player2Name;
        resetStars("2");

        gameOverlay2.style.display = "none";
        document.body.classList.remove("game-mode");
        document.getElementById("champion-modal").showModal();
    });

    closeGameBtn.addEventListener("click", () => {
        closeGame();
    });

    closeGameBtn2.addEventListener("click", () => {
        closeGame();
    });

    function closeGame() {
        gameOverlay.style.display = "none";
        gameOverlay2.style.display = "none";
        gameQuestions = [];
        currentQuestionIndex = 0;
        leftSteps = 4;
        rightSteps = 4;
        questionText.textContent = "Soru burada olacak";
        questionText2.textContent = "Soru burada olacak";
        leftAnswersDiv.innerHTML = "";
        rightAnswersDiv.innerHTML = "";
        leftAnswersDiv2.innerHTML = "";
        rightAnswersDiv2.innerHTML = "";
        document.getElementById("left-player-name").textContent = player1Name;
        document.getElementById("right-player-name").textContent = player2Name;
        document.getElementById("left-player-name-2").textContent = player1Name;
        document.getElementById("right-player-name-2").textContent = player2Name;
        winnerEffect.style.display = "none";

        resetStars("1");
        resetStars("2");

        document.querySelectorAll("body > *:not(#winner-effect):not(#winner-effect-2)").forEach(element => {
            element.style.filter = "none";
            element.style.pointerEvents = "auto";
            element.style.opacity = "1";
            element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
        });

        document.body.classList.remove("game-mode");
        document.getElementById("champion-modal").showModal();
    }

    settingsNav.addEventListener("click", (e) => {
        if (e.target.tagName === "BUTTON") {
            switchSettingsSection(e.target.dataset.section);
        }
    });

    function switchSettingsSection(sectionId) {
        settingsSections.forEach(sec => sec.classList.remove("active"));
        document.getElementById(sectionId).classList.add("active");
    }

    function restoreSelectionAfterDataLoad() {
        if (currentSelectedHeadingForLesson && headingForLessonSelect.querySelector(`option[value="${currentSelectedHeadingForLesson}"]`)) {
            headingForLessonSelect.value = currentSelectedHeadingForLesson;
            renderLessons();
        }
        if (currentSelectedLessonForTopic && lessonForTopicSelect.querySelector(`option[value="${currentSelectedLessonForTopic}"]`)) {
            lessonForTopicSelect.value = currentSelectedLessonForTopic;
            renderTopics();
        }
        if (currentSelectedLessonForQuestion && lessonForQuestionSelect.querySelector(`option[value="${currentSelectedLessonForQuestion}"]`)) {
            lessonForQuestionSelect.value = currentSelectedLessonForQuestion;
            updateTopicForQuestionSelect(currentSelectedLessonForQuestion);
        }
        if (currentSelectedTopicForQuestion && topicForQuestionSelect.querySelector(`option[value="${currentSelectedTopicForQuestion}"]`)) {
            topicForQuestionSelect.value = currentSelectedTopicForQuestion;
            renderQuestions();
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        const winnerEffect = document.getElementById("winner-effect");
        const playAgainButton = document.getElementById("play-again-btn");
        const backgroundMusic = document.querySelector('audio[src="https://github.com/d4rkd4/winnerarkaplan/raw/refs/heads/main/soru%20arka.mp3"]');

        if (backgroundMusic) {
            const stopMusic = () => {
                backgroundMusic.pause();
                backgroundMusic.currentTime = 0; 
            };

            winnerEffect.addEventListener("animationstart", stopMusic);
            playAgainButton.addEventListener("click", stopMusic);
        }
    });

    document.getElementById("close-game-btn").addEventListener("click", function() {
        const audios = document.querySelectorAll("audio");
        audios.forEach(audio => {
            audio.pause();
            audio.currentTime = 0; 
        });
    });

    document.getElementById("close-game-btn-2").addEventListener("click", function() {
        const audios = document.querySelectorAll("audio");
        audios.forEach(audio => {
            audio.pause();
            audio.currentTime = 0; 
        });
    });

    scaleSlider.addEventListener("input", () => {
        const scaleValue = parseFloat(scaleSlider.value);
        gameContainer.style.transform = `scale(${scaleValue})`;
    });

    scaleSlider2.addEventListener("input", () => {
        const scaleValue = parseFloat(scaleSlider2.value);
        gameContainer2.style.transform = `scale(${scaleValue})`;
    });
</script>

<div id="winner-effect-2">
    <div id="winner-message-2">Kazanan: Oyuncu</div>
    <button id="play-again-btn-2" onclick="replayGame2()">↻ Tekrar Oyna</button>
</div>

<script>
    function replayGame2() {
        // Hide the winner effect screen for Game Area 2
        const winnerEffect2 = document.getElementById("winner-effect-2");
        winnerEffect2.style.display = "none";

        // Reset the game state for Game Area 2
        const gameOverlay2 = document.getElementById("game-overlay-2");
        if (gameOverlay2) {
            gameOverlay2.style.display = "flex";
        }

        // Optionally stop all sounds if required (example placeholder function)
        const audios = document.querySelectorAll("audio");
        audios.forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });

        // Redirect to Champion Competition if needed
        const championModal = document.getElementById("champion-modal");
        if (championModal) {
            championModal.showModal();
        } else {
            console.error("Champion modal not found!");
        }
    }
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Background music for Game Area 1
    const gameOverlay1 = document.getElementById("game-overlay");
    const winnerEffect1 = document.getElementById("winner-effect");
    window.bgMusic1 = new Audio("https://github.com/d4rkd4/winnerarkaplan/raw/refs/heads/main/soru%20arka.mp3");
    window.bgMusic1.loop = true;

    // Play music when Game Area 1 is shown
    const observer1 = new MutationObserver(() => {
        if (gameOverlay1.style.display === "flex") {
            bgMusic1.play();
        } else {
            bgMusic1.pause();
            bgMusic1.currentTime = 0;
        }
    });
    observer1.observe(gameOverlay1, { attributes: true, attributeFilter: ['style'] });

    // Stop music when Winner Effect for Game Area 1 is shown
    const observerWinner1 = new MutationObserver(() => {
        if (winnerEffect1.style.display === "flex") {
            bgMusic1.pause();
            bgMusic1.currentTime = 0;
        }
    });
    observerWinner1.observe(winnerEffect1, { attributes: true, attributeFilter: ['style'] });

    // Background music for Game Area 2
    const gameOverlay2 = document.getElementById("game-overlay-2");
    const winnerEffect2 = document.getElementById("winner-effect-2");
    window.bgMusic2 = new Audio("https://github.com/d4rkd4/winnerarkaplan/raw/refs/heads/main/Childrens%20Music%20%E2%80%94%20Happy%20Upbeat%20Music%20(Instrumental%20Music%20For%20Kids).mp3");
    window.bgMusic2.loop = true;

    // Play music when Game Area 2 is shown
    const observer2 = new MutationObserver(() => {
        if (gameOverlay2.style.display === "flex") {
            bgMusic2.play();
        } else {
            bgMusic2.pause();
            bgMusic2.currentTime = 0;
        }
    });
    observer2.observe(gameOverlay2, { attributes: true, attributeFilter: ['style'] });

    // Stop music when Winner Effect for Game Area 2 is shown
    const observerWinner2 = new MutationObserver(() => {
        if (winnerEffect2.style.display === "flex") {
            bgMusic2.pause();
            bgMusic2.currentTime = 0;
        }
    });
    observerWinner2.observe(winnerEffect2, { attributes: true, attributeFilter: ['style'] });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
    
    window.winnerMusic = document.getElementById("winner-sound");
    window.winnerMusic.loop = false;

    // Play winner music for Game Area 1
    const winnerEffect1 = document.getElementById("winner-effect");
    const observerWinner1 = new MutationObserver(() => {
        if (winnerEffect1.style.display === "flex") {
            window.winnerMusic.currentTime = 0;
            window.winnerMusic.play();
        }
    });
    observerWinner1.observe(winnerEffect1, { attributes: true, attributeFilter: ['style'] });

    // Play winner music for Game Area 2
    const winnerEffect2 = document.getElementById("winner-effect-2");
    const observerWinner2 = new MutationObserver(() => {
        if (winnerEffect2.style.display === "flex") {
            window.winnerMusic.currentTime = 0;
            window.winnerMusic.play();
        }
    });
    observerWinner2.observe(winnerEffect2, { attributes: true, attributeFilter: ['style'] });
});
</script>


<script>
    function replayGame2() {
        // Hide the winner effect screen for Game Area 2
        const winnerEffect2 = document.getElementById("winner-effect-2");
        if (winnerEffect2) {
            winnerEffect2.style.display = "none";
        }

        // Reset all styles applied during winner effect
        document.querySelectorAll("body > *").forEach(element => {
            element.style.filter = "none";
            element.style.pointerEvents = "auto";
            element.style.opacity = "1";
        });

        // Stop all audio playback if present
        const audios = document.querySelectorAll("audio");
        audios.forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });

        // Hide Game Overlay for Game Area 2
        const gameOverlay2 = document.getElementById("game-overlay-2");
        if (gameOverlay2) {
            gameOverlay2.style.display = "none";
        }

        // Ensure modal for Champion Competition opens correctly
        const championModal = document.getElementById("champion-modal");
        if (championModal) {
            championModal.style.display = "block";
            championModal.showModal(); // Open modal
        } else {
            console.error("Champion modal not found!");
        }
    }

    // Ensure the replay button calls the updated replayGame2 function
    document.querySelectorAll("#play-again-btn, #play-again-btn-2").forEach(button => {
        button.onclick = replayGame2;
    });
</script>

</body>
    
</html>
