<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Åžampiyonlar Ligi</title>
    <style>
        /* Genel Stil */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 3.5em;
            font-weight: bold;
            color: #ff4500;
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4);
            margin-bottom: 30px;
        }

        h1 span {
            color: #0078d7;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* PIN ve Admin Paneli */
        .pin-container, #admin-panel {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .pin-container input, .pin-container button, #admin-panel input, #admin-panel button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: calc(100% - 30px);
            box-sizing: border-box;
        }

        /* Genel Buton Stilleri */
        button {
            background-color: #0078d7;
            color: white;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background 0.3s ease;
            padding: 10px 20px;
            font-size: 1em;
        }

        button:hover {
            background-color: #005bb5;
        }

        /* GÃ¶revli Tablosu Butonu */
        #task-table-btn {
            margin-bottom: 20px;
            font-size: 1.2em;
            padding: 12px 20px;
            font-weight: bold;
            display: inline-block;
            background-color: #28a745; /* YeÅŸil renk */
            transition: background 0.3s ease;
            border: none;
            color: white;
        }

        #task-table-btn:hover {
            background-color: #218838;
        }

        /* Tablo Container ve GÃ¶revli Tablosu */
        .table-container, #task-table-container {
            max-width: 90%;
            margin: 20px auto;
            background-color: #ffffff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease-in-out;
            display: none;
        }

        .table-container:hover, #task-table-container:hover {
            transform: scale(1.02);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1em;
            text-align: center;
        }

        th, td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: linear-gradient(to right, #0078d7, #005bb5);
            color: white;
        }

        /* GÃ¶revli Tablosu Ä°Ã§in BaÅŸlÄ±k */
        #task-table th {
            background: linear-gradient(to right, #28a745, #218838);
            color: white;
        }

        /* "Ä°ÅŸlemler" SÃ¼tunu */
        .actions {
            display: none; /* SÃ¼tunu tamamen gizle */
        }

        .edit-mode-enabled .actions {
            display: table-cell; /* Edit modunda gÃ¶ster */
        }

        /* Ã–ÄŸrenci FotoÄŸrafÄ± */
        td img {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Puan ButonlarÄ± */
        .button-red, .button-green, .button-update {
            margin: 5px;
            padding: 5px 10px;
            font-size: 0.9em;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .button-red {
            background-color: #f44336;
            color: white;
        }

        .button-red:hover {
            background-color: #d32f2f;
        }

        .button-green {
            background-color: #4caf50;
            color: white;
        }

        .button-green:hover {
            background-color: #388e3c;
        }

        .button-update {
            background-color: #ffa500;
            color: white;
        }

        .button-update:hover {
            background-color: #e69500;
        }

        /* Kaydet Butonu */
        #save-changes {
            display: none;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 1em;
            background-color: #28a745;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            border: none;
        }

        #save-changes:hover {
            background-color: #218838;
        }

        /* SÄ±nÄ±f SeÃ§imi */
        #class-selection {
            margin-bottom: 20px;
        }

        /* Ãœst ÃœÃ§ SÄ±ranÄ±n Efekti */
        @keyframes wave {
            0% {
                background-position: 0% 0%;
            }
            50% {
                background-position: 100% 100%;
            }
            100% {
                background-position: 0% 0%;
            }
        }

        .top-1 {
            background: linear-gradient(135deg, 
                #FFD700 0%, 
                #FFE033 20%, 
                #FFD700 40%, 
                #FFE033 60%, 
                #FFD700 80%, 
                #FFE033 100%
            );
            background-size: 400% 400%;
            animation: wave 5s linear infinite;
        }

        .top-2 {
            background: linear-gradient(135deg, 
                #FFE033 0%, 
                #FFF1A8 20%, 
                #FFE033 40%, 
                #FFF1A8 60%, 
                #FFE033 80%, 
                #FFF1A8 100%
            );
            background-size: 400% 400%;
            animation: wave 5s linear infinite;
        }

        .top-3 {
            background: linear-gradient(135deg, 
                #FFF1A8 0%, 
                #FFF9C4 20%, 
                #FFF1A8 40%, 
                #FFF9C4 60%, 
                #FFF1A8 80%, 
                #FFF9C4 100%
            );
            background-size: 400% 400%;
            animation: wave 5s linear infinite;
        }

        /* ÅžanslÄ± Ã–ÄŸrenci BÃ¶lÃ¼mÃ¼ */
        #lucky-student-btn {
            margin-bottom: 10px;
            font-size: 1.2em;
            padding: 12px 20px;
            font-weight: bold;
            display: inline-block;
            background-color: #0078d7;
            transition: background 0.3s ease;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        #lucky-student-btn:hover {
            background-color: #005bb5;
        }

        #lucky-student-result {
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 2em;
            color: #0078d7;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
            animation: pulse 1.5s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        /* Reset Lucky Butonu */
        #reset-lucky {
            margin-left: 10px;
            padding: 12px 15px;
            font-size: 1.2em;
            display: inline-block;
            position: relative;
            overflow: hidden;
            background-color: #0078d7;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #reset-lucky::before {
            content: "â†»";
            display: inline-block;
            font-size: 1.4em;
            transform: rotate(0deg);
            transition: transform 0.5s ease;
        }

        #reset-lucky:hover {
            background-color: #005bb5;
        }

        #reset-lucky:hover::before {
            transform: rotate(360deg);
        }

        /* Modal Stilleri */
        dialog {
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            padding: 20px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        #modal-content p {
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        #modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        #modal-buttons button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #modal-buttons .ok-btn {
            background-color: #0078d7;
            color: white;
        }

        #modal-buttons .cancel-btn {
            background-color: #6c757d;
            color: white;
        }

        #modal-buttons .confirm-btn {
            background-color: #28a745;
            color: white;
        }

        #modal-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            display: none;
        }

        /* GÃ¶revli Tablosu Eklemeleri */
        #task-table-container {
            max-width: 90%;
            margin: 20px auto;
            background-color: #ffffff;
            border: 3px solid #28a745; /* YeÅŸil Ã§erÃ§eve */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease-in-out;
            display: none;
        }

        #task-table-container:hover {
            transform: scale(1.02);
        }

        #task-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1em;
            text-align: center;
        }

        #task-table th, #task-table td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }

        #task-table th {
            background: linear-gradient(to right, #28a745, #218838);
            color: white;
        }

        /* GÃ¶revli Tablosu Ä°Ã§in actions sÃ¼tunu */
        #task-table th.actions, #task-table td.actions {
            display: none; /* SÃ¼tunu gizle */
        }

        .edit-mode-enabled #task-table th.actions, .edit-mode-enabled #task-table td.actions {
            display: table-cell; /* Edit modunda gÃ¶ster */
        }

        /* Dinamik Ã‡erÃ§eve Efekti */
        .highlighted {
            position: relative;
            animation: glow 2s infinite;
            border: 2px solid #FFD700; /* Ã‡erÃ§eveyi inceltildi */
            border-radius: 10px;
            padding: 10px;
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700;
            }
            50% {
                box-shadow: 0 0 20px #FFD700, 0 0 30px #FFD700, 0 0 40px #FFD700;
            }
            100% {
                box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700;
            }
        }

        .edit-button {
            background-color: #0078d7;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .edit-button:hover {
            background-color: #005bb5;
        }

        /* Yeni GÃ¶rev Ekleme Butonu */
        #add-task-btn {
            background-color: #17a2b8;
            margin-top: 10px;
            display: none;
            padding: 8px 16px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #add-task-btn:hover {
            background-color: #138496;
        }

        /* GÃ¶rev Silme ButonlarÄ± */
        .delete-task-btn {
            background-color: #dc3545;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .delete-task-btn:hover {
            background-color: #c82333;
        }

        /* DÃ¼zenle Butonuna Ekstra Stil */
        .edit-task-btn {
            background-color: #ffc107;
            margin-right: 5px;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .edit-task-btn:hover {
            background-color: #e0a800;
        }

        /* Modal Checkbox DÃ¼zenlemesi */
        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            width: 45%; /* Ä°ki sÃ¼tun oluÅŸtur */
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checkbox-item label {
            flex: 1;
            text-align: left;
        }

        /* DÃ¼zenleme Modu ButonlarÄ±nÄ±n GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ */
        .editable-button {
            display: none;
        }

        .edit-mode-enabled .editable-button {
            display: inline-block;
        }

        /* Oyun Overlay Stilleri */
        #game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #game-container {
            background-color: #ffffff;
            width: 90%;
            max-width: 1200px;
            height: 90%;
            border-radius: 10px;
            position: relative;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #close-game-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            width: 60px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            justify-content: center;
            align-items: center; /* Ortalamak iÃ§in eklendi */
        }

        #close-game-btn:hover {
            background-color: #d32f2f;
        }

        #question-area {
            position: relative;
            width: 100%;
            height: 150px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #question-text {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            animation: fadeIn 1s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #bunny-left, #bunny-right, #carrot {
            position: absolute;
            top: 60px;
            width: 80px;
            height: 80px;
        }

        #bunny-left {
            left: 10%;
            transition: left 0.5s ease;
        }

        #bunny-right {
            right: 10%;
            transition: right 0.5s ease;
        }

        #carrot {
            left: 50%;
            transform: translateX(-50%);
        }

        #game-body {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            height: 100%;
        }

        /* Oyun Ä°Ã§eriÄŸi */
        #game-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            width: 100%;
            height: 100%;
        }

        .player-section {
            width: 45%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .player-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .answers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            width: 100%;
            justify-content: center;
            margin-top: 20px;
        }

        .answer-btn {
            padding: 10px 20px;
            background-color: #0078d7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            flex: 1 1 30%; /* 3 ÅŸÄ±k iÃ§in esnek geniÅŸlik */
            transition: background 0.3s ease;
        }

        .answer-btn:hover {
            background-color: #005bb5;
        }

        .disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Kazanma Efekti */
        #winner-effect {
            position: fixed; /* absolute yerine fixed yapÄ±ldÄ± */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-image: url('https://cdn.pixabay.com/animation/2023/12/09/19/16/19-16-42-998_512.gif'); /* Havai fiÅŸek GIF */
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            color: #00ff00; /* YeÅŸil renk */
            padding: 40px 60px; /* Daha bÃ¼yÃ¼k */
            border-radius: 15px;
            font-size: 2em; /* KÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
            animation: popIn 1s;
            z-index: 3000; /* Daha yÃ¼ksek */
            display: none;
            box-shadow: 0 0 20px #00ff00;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* Tekrar Oyna Butonu */
        #play-again-btn {
            margin-top: 20px;
            padding: 5px 10px; /* KÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
            background-color: #0078d7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.7em; /* KÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
            transition: background 0.3s ease;
        }

        #play-again-btn:hover {
            background-color: #005bb5;
        }

        /* Ã–ÄŸrenci SeÃ§im Modal Stili */
        #student-selection-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        #student-selection-container {
            background-color: #ffffff;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        #close-selection-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            justify-content: center;
            align-items: center; /* Ortalamak iÃ§in eklendi */
        }

        #close-selection-btn:hover {
            background-color: #d32f2f;
        }

        .selection-panel {
            margin-bottom: 20px;
        }

        .selection-panel label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .selection-panel select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        #confirm-selection-btn {
            background-color: #28a745;
            margin-top: 10px;
            color: white;
            border-radius: 5px;
        }

        #confirm-selection-btn:hover {
            background-color: #218838;
        }

        /* Tekrar Oyna Butonuna Ekstra Stil */
        #play-again-btn {
            background-color: #0078d7;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #play-again-btn:hover {
            background-color: #005bb5;
        }
    </style>
</head>
<body>
    <h1>Åžampiyonlar <span>+</span> Ligi</h1>
    <div id="class-selection">
        <label for="class-select">SÄ±nÄ±f SeÃ§in:</label>
        <select id="class-select">
            <option value="">--SÄ±nÄ±f SeÃ§in--</option>
        </select>
    </div>

    <!-- GÃ¶revli Tablosu Butonu -->
    <button id="task-table-btn" style="display:none;">GÃ¶revli Tablosu</button>
    <div id="task-table-container">
        <table id="task-table">
            <thead>
                <tr>
                    <th>GÃ¶rev</th>
                    <th>Ã–ÄŸrenci</th>
                    <th class="actions">Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody>
                <!-- HaftanÄ±n BaÅŸkanÄ± SatÄ±rÄ± -->
                <tr id="head-of-week-row" class="highlighted">
                    <td>SÄ±nÄ±f BaÅŸkanÄ±</td>
                    <td id="head-of-week">Belirlenmedi</td>
                    <td class="actions">
                        <button class="edit-button" id="edit-head">DÃ¼zenle</button>
                    </td>
                </tr>
                <!-- NÃ¶betÃ§i Ã–ÄŸrenciler SatÄ±rÄ± -->
                <tr id="duty-students-row">
                    <td>NÃ¶betÃ§i Ã–ÄŸrenciler</td>
                    <td id="duty-students">Belirlenmedi</td>
                    <td class="actions">
                        <button class="edit-button" id="edit-duty-students">DÃ¼zenle</button>
                    </td>
                </tr>
                <!-- DiÄŸer GÃ¶revler SatÄ±rÄ± (DÃ¼zenleme Modunda Eklenecek) -->
            </tbody>
        </table>
        <button id="add-task-btn">GÃ¶rev Ekle</button>
    </div>

    <button id="lucky-student-btn" style="display:none;">ÅžanslÄ± Ã–ÄŸrenci SeÃ§</button>
    <button id="reset-lucky" style="display:none;" title="ÅžanslÄ± seÃ§imleri sÄ±fÄ±rla"></button>
    <div id="lucky-student-result"></div>

    <button id="edit-mode" style="display:none;">DÃ¼zenle</button>
    <div class="pin-container" id="pin-check" style="display: none;">
        <input type="password" id="pin" placeholder="PIN Girin">
        <button id="pin-submit">DoÄŸrula</button>
    </div>
    <div id="admin-panel" style="display: none;">
        <h2>Ã–ÄŸrenci Ekle</h2>
        <input type="text" id="student-name" placeholder="Ã–ÄŸrenci AdÄ±">
        <input type="text" id="photo-url" placeholder="FotoÄŸraf URL'si (Opsiyonel)">
        <button id="add-student">Ã–ÄŸrenci Ekle</button>
    </div>
    <button id="save-changes">Kaydet</button>
    <div class="table-container" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>FotoÄŸraf</th>
                    <th>Ä°sim</th>
                    <th>Genel Puan</th>
                    <th class="actions">Ä°ÅŸlemler</th>
                </tr>
            </thead>
            <tbody id="student-table">
                <!-- Dinamik olarak doldurulacak -->
            </tbody>
        </table>
    </div>

    <!-- Oyun BaÅŸlat Butonu -->
    <button id="start-game-btn" style="margin-top: 30px; padding: 15px 30px; font-size: 1.2em; background-color: #ff4500; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s ease; display: none;">
        Oyun BaÅŸlat
    </button>

    <!-- Modal Dialog -->
    <dialog id="modal">
        <div id="modal-content">
            <p id="modal-message"></p>
            <div id="checkbox-container" class="checkbox-container" style="display: none;">
                <!-- Checkboxlar burada oluÅŸturulacak -->
            </div>
            <input type="text" id="modal-input" />
            <div id="modal-buttons">
                <button class="ok-btn">OK</button>
                <button class="cancel-btn" style="display:none;">Cancel</button>
                <button class="confirm-btn" style="display:none;">Confirm</button>
            </div>
        </div>
    </dialog>

    <!-- Ã–ÄŸrenci SeÃ§im ModalÄ± -->
    <div id="student-selection-modal">
        <div id="student-selection-container">
            <button id="close-selection-btn">X</button>
            <div class="selection-panel">
                <label for="left-student-select">Sol Ã–ÄŸrenci:</label>
                <select id="left-student-select-modal">
                    <option value="">--SeÃ§iniz--</option>
                    <!-- Dinamik olarak doldurulacak -->
                </select>
            </div>
            <div class="selection-panel">
                <label for="right-student-select">SaÄŸ Ã–ÄŸrenci:</label>
                <select id="right-student-select-modal">
                    <option value="">--SeÃ§iniz--</option>
                    <!-- Dinamik olarak doldurulacak -->
                </select>
            </div>
            <button id="confirm-selection-btn">Onayla</button>
        </div>
    </div>

    <!-- Oyun Overlay -->
    <div id="game-overlay">
        <div id="game-container">
            <button id="close-game-btn">X</button>
            <div id="question-area">
                <img src="https://cdn.pixabay.com/photo/2016/04/12/17/24/easter-bunny-1324889_1280.png" alt="TavÅŸan Sol" id="bunny-left">
                <img src="https://cdn.pixabay.com/photo/2020/03/30/15/56/carrot-4984620_1280.png" alt="HavuÃ§" id="carrot">
                <img src="https://cdn.pixabay.com/photo/2016/04/12/17/24/easter-bunny-1324889_1280.png" alt="TavÅŸan SaÄŸ" id="bunny-right">
                <div id="question-text">Soru burada olacak</div>
            </div>
            <div id="game-body">
                <div id="game-content">
                    <div class="player-section" id="left-panel">
                        <div class="player-name" id="left-player-name">Sol Ã–ÄŸrenci: SeÃ§ilmedi</div>
                        <div id="left-answers" class="answers">
                            <!-- Sol taraf ÅŸÄ±klarÄ± burada olacak -->
                        </div>
                    </div>
                    <div class="player-section" id="right-panel">
                        <div class="player-name" id="right-player-name">SaÄŸ Ã–ÄŸrenci: SeÃ§ilmedi</div>
                        <div id="right-answers" class="answers">
                            <!-- SaÄŸ taraf ÅŸÄ±klarÄ± burada olacak -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kazanan Ã–ÄŸrenci Ä°sim Etkisi -->
    <div id="winner-effect" class="winner" style="display: none;">
        <div id="winner-message"></div>
        <button id="play-again-btn">Tekrar Oyna</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, set, get, remove } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "sampiyonlar-ligi.firebaseapp.com",
            databaseURL: "https://sampiyonlar-ligi-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "sampiyonlar-ligi",
            storageBucket: "sampiyonlar-ligi.appspot.com",
            messagingSenderId: "248285384149",
            appId: "1:248285384149:web:39116a8e31ef61d16f815c"
        };

        // Firebase'i BaÅŸlatma
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // DOM Elementlerini Almak
        const classSelect = document.getElementById("class-select");
        const editModeButton = document.getElementById("edit-mode");
        const pinCheck = document.getElementById("pin-check");
        const adminPanel = document.getElementById("admin-panel");
        const saveChangesButton = document.getElementById("save-changes");
        const studentTable = document.getElementById("student-table");
        const tableContainer = document.querySelector(".table-container");

        const pinInput = document.getElementById("pin");
        const pinSubmit = document.getElementById("pin-submit");
        const addStudentButton = document.getElementById("add-student");
        const studentNameInput = document.getElementById("student-name");
        const photoUrlInput = document.getElementById("photo-url");

        const luckyStudentBtn = document.getElementById("lucky-student-btn");
        const luckyStudentResult = document.getElementById("lucky-student-result");
        const resetLuckyBtn = document.getElementById("reset-lucky");

        // GÃ¶revli Tablosu Elementleri
        const taskTableBtn = document.getElementById("task-table-btn");
        const taskTableContainer = document.getElementById("task-table-container");
        const headOfWeekCell = document.getElementById("head-of-week");
        const editHeadButton = document.getElementById("edit-head");
        const dutyStudentsCell = document.getElementById("duty-students");
        const editDutyStudentsButton = document.getElementById("edit-duty-students"); // Yeni eklenen buton

        // Modal Elementleri
        const modal = document.getElementById("modal");
        const modalMessage = document.getElementById("modal-message");
        const modalButtons = document.getElementById("modal-buttons");
        const modalInput = document.getElementById("modal-input");
        const okBtn = document.querySelector(".ok-btn");
        const cancelBtn = document.querySelector(".cancel-btn");
        const confirmBtn = document.querySelector(".confirm-btn");
        const checkboxContainer = document.getElementById("checkbox-container");

        // Ã–ÄŸrenci SeÃ§im ModalÄ± Elementleri
        const studentSelectionModal = document.getElementById("student-selection-modal");
        const closeSelectionBtn = document.getElementById("close-selection-btn");
        const leftStudentSelectModal = document.getElementById("left-student-select-modal");
        const rightStudentSelectModal = document.getElementById("right-student-select-modal");
        const confirmSelectionBtn = document.getElementById("confirm-selection-btn");

        // Oyun BaÅŸlat Butonu
        const startGameBtn = document.getElementById("start-game-btn");

        let currentClass = "";
        let currentClassPin = "";
        let currentData = {};
        let pendingChanges = {}; 
        const defaultPhotoURL = "https://cdn.pixabay.com/photo/2013/07/13/13/42/tux-161406_1280.png";

        let availableStudents = [];

        // Oyun Elementleri
        const gameOverlay = document.getElementById("game-overlay");
        const closeGameBtn = document.getElementById("close-game-btn");
        const leftAnswersDiv = document.getElementById("left-answers");
        const rightAnswersDiv = document.getElementById("right-answers");
        const questionText = document.getElementById("question-text");
        const bunnyLeft = document.getElementById("bunny-left");
        const bunnyRight = document.getElementById("bunny-right");
        const leftPlayerName = document.getElementById("left-player-name");
        const rightPlayerName = document.getElementById("right-player-name");

        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let leftBunnyPosition = 0;
        let rightBunnyPosition = 0;
        const maxPosition = 5;

        // SeÃ§ilen Oyuncular
        let selectedLeftStudent = "";
        let selectedRightStudent = "";

        // Kazanan Etki Elementi
        const winnerEffect = document.getElementById("winner-effect");
        const winnerMessage = document.getElementById("winner-message");
        const playAgainBtn = document.getElementById("play-again-btn");

        // UyarÄ± ModalÄ± GÃ¶sterme Fonksiyonu
        function showAlert(message) {
            return new Promise((resolve) => {
                modalMessage.textContent = message;
                modalInput.style.display = "none";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "none";
                confirmBtn.style.display = "none";
                okBtn.style.display = "inline-block";
                okBtn.textContent = "OK";
                modal.showModal();

                okBtn.onclick = () => {
                    modal.close();
                    resolve();
                };
            });
        }

        // Prompt ModalÄ± GÃ¶sterme Fonksiyonu
        function showPrompt(message) {
            return new Promise((resolve) => {
                modalMessage.textContent = message;
                modalInput.style.display = "block";
                modalInput.value = "";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "none";
                okBtn.style.display = "inline-block";
                okBtn.textContent = "OK";
                modal.showModal();

                okBtn.onclick = () => {
                    const inputValue = modalInput.value.trim();
                    modal.close();
                    resolve(inputValue);
                };

                cancelBtn.onclick = () => {
                    modal.close();
                    resolve(null);
                };
            });
        }

        // Confirm ModalÄ± GÃ¶sterme Fonksiyonu
        function showConfirm(message) {
            return new Promise((resolve) => {
                modalMessage.textContent = message;
                modalInput.style.display = "none";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "inline-block";
                okBtn.style.display = "none";
                modal.showModal();

                confirmBtn.onclick = () => {
                    modal.close();
                    resolve(true);
                };

                cancelBtn.onclick = () => {
                    modal.close();
                    resolve(false);
                };
            });
        }

        // SÄ±nÄ±flarÄ± Firebase'den YÃ¼kleme Fonksiyonu
        async function loadClasses() {
            try {
                const classesRef = ref(db, 'classes');
                const snapshot = await get(classesRef);
                if (snapshot.exists()) {
                    const data = snapshot.val();

                    // Mevcut seÃ§enekleri temizleme (ilk seÃ§enek hariÃ§)
                    while (classSelect.options.length > 1) {
                        classSelect.remove(1);
                    }

                    for (let classKey in data) {
                        const option = document.createElement("option");
                        option.value = classKey;
                        option.textContent = classKey;
                        classSelect.appendChild(option);
                    }

                } else {
                    await showAlert("HiÃ§ sÄ±nÄ±f yok.");
                }
            } catch (error) {
                console.error("Error loading classes:", error);
                await showAlert("SÄ±nÄ±flar yÃ¼klenirken bir hata oluÅŸtu.");
            }
        }

        // SÄ±nÄ±flarÄ± YÃ¼kleme
        loadClasses();

        // SÄ±nÄ±f SeÃ§ildiÄŸinde YapÄ±lacaklar
        classSelect.addEventListener("change", async () => {
            currentClass = classSelect.value;
            if (currentClass) {
                try {
                    const pinRef = ref(db, `classes/${currentClass}/pin`);
                    const pinSnap = await get(pinRef);
                    if (pinSnap.exists()) {
                        currentClassPin = pinSnap.val();
                    } else {
                        await showAlert("SeÃ§tiÄŸiniz sÄ±nÄ±f veritabanÄ±nda PIN ile yok!");
                        return;
                    }

                    loadClassData(currentClass);
                    tableContainer.style.display = "block";
                    editModeButton.style.display = "inline-block";
                    luckyStudentBtn.style.display = "inline-block";
                    resetLuckyBtn.style.display = "inline-block";
                    taskTableBtn.style.display = "inline-block"; // GÃ¶revli Tablosu Butonu gÃ¶sterildi
                    addTaskBtnDisplay(false);
                    exitEditMode();

                    // "Oyun BaÅŸlat" butonunu gÃ¶ster
                    startGameBtn.style.display = "inline-block";
                } catch (error) {
                    console.error("Error selecting class:", error);
                    await showAlert("SÄ±nÄ±f seÃ§imi sÄ±rasÄ±nda bir hata oluÅŸtu.");
                }
            } else {
                // SÄ±nÄ±f seÃ§ilmediÄŸinde her ÅŸeyi gizle
                tableContainer.style.display = "none";
                editModeButton.style.display = "none";
                adminPanel.style.display = "none";
                saveChangesButton.style.display = "none";
                luckyStudentBtn.style.display = "none";
                resetLuckyBtn.style.display = "none";
                taskTableBtn.style.display = "none"; // GÃ¶revli Tablosu Butonu gizlendi
                taskTableContainer.style.display = "none"; // GÃ¶revli Tablosu gizlendi
                addTaskBtnDisplay(false);
                luckyStudentResult.textContent = "";

                // "Oyun BaÅŸlat" butonunu gizle
                startGameBtn.style.display = "none";
            }
        });

        // GÃ¶rev Ekleme Butonunun GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ Ayarlama Fonksiyonu
        function addTaskBtnDisplay(show) {
            const addTaskBtn = document.getElementById("add-task-btn");
            if (show) {
                addTaskBtn.style.display = "inline-block";
            } else {
                addTaskBtn.style.display = "none";
            }
        }

        // SÄ±nÄ±f Verilerini YÃ¼kleme Fonksiyonu
        function loadClassData(cls) {
            const classDataRef = ref(db, `classes/${cls}/students`);
            onValue(classDataRef, async (snapshot) => {
                const data = snapshot.val() || {};
                currentData = data;
                populateTable(currentData);
                availableStudents = Object.keys(currentData);
                await loadRoles(cls);
                populateTaskTable(); // GÃ¶revleri yÃ¼kle
                observeTasks(cls); // GÃ¶revleri izle
                observeDutyStudents();
                populateStudentSelectionModal(); // Ã–ÄŸrenci seÃ§im modalÄ±nÄ± doldur
            }, {
                onlyOnce: false
            });
        }

        // Roller YÃ¼kleme Fonksiyonu
        async function loadRoles(cls) {
            const rolesRef = ref(db, `classes/${cls}/roles`);
            try {
                const snapshot = await get(rolesRef);
                if (snapshot.exists()) {
                    const roles = snapshot.val();
                    // HaftanÄ±n BaÅŸkanÄ±
                    const presidentId = roles.headOfWeek;
                    const presidentName = currentData[presidentId]?.name || "Belirlenmedi";
                    headOfWeekCell.innerHTML = presidentId ? `ðŸ† ${presidentName}` : "Belirlenmedi";

                    // NÃ¶betÃ§i Ã–ÄŸrenciler
                    dutyStudentsCell.textContent = roles.dutyStudents ? roles.dutyStudents.map(id => currentData[id]?.name).join(", ") : "Belirlenmedi";
                } else {
                    // EÄŸer roller yoksa, rol atamalarÄ± yapma
                    // Rolleri manuel olarak atamanÄ±z gerekecek
                    headOfWeekCell.innerHTML = "Belirlenmedi";
                    dutyStudentsCell.textContent = "Belirlenmedi";
                }
            } catch (error) {
                console.error("Error loading roles:", error);
            }
        }

        // Edit Moduna GeÃ§iÅŸ Butonu
        editModeButton.addEventListener("click", () => {
            pinCheck.style.display = "block";
        });

        // PIN DoÄŸrulama Butonu
        pinSubmit.addEventListener("click", async () => {
            const enteredPin = pinInput.value;
            if (enteredPin === currentClassPin) {
                pinCheck.style.display = "none";
                adminPanel.style.display = "block";
                saveChangesButton.style.display = "inline-block";
                // Edit modunu etkinleÅŸtir
                tableContainer.querySelector("table").classList.add("edit-mode-enabled");
                taskTableContainer.classList.add("edit-mode-enabled"); // GÃ¶rev tablosuna edit modu ekle
                addTaskBtnDisplay(true); // GÃ¶rev ekleme butonunu gÃ¶ster
            } else {
                await showAlert("HatalÄ± PIN!");
            }
        });

        // Ã–ÄŸrenci Tablosunu Doldurma Fonksiyonu
        function populateTable(data) {
            studentTable.innerHTML = "";
            const sortedData = Object.entries(data).sort((a,b) => (b[1].totalScore || 0) - (a[1].totalScore || 0));

            sortedData.forEach(([id, student], index) => {
                const row = document.createElement("tr");

                if (index === 0) row.classList.add("top-1");
                if (index === 1) row.classList.add("top-2");
                if (index === 2) row.classList.add("top-3");

                const studentPhoto = student.photo || defaultPhotoURL;

                row.innerHTML = `
                    <td>
                        <img src="${studentPhoto}" alt="FotoÄŸraf">
                        <button class="button-update editable-button" data-id="${id}">GÃ¼ncelle</button>
                    </td>
                    <td>${student.name}</td>
                    <td>
                        <button class="button-red editable-button" data-id="${id}" data-type="total">-</button>
                        <span class="score-display">${student.totalScore || 0}</span>
                        <button class="button-green editable-button" data-id="${id}" data-type="total">+</button>
                    </td>
                    <td class="actions">
                        <button class="button-red" data-id="${id}" data-action="delete">X</button>
                    </td>
                `;
                studentTable.appendChild(row);
            });

            addEventListeners();
        }

        // Event Listener'larÄ± Ekleyen Fonksiyon
        function addEventListeners() {
            // Puan artÄ±rma/azaltma butonlarÄ±
            document.querySelectorAll("[data-type='total']").forEach((button) => {
                // Ã–nceki event listener'Ä± kaldÄ±rmak iÃ§in cloneNode kullanÄ±ldÄ±
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener("click", () => {
                    const id = newButton.dataset.id;
                    const action = newButton.classList.contains("button-green") ? 1 : -1;
                    const newScore = Math.max(0, (currentData[id].totalScore || 0) + action);
                    currentData[id].totalScore = newScore;

                    if (!pendingChanges[id]) {
                        pendingChanges[id] = {};
                    }
                    pendingChanges[id].totalScore = newScore;

                    const span = newButton.parentElement.querySelector("span.score-display");
                    span.textContent = newScore;
                });
            });

            // FotoÄŸraf gÃ¼ncelleme butonlarÄ±
            document.querySelectorAll(".button-update").forEach((button) => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener("click", async () => {
                    const id = newButton.dataset.id;
                    const newPhoto = await showPrompt("Yeni FotoÄŸraf URL'si girin:");
                    if (newPhoto) {
                        currentData[id].photo = newPhoto;
                        if (!pendingChanges[id]) {
                            pendingChanges[id] = {};
                        }
                        pendingChanges[id].photo = newPhoto;
                        const img = newButton.parentElement.querySelector("img");
                        img.src = newPhoto;
                    }
                });
            });

            // Silme butonlarÄ±
            document.querySelectorAll("[data-action='delete']").forEach((button) => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                newButton.addEventListener("click", async () => {
                    const id = newButton.dataset.id;
                    const confirmDelete = await showConfirm("Bu Ã¶ÄŸrenciyi silmek istediÄŸinize emin misiniz?");
                    if (confirmDelete) {
                        pendingChanges[id] = { delete: true };
                        newButton.parentElement.parentElement.remove();
                        delete currentData[id]; 
                        availableStudents = availableStudents.filter(sId => sId !== id);
                    }
                });
            });
        }

        // Ã–ÄŸrenci Ekleme Butonu
        addStudentButton.addEventListener("click", async () => {
            const name = studentNameInput.value.trim();
            let photo = photoUrlInput.value.trim();

            if (!name) {
                await showAlert("LÃ¼tfen Ã¶ÄŸrenci adÄ±nÄ± girin!");
                return;
            }

            if (!photo) {
                photo = defaultPhotoURL;
            }

            const tempId = "temp_"+Date.now();
            currentData[tempId] = {
                name,
                photo,
                totalScore: 0
            };

            pendingChanges[tempId] = {
                name,
                photo,
                totalScore: 0,
                isNew: true
            };

            const row = document.createElement("tr");

            row.innerHTML = `
                <td>
                    <img src="${photo}" alt="FotoÄŸraf">
                    <button class="button-update editable-button" data-id="${tempId}">GÃ¼ncelle</button>
                </td>
                <td>${name}</td>
                <td>
                    <button class="button-red editable-button" data-id="${tempId}" data-type="total">-</button>
                    <span class="score-display">0</span>
                    <button class="button-green editable-button" data-id="${tempId}" data-type="total">+</button>
                </td>
                <td class="actions">
                    <button class="button-red" data-id="${tempId}" data-action="delete">X</button>
                </td>
            `;
            studentTable.appendChild(row);
            addEventListeners(); // Event listener'larÄ± tekrar ekle

            studentNameInput.value = "";
            photoUrlInput.value = "";

            availableStudents.push(tempId);
        });

        // Kaydet Butonu
        saveChangesButton.addEventListener("click", async () => {
            try {
                await commitChanges();
                exitEditMode();
                await showAlert("DeÄŸiÅŸiklikler kaydedildi!");
                await loadRoles(currentClass); // Roller gÃ¼ncellendiÄŸinde UI'yi yenile
                populateStudentSelectionModal(); // Ã–ÄŸrenci seÃ§im modalÄ±nÄ± gÃ¼ncelle
            } catch (error) {
                console.error("Error saving changes:", error);
                await showAlert("DeÄŸiÅŸiklikler kaydedilirken bir hata oluÅŸtu.");
            }
        });

        // DeÄŸiÅŸiklikleri Firebase'e Kaydetme Fonksiyonu
        async function commitChanges() {
            const studentsRef = ref(db, `classes/${currentClass}/students`);
            for (const id in pendingChanges) {
                const changes = pendingChanges[id];
                if (changes.delete) {
                    if (!id.startsWith("temp_")) {
                        await remove(ref(db, `classes/${currentClass}/students/${id}`));
                    }
                } else if (changes.isNew) {
                    const newRef = push(studentsRef);
                    await set(newRef, {
                        name: changes.name,
                        photo: changes.photo,
                        totalScore: changes.totalScore
                    });
                } else {
                    if (!id.startsWith("temp_")) {
                        const updates = {};
                        if (changes.totalScore !== undefined) updates.totalScore = changes.totalScore;
                        if (changes.photo !== undefined) updates.photo = changes.photo;
                        await update(ref(db, `classes/${currentClass}/students/${id}`), updates);
                    } else {
                        // Temp Ã¶ÄŸrenci ise, kalÄ±cÄ± hale getir
                        const newRef = push(studentsRef);
                        await set(newRef, currentData[id]);
                    }
                }
            }
            pendingChanges = {};
        }

        // Edit Modundan Ã‡Ä±kÄ±ÅŸ Fonksiyonu
        function exitEditMode() {
            adminPanel.style.display = "none";
            saveChangesButton.style.display = "none";
            // Edit modunu kapat
            tableContainer.querySelector("table").classList.remove("edit-mode-enabled");
            taskTableContainer.classList.remove("edit-mode-enabled"); // GÃ¶rev tablosundan edit modu kaldÄ±r
            addTaskBtnDisplay(false); // GÃ¶rev ekleme butonunu gizle

            pinInput.value = "";
            pinCheck.style.display = "none";
        }

        // GÃ¶revli Tablosu Butonu ve FonksiyonlarÄ±
        taskTableBtn.addEventListener("click", () => {
            if (taskTableContainer.style.display === "none" || taskTableContainer.style.display === "") {
                taskTableContainer.style.display = "block";
            } else {
                taskTableContainer.style.display = "none";
            }
        });

        // HaftanÄ±n BaÅŸkanÄ±nÄ± DÃ¼zenleme Fonksiyonu
        editHeadButton.addEventListener("click", async () => {
            const students = Object.keys(currentData);
            if (students.length === 0) {
                await showAlert("Ã–ÄŸrenci yok!");
                return;
            }

            try {
                // SeÃ§ilebilecek tÃ¼m Ã¶ÄŸrenciler listesi
                const selectableStudents = students.map(id => `<option value="${id}">${currentData[id].name}</option>`).join('');

                // Modal'Ä± gÃ¼ncelle
                modalMessage.innerHTML = `Yeni SÄ±nÄ±f BaÅŸkanÄ±nÄ± seÃ§in:<br><select id="head-select">${selectableStudents}</select>`;
                modalInput.style.display = "none";
                checkboxContainer.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "inline-block";
                okBtn.style.display = "none";
                modal.showModal();

                const headSelect = document.getElementById("head-select");
                confirmBtn.onclick = async () => {
                    const selectedId = headSelect.value;
                    await set(ref(db, `classes/${currentClass}/roles/headOfWeek`), selectedId);
                    headOfWeekCell.innerHTML = `ðŸ† ${currentData[selectedId]?.name || "Belirlenmedi"}`;
                    modal.close();
                };

                cancelBtn.onclick = () => {
                    modal.close();
                };
            } catch (error) {
                console.error("Error editing head of week:", error);
                await showAlert("HaftanÄ±n baÅŸkanÄ±nÄ± dÃ¼zenlerken bir hata oluÅŸtu.");
            }
        });

        // NÃ¶betÃ§i Ã–ÄŸrencileri DÃ¼zenleme Fonksiyonu
        editDutyStudentsButton.addEventListener("click", async () => {
            const students = Object.keys(currentData);
            if (students.length < 2) {
                await showAlert("Ä°ki Ã¶ÄŸrenci seÃ§mek iÃ§in yeterli Ã¶ÄŸrenci yok.");
                return;
            }

            try {
                // SeÃ§ilebilecek tÃ¼m Ã¶ÄŸrenciler listesi
                const selectableStudents = students.map(id => `
                    <div class="checkbox-item">
                        <input type="checkbox" id="duty-${id}" name="duty-students" value="${id}">
                        <label for="duty-${id}">${currentData[id].name}</label>
                    </div>
                `).join('');

                // Modal'Ä± gÃ¼ncelle
                modalMessage.innerHTML = `NÃ¶betÃ§i Ã–ÄŸrencileri seÃ§in (2 Ã¶ÄŸrenci):<br>`;
                checkboxContainer.innerHTML = selectableStudents;
                checkboxContainer.style.display = "flex"; // GÃ¶ster
                modalInput.style.display = "none";
                cancelBtn.style.display = "inline-block";
                confirmBtn.style.display = "inline-block";
                okBtn.style.display = "none";
                modal.showModal();

                confirmBtn.onclick = async () => {
                    const selectedCheckboxes = document.querySelectorAll('input[name="duty-students"]:checked');
                    if (selectedCheckboxes.length === 2) {
                        const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
                        await set(ref(db, `classes/${currentClass}/roles/dutyStudents`), selectedIds);
                        dutyStudentsCell.textContent = selectedIds.map(id => currentData[id]?.name).join(", ");
                        modal.close();
                    } else {
                        await showAlert("LÃ¼tfen iki Ã¶ÄŸrenci seÃ§in.");
                    }
                };

                cancelBtn.onclick = () => {
                    modal.close();
                };
            } catch (error) {
                console.error("Error editing duty students:", error);
                await showAlert("NÃ¶betÃ§i Ã¶ÄŸrencileri dÃ¼zenlerken bir hata oluÅŸtu.");
            }
        });

        // ÅžanslÄ± Ã–ÄŸrenci SeÃ§imi
        luckyStudentBtn.addEventListener("click", () => {
            if (availableStudents.length === 0) {
                luckyStudentResult.textContent = "SeÃ§ilebilecek Ã¶ÄŸrenci kalmadÄ±!";
                return;
            }
            const randomIndex = Math.floor(Math.random() * availableStudents.length);
            const chosenId = availableStudents[randomIndex];
            const chosenName = currentData[chosenId].name;

            luckyStudentResult.textContent = "ÅžanslÄ± Ã–ÄŸrenci: " + chosenName;

            availableStudents.splice(randomIndex, 1);
        });

        // ÅžanslÄ± Ã–ÄŸrencileri SÄ±fÄ±rlama
        resetLuckyBtn.addEventListener("click", () => {
            // availableStudents dizisini tÃ¼m Ã¶ÄŸrencilerle tekrar doldur
            availableStudents = Object.keys(currentData);
            luckyStudentResult.textContent = "";
        });

        // GÃ¶rev Ekleme Butonu
        document.getElementById("add-task-btn").addEventListener("click", async () => {
            const taskName = await showPrompt("Yeni gÃ¶rev adÄ±nÄ± girin:");
            if (taskName) {
                const newTaskId = "task_" + Date.now();
                await set(ref(db, `classes/${currentClass}/tasks/${newTaskId}`), {
                    name: taskName,
                    assignedStudents: [] // BaÅŸlangÄ±Ã§ta atanmÄ±ÅŸ Ã¶ÄŸrenci yok
                });
                // GÃ¶rev eklediÄŸinizde, onValue listener table'Ä± gÃ¼ncelleyeceÄŸi iÃ§in addTaskRow Ã§aÄŸÄ±rmaya gerek yok
            }
        });

        // GÃ¶rev SatÄ±rÄ± Ekleme Fonksiyonu
        function addTaskRow(taskId, taskName) {
            const tbody = taskTableContainer.querySelector("tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${taskName}</td>
                <td id="task-${taskId}-student">Belirlenmedi</td>
                <td class="actions">
                    <button class="edit-button edit-task-btn" data-task-id="${taskId}">DÃ¼zenle</button>
                    <button class="edit-button delete-task-btn" data-task-id="${taskId}">Sil</button>
                </td>
            `;
            tbody.appendChild(row);

            // Silme butonuna event listener ekle
            const deleteBtn = row.querySelector(".delete-task-btn");
            const newDeleteBtn = deleteBtn.cloneNode(true);
            deleteBtn.parentNode.replaceChild(newDeleteBtn, deleteBtn);
            newDeleteBtn.addEventListener("click", async () => {
                const confirmDelete = await showConfirm("Bu gÃ¶revi silmek istediÄŸinize emin misiniz?");
                if (confirmDelete) {
                    await remove(ref(db, `classes/${currentClass}/tasks/${taskId}`));
                    row.remove();
                }
            });

            // DÃ¼zenleme butonuna event listener ekle
            const editBtn = row.querySelector(".edit-task-btn");
            const newEditBtn = editBtn.cloneNode(true);
            editBtn.parentNode.replaceChild(newEditBtn, editBtn);
            newEditBtn.addEventListener("click", async () => {
                const taskRef = ref(db, `classes/${currentClass}/tasks/${taskId}`);
                try {
                    const snapshot = await get(taskRef);
                    if (snapshot.exists()) {
                        const taskData = snapshot.val();
                        const assignedStudents = taskData.assignedStudents || [];

                        // SeÃ§ili Ã¶ÄŸrencileri listeye ekle
                        const selectableStudents = Object.keys(currentData).map(id => `
                            <div class="checkbox-item">
                                <input type="checkbox" id="task-${taskId}-student-${id}" name="task-students" value="${id}" ${assignedStudents.includes(id) ? 'checked' : ''}>
                                <label for="task-${taskId}-student-${id}">${currentData[id].name}</label>
                            </div>
                        `).join('');

                        // Modal'Ä± gÃ¼ncelle
                        modalMessage.innerHTML = `GÃ¶reve Atanacak Ã–ÄŸrencileri seÃ§in:<br>`;
                        checkboxContainer.innerHTML = selectableStudents;
                        checkboxContainer.style.display = "flex"; // GÃ¶ster
                        modalInput.style.display = "none";
                        cancelBtn.style.display = "inline-block";
                        confirmBtn.style.display = "inline-block";
                        okBtn.style.display = "none";
                        modal.showModal();

                        confirmBtn.onclick = async () => {
                            const selectedCheckboxes = document.querySelectorAll('input[name="task-students"]:checked');
                            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
                            await update(ref(db, `classes/${currentClass}/tasks/${taskId}`), {
                                assignedStudents: selectedIds
                            });

                            // GÃ¶rev tablosunda Ã¶ÄŸrencileri gÃ¼ncelle
                            if (selectedIds.length > 0) {
                                const studentNames = selectedIds.map(id => currentData[id]?.name).join(", ");
                                row.querySelector(`#task-${taskId}-student`).textContent = studentNames;
                            } else {
                                row.querySelector(`#task-${taskId}-student`).textContent = "Belirlenmedi";
                            }

                            modal.close();
                        };

                        cancelBtn.onclick = () => {
                            modal.close();
                        };
                    } else {
                        await showAlert("GÃ¶rev bulunamadÄ±.");
                    }
                } catch (error) {
                    console.error("Error editing task:", error);
                    await showAlert("GÃ¶rev dÃ¼zenlenirken bir hata oluÅŸtu.");
                }
            });
        }

        // GÃ¶rev Tablosunu Doldurma Fonksiyonu
        async function populateTaskTable() {
            const tasksRef = ref(db, `classes/${currentClass}/tasks`);
            try {
                const snapshot = await get(tasksRef);
                if (snapshot.exists()) {
                    const tasks = snapshot.val();
                    const tbody = taskTableContainer.querySelector("tbody");
                    // Mevcut gÃ¶rev satÄ±rlarÄ±nÄ± temizle (sabit satÄ±rlar hariÃ§)
                    tbody.querySelectorAll("tr:not(#head-of-week-row):not(#duty-students-row)").forEach(row => row.remove());

                    for (let taskId in tasks) {
                        addTaskRow(taskId, tasks[taskId].name);
                        // Atanan Ã¶ÄŸrencileri tabloya yansÄ±t
                        const assignedIds = tasks[taskId].assignedStudents || [];
                        const studentNames = assignedIds.map(id => currentData[id]?.name).join(", ");
                        const studentCell = document.getElementById(`task-${taskId}-student`);
                        if (studentCell) {
                            studentCell.textContent = assignedIds.length > 0 ? studentNames : "Belirlenmedi";
                        }
                    }
                } else {
                    // EÄŸer sÄ±nÄ±fa ait gÃ¶rev yoksa, sadece baÅŸkan ve nÃ¶betÃ§i satÄ±rlarÄ±nÄ± bÄ±rak
                    const tbody = taskTableContainer.querySelector("tbody");
                    tbody.querySelectorAll("tr:not(#head-of-week-row):not(#duty-students-row)").forEach(row => row.remove());
                }
            } catch (error) {
                console.error("Error populating task table:", error);
            }
        }

        // GÃ¶revlerdeki DeÄŸiÅŸiklikleri Ä°zleme Fonksiyonu
        function observeTasks(cls) {
            const tasksRef = ref(db, `classes/${cls}/tasks`);
            onValue(tasksRef, async (snapshot) => {
                await populateTaskTable();
            });
        }

        // NÃ¶betÃ§i Ã–ÄŸrencilerdeki DeÄŸiÅŸiklikleri Ä°zleme Fonksiyonu
        function observeDutyStudents() {
            const dutyStudentsRef = ref(db, `classes/${currentClass}/roles/dutyStudents`);
            onValue(dutyStudentsRef, (snapshot) => {
                if (snapshot.exists()) {
                    const dutyIds = snapshot.val(); // Ä°ki Ã¶ÄŸrenci ID'si
                    const dutyNames = dutyIds.map(id => currentData[id]?.name).filter(name => name);
                    dutyStudentsCell.textContent = dutyNames.length > 0 ? dutyNames.join(", ") : "Belirlenmedi";
                } else {
                    dutyStudentsCell.textContent = "Belirlenmedi";
                }
            });
        }

        // Oyun BaÅŸlat Butonuna Event Listener Ekleme
        startGameBtn.addEventListener("click", () => {
            // Ã–ÄŸrenci seÃ§imi modalÄ±nÄ± gÃ¶ster
            studentSelectionModal.style.display = "flex";
        });

        // Ã–ÄŸrenci SeÃ§im ModalÄ±nÄ± Kapatma Fonksiyonu
        closeSelectionBtn.addEventListener("click", () => {
            studentSelectionModal.style.display = "none";
        });

        // SeÃ§im Onay Butonuna Event Listener Ekleme
        confirmSelectionBtn.addEventListener("click", () => {
            selectedLeftStudent = leftStudentSelectModal.value;
            selectedRightStudent = rightStudentSelectModal.value;

            if (!selectedLeftStudent || !selectedRightStudent) {
                showAlert("Her iki taraf iÃ§in de bir Ã¶ÄŸrenci seÃ§meniz gerekiyor.");
                return;
            }

            if (selectedLeftStudent === selectedRightStudent) {
                showAlert("AynÄ± Ã¶ÄŸrenciyi her iki taraf iÃ§in seÃ§emezsiniz.");
                return;
            }

            // ModalÄ± kapat
            studentSelectionModal.style.display = "none";

            // Oyunu baÅŸlat
            startGame(selectedLeftStudent, selectedRightStudent);
        });

        // Oyun BaÅŸlatma Fonksiyonu
        function startGame(leftId, rightId) {
            // Reset oyun durumu
            gameQuestions = generateQuestions(20); // 20 soru oluÅŸtur
            currentQuestionIndex = 0;
            leftBunnyPosition = 0;
            rightBunnyPosition = 0;

            // Bunnies'i baÅŸlangÄ±Ã§ pozisyonuna getir
            bunnyLeft.style.left = '10%';
            bunnyRight.style.right = '10%';

            // Oyunu baÅŸlatmak iÃ§in gerekli kontroller
            if (!leftId || !rightId) {
                showAlert("Oyunu baÅŸlatmak iÃ§in iki Ã¶ÄŸrenci seÃ§melisiniz.");
                return;
            }

            // SeÃ§ilen Ã¶ÄŸrencilerin isimlerini gÃ¶ster
            const leftName = currentData[leftId].name;
            const rightName = currentData[rightId].name;
            leftPlayerName.textContent = `Sol Ã–ÄŸrenci: ${leftName}`;
            rightPlayerName.textContent = `SaÄŸ Ã–ÄŸrenci: ${rightName}`;

            // Oyun UI'sÄ±nÄ± gÃ¶ster
            gameOverlay.style.display = "flex";

            // Ä°lk soruyu yÃ¼kle
            loadNextQuestion(leftId, rightId);
        }

        // Oyun Kapatma Fonksiyonu
        closeGameBtn.addEventListener("click", () => {
            gameOverlay.style.display = "none";
            // Oyunu sÄ±fÄ±rla
            gameQuestions = [];
            currentQuestionIndex = 0;
            leftBunnyPosition = 0;
            rightBunnyPosition = 0;
            questionText.textContent = "Soru burada olacak";
            leftAnswersDiv.innerHTML = "";
            rightAnswersDiv.innerHTML = "";
            leftPlayerName.textContent = "Sol Ã–ÄŸrenci: SeÃ§ilmedi";
            rightPlayerName.textContent = "SaÄŸ Ã–ÄŸrenci: SeÃ§ilmedi";
            winnerEffect.style.display = "none";

            // Ekrandaki diÄŸer UI Ã¶ÄŸelerini yeniden normal hale getir
            document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
                element.style.filter = "none";
                element.style.pointerEvents = "auto";
                element.style.opacity = "1";
                element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
            });
        });

        // Soru OluÅŸturma Fonksiyonu
        function generateQuestions(count) {
            const questions = [];
            while (questions.length < count) {
                const num1 = getRandomInt(10, 89); // 10 ile 89 arasÄ±nda
                const num2 = getRandomInt(10, 89); // 10 ile 89 arasÄ±nda
                if (num1 + num2 <= 99) {
                    questions.push({ num1, num2, answer: num1 + num2 });
                }
            }
            return questions;
        }

        // Rastgele Tam SayÄ± Alma Fonksiyonu
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // SÄ±radaki Soruyu YÃ¼kleme Fonksiyonu
        function loadNextQuestion(leftId, rightId) {
            if (currentQuestionIndex >= gameQuestions.length) {
                endGame(leftId, rightId);
                return;
            }

            const currentQuestion = gameQuestions[currentQuestionIndex];
            questionText.textContent = `Toplam: ${currentQuestion.num1} + ${currentQuestion.num2} = ?`;

            // ÅžÄ±klar oluÅŸturma
            const correctAnswer = currentQuestion.answer;
            const wrongAnswers = generateWrongAnswers(correctAnswer);
            const allAnswers = shuffleArray([correctAnswer, ...wrongAnswers]);

            // ÅžÄ±klarÄ± sol ve saÄŸ tarafa yerleÅŸtirme
            leftAnswersDiv.innerHTML = "";
            rightAnswersDiv.innerHTML = "";

            allAnswers.forEach(ans => {
                const leftBtn = document.createElement("button");
                leftBtn.textContent = ans;
                leftBtn.classList.add("answer-btn");
                leftBtn.dataset.answer = ans;
                leftBtn.addEventListener("click", () => handleAnswer('left', ans, leftId, rightId));

                const rightBtn = document.createElement("button");
                rightBtn.textContent = ans;
                rightBtn.classList.add("answer-btn");
                rightBtn.dataset.answer = ans;
                rightBtn.addEventListener("click", () => handleAnswer('right', ans, leftId, rightId));

                leftAnswersDiv.appendChild(leftBtn);
                rightAnswersDiv.appendChild(rightBtn);
            });
        }

        // YanlÄ±ÅŸ ÅžÄ±klar OluÅŸturma Fonksiyonu
        function generateWrongAnswers(correct) {
            const wrong = new Set();
            while (wrong.size < 2) { // 3 ÅŸÄ±k iÃ§in 2 yanlÄ±ÅŸ ÅŸÄ±k
                const delta = getRandomInt(1, 10);
                const sign = Math.random() < 0.5 ? -1 : 1;
                const ans = correct + (delta * sign);
                if (ans > 0 && ans !== correct && ans <= 99) {
                    wrong.add(ans);
                }
            }
            return Array.from(wrong);
        }

        // Diziyi KarÄ±ÅŸtÄ±rma Fonksiyonu
        function shuffleArray(array) {
            for (let i = array.length -1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i +1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // YanÄ±tÄ± Ä°ÅŸleme Fonksiyonu
        function handleAnswer(side, selectedAnswer, leftId, rightId) {
            const currentQuestion = gameQuestions[currentQuestionIndex];
            const isCorrect = selectedAnswer === currentQuestion.answer;

            if (isCorrect) {
                if (side === 'left') {
                    leftBunnyPosition = Math.min(leftBunnyPosition + 1, maxPosition);
                    moveBunny(bunnyLeft, 'left', leftBunnyPosition, leftId, rightId);
                } else {
                    rightBunnyPosition = Math.min(rightBunnyPosition + 1, maxPosition);
                    moveBunny(bunnyRight, 'right', rightBunnyPosition, leftId, rightId);
                }
                showFeedback(side, true);
            } else {
                if (side === 'left') {
                    leftBunnyPosition = Math.max(leftBunnyPosition - 1, 0);
                    moveBunny(bunnyLeft, 'left', leftBunnyPosition, leftId, rightId);
                } else {
                    rightBunnyPosition = Math.max(rightBunnyPosition - 1, 0);
                    moveBunny(bunnyRight, 'right', rightBunnyPosition, leftId, rightId);
                }
                showFeedback(side, false);
            }

            // ÅžÄ±klarÄ± devre dÄ±ÅŸÄ± bÄ±rak
            disableAnswerButtons();

            // Bir sÃ¼re sonra sonraki soruya geÃ§
            setTimeout(() => {
                currentQuestionIndex++;
                loadNextQuestion(leftId, rightId);
            }, 1000);
        }

        // BunyalarÄ± Hareket Ettirme Fonksiyonu
        function moveBunny(bunny, side, position, leftId, rightId) {
            const stepPercentage = 40 / maxPosition; // TavÅŸanÄ±n 5 adÄ±mda %40 ilerlemesi
            if (side === 'left') {
                if (position === maxPosition) {
                    bunny.style.left = '50%'; // Tam olarak havuca ulaÅŸÄ±yor
                } else {
                    const newLeft = 10 + (stepPercentage * position) + '%';
                    bunny.style.left = newLeft;
                }
            } else {
                if (position === maxPosition) {
                    bunny.style.right = '50%'; // Tam olarak havuca ulaÅŸÄ±yor
                } else {
                    const newRight = 10 + (stepPercentage * position) + '%';
                    bunny.style.right = newRight;
                }
            }

            // EÄŸer tavÅŸan havucu ulaÅŸtÄ±ysa oyunu bitir
            if (position === maxPosition) {
                const winnerSide = side;
                const winnerName = side === 'left' ? currentData[leftId].name : currentData[rightId].name;
                showWinner(winnerName, side, leftId, rightId);
            }
        }

        // ÅžÄ±klarÄ± Devre DÄ±ÅŸÄ± BÄ±rakma Fonksiyonu
        function disableAnswerButtons() {
            document.querySelectorAll(".answer-btn").forEach(btn => {
                btn.classList.add("disabled");
                btn.disabled = true;
            });
        }

        // Geri Bildirim GÃ¶sterme Fonksiyonu
        function showFeedback(side, isCorrect) {
            const feedbackText = isCorrect ? "DoÄŸru!" : "YanlÄ±ÅŸ!";
            const color = isCorrect ? "#4caf50" : "#f44336";

            const feedbackDiv = document.createElement("div");
            feedbackDiv.textContent = feedbackText;
            feedbackDiv.style.color = color;
            feedbackDiv.style.fontSize = "1.5em";
            feedbackDiv.style.marginTop = "10px";
            feedbackDiv.classList.add("grow");

            if (side === 'left') {
                leftAnswersDiv.appendChild(feedbackDiv);
            } else {
                rightAnswersDiv.appendChild(feedbackDiv);
            }
        }

        // Oyunu Bitirme Fonksiyonu
        function endGame(leftId, rightId) {
            let winner = "";
            if (leftBunnyPosition > rightBunnyPosition) {
                winner = currentData[leftId].name + " kazandÄ±!";
            } else if (rightBunnyPosition > leftBunnyPosition) {
                winner = currentData[rightId].name + " kazandÄ±!";
            } else {
                winner = "Berabere!";
            }

            showWinner(winner, null, leftId, rightId);
        }

        // KazananÄ± GÃ¶sterme Fonksiyonu
        function showWinner(winnerName, side, leftId, rightId) {
            // KazananÄ±n ismini bÃ¼yÃ¼k, yeÅŸil renkte gÃ¶ster
            winnerMessage.textContent = `${winnerName} kazandÄ±!`;
            winnerEffect.style.display = "flex";

            // Ekrandaki diÄŸer UI Ã¶ÄŸelerini bulanÄ±klaÅŸtÄ±r ve etkileÅŸimleri devre dÄ±ÅŸÄ± bÄ±rak
            document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
                element.style.filter = "blur(5px)";
                element.style.pointerEvents = "none";
                element.style.opacity = "0.5";
                element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
            });
        }

        // Tekrar Oyna Butonuna Event Listener Ekleme
        playAgainBtn.addEventListener("click", () => {
            winnerEffect.style.display = "none";
            // Ekrandaki diÄŸer UI Ã¶ÄŸelerini yeniden normal hale getir
            document.querySelectorAll("body > *:not(#winner-effect)").forEach(element => {
                element.style.filter = "none";
                element.style.pointerEvents = "auto";
                element.style.opacity = "1";
                element.style.transition = "opacity 0.5s ease, filter 0.5s ease";
            });

            // Oyunu sÄ±fÄ±rla
            gameQuestions = [];
            currentQuestionIndex = 0;
            leftBunnyPosition = 0;
            rightBunnyPosition = 0;
            questionText.textContent = "Soru burada olacak";
            leftAnswersDiv.innerHTML = "";
            rightAnswersDiv.innerHTML = "";
            leftPlayerName.textContent = "Sol Ã–ÄŸrenci: SeÃ§ilmedi";
            rightPlayerName.textContent = "SaÄŸ Ã–ÄŸrenci: SeÃ§ilmedi";

            // Oyun ekranÄ±nÄ± kapat ve ana sayfayÄ± gÃ¶ster
            gameOverlay.style.display = "none";
            classSelect.value = "";
            tableContainer.style.display = "none";
            editModeButton.style.display = "none";
            adminPanel.style.display = "none";
            saveChangesButton.style.display = "none";
            luckyStudentBtn.style.display = "none";
            resetLuckyBtn.style.display = "none";
            taskTableBtn.style.display = "none";
            taskTableContainer.style.display = "none";
            addTaskBtnDisplay(false);
            luckyStudentResult.textContent = "";

            // "Oyun BaÅŸlat" butonunu gizle
            startGameBtn.style.display = "none";
        });

        // BaÅŸlangÄ±Ã§ta Ã¶ÄŸrenci seÃ§imlerini doldurmak iÃ§in fonksiyon
        function populateStudentSelectionModal() {
            // Sol Ã–ÄŸrenci SeÃ§imi
            leftStudentSelectModal.innerHTML = `<option value="">--SeÃ§iniz--</option>`;
            Object.keys(currentData).forEach(id => {
                const option = document.createElement("option");
                option.value = id;
                option.textContent = currentData[id].name;
                leftStudentSelectModal.appendChild(option);
            });

            // SaÄŸ Ã–ÄŸrenci SeÃ§imi
            rightStudentSelectModal.innerHTML = `<option value="">--SeÃ§iniz--</option>`;
            Object.keys(currentData).forEach(id => {
                const option = document.createElement("option");
                option.value = id;
                option.textContent = currentData[id].name;
                rightStudentSelectModal.appendChild(option);
            });
        }

        // Oyun BaÅŸlatma Fonksiyonu
        // Mevcut kodda zaten tanÄ±mlanmÄ±ÅŸ, burada tekrar tanÄ±mlamaya gerek yok
        // Ancak mevcut kodda tekrar tanÄ±mlama yapÄ±lmamasÄ± iÃ§in dikkat edilmelidir

    </script>
</body>
</html>
